import{Logger as e}from"@hw-agconnect/log";import t from"long";import n from"protobufjs";import r from"@protobufjs/base64";import o from"bignumber.js";import{decrypt as i,encrypt as s}from"js-crypto-aes";import a from"@hw-agconnect/api";import"@hw-agconnect/instance";import"@hw-agconnect/network";import"@hw-agconnect/auth";var u=function(){function e(t){this.logger=new e.logClazz(t)}return e.setLoggerClazz=function(e){this.logClazz=e},e.prototype.debug=function(e){this.logger.debug(e)},e.prototype.log=function(e){this.logger.log(e)},e.prototype.error=function(e){this.logger.error(e)},e.prototype.warn=function(e){this.logger.warn(e)},e.prototype.info=function(e){this.logger.info(e)},e}(),c=function(){function t(t){this.logger=e.createLogger(t)}return t.prototype.debug=function(e){this.logger.debug(e)},t.prototype.log=function(e){this.logger.log(e)},t.prototype.error=function(e){this.logger.error(e)},t.prototype.warn=function(e){this.logger.warn(e)},t.prototype.info=function(e){this.logger.info(e)},t}();u.setLoggerClazz(c);var l=function(){function e(){}return e.setCryptoJS=function(e){this.CryptoJS=e},e.getCryptoJS=function(){return this.CryptoJS},e}(),d=require("crypto-js");l.setCryptoJS(d);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function f(e,t){function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function y(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function h(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function b(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}var S,m=function(){function e(e,t){this.message=e,this.code=t}return e.prototype.getCode=function(){return this.code},e.prototype.getMessage=function(){return this.message},e}();!function(e){e[e.Ok=0]="Ok",e[e.ResourceExhausted=1]="ResourceExhausted",e[e.Timeout=2]="Timeout",e[e.FailedPrecondition=3]="FailedPrecondition",e[e.PermissionDenied=4]="PermissionDenied",e[e.Unknown=5]="Unknown",e[e.DataSizeOverflow=6]="DataSizeOverflow",e[e.UserKeyIllegality=7]="UserKeyIllegality",e[e.DataEncryptionKeyChanged=8]="DataEncryptionKeyChanged"}(S||(S={}));var T,I,w,R,O=new u("BasicException"),E=function(){function e(e){this.exceptionCode=0,this.msg="",this.check(e)}return e.prototype.getCode=function(){return this.exceptionCode},e.prototype.check=function(t){e.ErrorMessageMapper.has(t)?(this.exceptionCode=t,this.msg=e.ErrorMessageMapper.get(t)||""):(this.exceptionCode=1,this.msg="",O.warn("Unknown exception code "+t+"."))},e.prototype.getMsg=function(){return this.msg},e.prototype.toString=function(){return"exceptionCode:"+this.exceptionCode+",msg:"+this.msg},e.ErrorMessageMapper=new Map([[0,""],[1,"internal error."],[4,"CloudDBZone init failed."],[5,"CloudDBZone does not exist."],[6,"the count of CloudDBZone exceeds the limit."],[7,"CloudDBZone is busy."],[8,"please close CloudDBZone first."],[9,"please open CloudDBZone first."],[10,"please remove subscriber first."],[11,"query policy is illegal."],[13,"the count of snapshot exceeds the limit."],[14,"sdk version error."],[15,"permission denied."],[16,"object type does not exist."],[17,"object type info is invalid."],[18,"CloudDBZone config is invalid."],[19,"no data was found in CloudDBZone."],[20,"transfer data is unfinished."],[21,"downgrade object type version is illegal."],[50,"user key is invalid."],[51,"data encryption key is invalid."],[52,"encrypt failed."],[53,"decrypt failed."],[54,"please set user key first."],[1e3,"Connect to server failed."],[1001,"Object type negotiating."],[1002,"Object type negotiation exception."],[1003,"Internal error."],[1004,"Internal error."],[1005,"Connect to server failed."],[1006,"Internal error."],[1007,"Request timeout."],[1008,"Internal error."],[1009,"Internal error."],[1010,"Internal error."],[1011,"Request failed."],[1012,"Get verify info failed."],[1013,"Get verify info failed."],[1014,"Illegal application context."],[1e6,"verify token failed."],[1000001,"permission denied."],[1001e3,"the count of product subscriber exceeds the limit."],[1001001,"the count of client subscriber exceeds the limit."],[1001002,"the count of condition for subscription exceeds the limit."],[1001003,"unsupported subscription condition type."],[1001004,"unsupported subscription field type."],[1001005,"the length of subscription field value exceeds the limit."],[1001006,"the count of transaction record exceeds the limit."],[1001007,'"query %s with pagination from the cloud database failed: %s no such index for query.'],[1001008,"subscription condition objectType contains autoIncrement field."],[1001009,"sensitive fields do not support subscription."],[1002e3,"execution parameter is illegal."],[1002001,"execution parameter is illegal."],[1002002,"execution parameter is illegal."],[1002003,"illegal subscription condition."],[1002004,"internal error."],[1002005,"sensitive field not support this query condition."],[1003e3,"internal error."],[1003001,"internal error."],[1003002,"internal error."],[1004e3,"product arrears."],[1004001,"insufficient read quota."],[1004002,"insufficient write quota."],[1004003,"insufficient delete quota."],[1004004,"insufficient network quota."],[1004005,"insufficient storage quota."],[1004006,"resources are exhausted."],[1004007,"resources are exhausted."],[1004008,"resources are exhausted."],[1004009,"resources are exhausted."],[1004010,"resources are exhausted."],[1004011,"resources are exhausted."],[1004012,"resources are exhausted."],[1005e3,"the system status does not meet the operation execution conditions."],[1005001,"invalid operation argument."],[1005002,"rejected by data re-encrypting."],[1005003,"illegal request."],[1005004,"illegal request."],[1006e3,"object type is empty."],[1006001,"object type is not found."],[1006002,"the count of object type field mismatched."],[1006003,"object type field mismatched."],[1006004,"the type of object type field mismatched."],[1006005,"the null property of object type field mismatched."],[1006006,"the primary key of object type field mismatched."],[1006007,"the default value of object type field mismatched."],[1006008,"the encryption property of object type field mismatched."],[2e6,"system error."],[2001e3,"operation is illegal."],[2001001,"product status is not created."],[2001002,"the count of DB Zones exceeds the limit."],[2001003,"object type is not allowed to delete."],[2001004,"object type is not allowed to modify while import."],[2001005,"the count of object type exceeds the limit."],[2001006,"primary key is not allowed to modify."],[2001007,"the field is not allowed to modify."],[2001008,"the field is not allowed to delete."],[2001009,"the count of field exceeds the limit."],[2001010,"the index is not allowed to modify."],[2001011,"the index is not allowed to delete."],[2001012,"the count of index exceeds the limit."],[2001013,"the count of fields in a index exceeds the limit."],[2001014,"no permission found."],[2001015,"permission denied."],[2001016,"encrypted field does not support this query."],[2001017,"the capacity of objects exceeds the limit."],[2001018,"the size of object list exceeds the limit."],[2001019,"write is prohibited."],[2001020,"the size of the data to be written exceeds the limit."],[2001021,"the size of a string data to be written exceeds the limit."],[2001022,"operation is illegal."],[2001023,"operation is illegal."],[2001024,"user is locked."],[2001025,"user authentication failed."],[2001026,"the service is unavailable currently."],[2001027,"operation is denied while key is updating."],[2001028,"the count of string field exceeds the limit."],[2001040,"read is prohibited."],[2001041,"sensitive field does not support this query."],[2002e3,"invalid parameter."],[2002001,"product id is invalid."],[2002002,"product type is invalid."],[2002003,"store id is invalid."],[2002004,"unsupported operation for object type."],[2002005,"original object type is changed."],[2002006,"object type already exists."],[2002007,"object type does not exist."],[2002008,"object type is duplicate."],[2002009,"object type name is invalid."],[2002010,"no field in the object type."],[2002011,"object type is invalid."],[2002012,"field name is duplicate."],[2002013,"field name is invalid."],[2002014,"field type is invalid."],[2002015,"field value is invalid."],[2002016,"encrypt field type error."],[2002017,"index name is invalid."],[2002018,"index name is duplicate."],[2002019,"field in an index does not exist."],[2002020,"role type is invalid."],[2002021,"index is invalid while query by cursor."],[2002022,"invalid cache-changed message."],[2002023,"invalid input."],[2002024,"default value is absent."],[2002025,"primary key does not set not null."],[2002026,"primary key does not support setting default value."],[2002027,"primary key does not support setting encrypted."],[2002028,"primary key does not support the type."],[2002029,"primary key can not be found."],[2002030,"the count of primary key exceeds the limit."],[2002031,"filed type does not support setting not null."],[2002032,"filed type does not support setting default value."],[2002033,"filed type does not support setting encrypt."],[2002034,"object type does not support modifying concurrently."],[2002035,"field of default value can not set as null."],[2002036,"not null field can not be null."],[2002037,"CloudDBZone does not exist."],[2002046,"primary key does not support setting sensitive."],[2002047,"field type does not support setting sensitive."],[2002048,"the index cannot contain sensitive field."],[2002049,"sensitive field not support increment operation."],[2002050,"schema with sensitive field not support this operation."],[2003e3,"runtime error."],[2003001,"getting usage of the storage failed."],[2003002,"getting size of the storage failed."],[2003003,"creating app failed."],[2003004,"deleting app failed."],[2003005,"creating database failed."],[2003006,"error occurred while checking the existence of a database instance."],[2003007,"occupying node group failed."],[2003008,"freeing node group failed."],[2003009,"querying node information failed."],[2003010,"querying the mapping between products and node groups failed."],[2003011,"querying the products in cluster failed."],[2003012,"querying available clusters failed."],[2003013,"occupying cluster failed."],[2003014,"querying cluster failed."],[2003015,"inserting config of product mapping failed."],[2003016,"error occurred while checking the existence of a DB zone."],[2003017,"creating DB zone failed."],[2003018,"dropping DB zone failed."],[2003019,"initializing system tables failed."],[2003020,"upgrading schema failed."],[2003021,"generating a new schema version failed."],[2003022,"setting permission for schemas failed."],[2003023,"field type error."],[2003024,"creating table failed."],[2003025,"upgrading table failed."],[2003026,"dropping object type failed."],[2003027,"error occurred while checking the existence of a table."],[2003028,"locking table failed."],[2003029,"querying product mapping failed."],[2003030,"upserting product mapping failed."],[2003031,"deleting product mapping failed."],[2003032,"querying product key failed."],[2003033,"inserting product key failed."],[2003034,"deleting product key failed."],[2003035,"querying product status failed."],[2003036,"updating product status failed."],[2003037,"querying all the products failed."],[2003038,"saving product info failed."],[2003039,"deleting product info failed."],[2003040,"querying the mapping between product and DB ID failed."],[2003041,"querying all IDs of the products failed."],[2003042,"generate ID failed."],[2003043,"locking the ID failed."],[2003044,"value type of the ID is incorrect."],[2003045,"updating ID failed."],[2003046,"initializing counter failed."],[2003047,"querying counter failed."],[2003048,"update counter failed."],[2003049,"cached plan changed."],[2003050,"invalid prepared statement."],[2003051,"bind value to statement failed."],[2003052,"value convert failed."],[2003053,"numeric value out of range."],[2003054,"getting DB connection failed."],[2003055,"initializing DB connection failed."],[2003056,"invalid DB connection."],[2003057,"invalid group id for DB."],[2003058,"use database for connection failed."],[2003059,"verifying the config of product mapping failed."],[2003060,"getting config in DB failed."],[2003061,"modifying config in DB failed."],[2003062,"item does not exist in config."],[2003063,"transaction execute failed."],[2003064,"transaction start failed."],[2003065,"transaction commit failed."],[2003066,"transaction rollback failed."],[2003067,"sql execute failed."],[2003068,"querying execute failed."],[2003069,"inserting execute failed."],[2003070,"updating execute failed."],[2003071,"deleting execute failed."],[2003072,"truncating execute failed."],[2003073,"upsert failed."],[2003074,"batch upsert failed."],[2003075,"batch delete failed."],[2003076,"querying by row failed."],[2003077,"upserting by row failed."],[2003078,"deleting by row failed."],[2003079,"extracting data from result set failed."],[2003080,"extracting data from result set failed."],[2003081,"extracting data failed."],[2003082,"extracting version failed."],[2003083,"expected value does not exist."],[2003084,"modifying the database connection limit failed."],[2003085,"unsupported."],[2003086,"querying object type failed."],[2003087,"object type conversion failed."],[2003088,"instance id getting error."],[2003089,"no valid product mapping info."],[2003090,"no free cluster."],[2003091,"group is not empty."],[2003092,"no free node group."],[2003093,"node group has not been allocated."],[2003094,"length of index field exceeds the limit."],[2003095,"querying product info failed."],[2003096,"generate product sequence failed."],[2003097,"violates unique constraint."]]),e}(),C=function(){function e(){}return e.build=function(e){return"string"==typeof e?{message:e}:this.parseException(new E(e))},e.parseException=function(e){return new m(e.getMsg(),e.getCode())},e}(),N=l.getCryptoJS(),D=function(){function e(){}return e.isFunction=function(e){return"function"==typeof e},e.isArray=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},e.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},e.isNotNullObject=function(e){return null!==e&&"object"==typeof e},e.isNullOrUndefined=function(e){return null==e},e.checkNotNull=function(t,n){if(e.isNullOrUndefined(t))throw C.build(n)},e.isClass=function(t){if(e.isFunction(t)){var n=t.prototype;if(!e.isNotNullObject(n))return!1;var r=n.constructor;if(e.isFunction(r))return!0}return!1},e.isErrorObject=function(t){return!!(t instanceof m||e.isObject(t)&&Object.prototype.hasOwnProperty.call(t,"message")&&1===Object.getOwnPropertyNames(t).length)},e.isArrayBuffer=function(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object ArrayBuffer]"===t||"[object Uint8Array]"===t},e.isEmpty=function(){for(var e,t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(0===n.length)return!0;try{for(var o=b(n),i=o.next();!i.done;i=o.next()){var s=i.value;if(!s)return!0}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return!1},e.isValidObject=function(e){return!(!e||"object"!=typeof e||"Object"===e.constructor.name)},e.isSameObjectType=function(t){var n,r;if(e.checkNotNull(t,"The object list is invalid."),e.isEmptyArray(t))return!0;var o=this.getClassName(t[0]);try{for(var i=b(t),s=i.next();!s.done;s=i.next()){var a=s.value;if(this.getClassName(a)!==o)return!1}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return!0},e.isEmptyArray=function(e){return 0===e.length},e.getClassName=function(t){if(e.isNullOrUndefined(t))return t;var n=t;return e.isClass(n)||(n=t.constructor),n.className?n.className:n.name},e.deepCopy=function(e){var t,n,r=[];try{for(var o=b(e),i=o.next();!i.done;i=o.next()){var s=i.value;if("object"==typeof s)if(s.constructor!==Date)if(s.constructor!==RegExp)if(s.clone)r.push(s.clone());else{var a=new s.constructor;for(var u in s)if(Object.hasOwnProperty.call(s,u)){var c=s[u];a[u]=c}r.push(a)}else r.push(new RegExp(s));else r.push(new Date(s));else r.push(s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},e.deepCopyNumber=function(e){var t=new Set;return e.forEach((function(e){t.add(e)})),t},e.hash=function(e){for(var t=""+e,n=5381,r=t.length;r;)n=33*n^t.charCodeAt(--r);return""+(n>>>0)},e.generateUUID=function(){for(var e=(new Date).getTime(),t="",n=1;n<15;n+=2){t+="abcdefghijklmnopqrstuvwxyz1234567890".charAt((e>>>n)%36)}return t},e.generateTraceId=function(){for(var e="",t=0;t<this.TRACE_ID_LENGTH/this.RANDOM_KEY_LENGTH;t++)e+=this.randomKey();return e},e.randomKey=function(){return((1+this.getSecRandom())*this.RANDOM_VALUE|0).toString(this.HEX).substring(1)},e.getSecRandom=function(){return Math.floor(Math.random()*this.RANDOM_RANGE)/(this.RANDOM_DIVISOR+1)},e.uint8ArrayToString=function(e){return decodeURIComponent(escape(String.fromCharCode.apply(String,v(e))))},e.stringToUint8Array=function(e){var t=unescape(encodeURIComponent(e)).split("").map((function(e){return e.charCodeAt(0)}));return new Uint8Array(t)},e.wordArrayToUint8Array=function(e){for(var t=e.sigBytes,n=e.words,r=new Uint8Array(t),o=0,i=0;o!==t;){var s=n[i++];if(r[o++]=(4278190080&s)>>>24,o===t)break;if(r[o++]=(16711680&s)>>>16,o===t)break;if(r[o++]=(65280&s)>>>8,o===t)break;r[o++]=255&s}return r},e.uint8ArrayToWordArray=function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e[r])<<24-r%4*8;return N.lib.WordArray.create(n,t)},e.encode=function(e){return N.enc.Base64.stringify(e)},e.decode=function(e){return N.enc.Base64.parse(e)},e.convertArray=function(t){return e.isArray(t)?t:[t]},e.isStringEmpty=function(e){return null==e||""===e},e.checkTraceId=function(e){return this.TRACE_ID_EXP.test(e)},e.TRACE_ID_EXP=/^[0-9a-f]{1,32}$/,e.RANDOM_DIVISOR=4294967295,e.RANDOM_VALUE=65536,e.RANDOM_RANGE=1e9,e.HEX=16,e.TRACE_ID_LENGTH=32,e.RANDOM_KEY_LENGTH=4,e}(),A=new Set(["Limit","OrderBy"]),P=function(){function e(e){this.queryConditions=[],this.clazz=e,this.depth=0}return e.where=function(t){return D.checkNotNull(t,"Entity class must not be null."),new e(t)},e.prototype.addCondition=function(e,t,n){if(this.queryConditions.length>=30)throw C.build("Query type exceeds the limit.");var r={conditionType:e,fieldName:t,value:n};return this.queryConditions.push(r),this},e.prototype.equalTo=function(e,t){return this.checkFieldValidity(e,t),this.addCondition("EqualTo",e,t)},e.prototype.count=function(e){return this.checkFieldValidity(e),this.addCondition("Count",e)},e.prototype.beginsWith=function(e,t){return this.checkFieldValidity(e,t),this.addCondition("BeginWith",e,t)},e.prototype.endsWith=function(e,t){return this.checkFieldValidity(e,t),this.addCondition("EndWith",e,t)},e.prototype.contains=function(e,t){return this.checkFieldValidity(e,t),this.addCondition("Contain",e,t)},e.prototype.notEqualTo=function(e,t){return this.checkFieldValidity(e,t),this.addCondition("NotEqualTo",e,t)},e.prototype.greaterThan=function(e,t){return this.checkFieldValidity(e,t),this.addCondition("GreaterThan",e,t)},e.prototype.greaterThanOrEqualTo=function(e,t){return this.checkFieldValidity(e,t),this.addCondition("GreaterThanOrEqualTo",e,t)},e.prototype.lessThan=function(e,t){return this.checkFieldValidity(e,t),this.addCondition("LessThan",e,t)},e.prototype.lessThanOrEqualTo=function(e,t){return this.checkFieldValidity(e,t),this.addCondition("LessThanOrEqualTo",e,t)},e.prototype.in=function(e,t){if(!D.isArray(t))throw C.build("The values must be array.");return this.checkFieldValidity.apply(this,v([e],t)),this.addCondition("In",e,t)},e.prototype.isNull=function(e){return this.checkFieldValidity(e),this.addCondition("IsNull",e)},e.prototype.isNotNull=function(e){return this.checkFieldValidity(e),this.addCondition("IsNotNull",e)},e.prototype.orderByAsc=function(e){return this.checkFieldValidity(e),this.isValidCloudDBQuery("OrderBy","ASC"),this.addCondition("OrderBy",e,"ASC")},e.prototype.orderByDesc=function(e){return this.checkFieldValidity(e),this.isValidCloudDBQuery("OrderBy","DESC"),this.addCondition("OrderBy",e,"DESC")},e.prototype.limit=function(e,t){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw C.build("The Count is invalid.");if(D.isNullOrUndefined(t)&&(t=0),"number"!=typeof t||Math.floor(t)!==t||t<0)throw C.build("The Offset is invalid.");return this.isValidCloudDBQuery("Limit"),this.addCondition("Limit",void 0,{offset:void 0!==t?t:0,number:e})},e.prototype.beginGroup=function(){return this.isValidCloudDBQuery("BeginGroup"),this.depth++,this.addCondition("BeginGroup",void 0)},e.prototype.endGroup=function(){return this.isValidCloudDBQuery("EndGroup"),this.depth--,this.addCondition("EndGroup",void 0)},e.prototype.or=function(){return this.isValidCloudDBQuery("Or"),this.addCondition("Or",void 0)},e.prototype.and=function(){return this.isValidCloudDBQuery("And"),this.addCondition("And",void 0)},e.prototype.getClassName=function(){var e;if(this.tableName)return this.tableName;var t=this.clazz.className;return t||(null===(e=this.clazz)||void 0===e?void 0:e.name)},e.prototype.getClazz=function(){return this.clazz},e.prototype.getQueryConditions=function(){return this.queryConditions},e.prototype.getDepth=function(){return this.depth},e.prototype.checkFieldValidity=function(e){for(var t,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];D.checkNotNull(e,"The field name must not be null.");try{for(var i=b(r),s=i.next();!s.done;s=i.next()){var a=s.value;D.checkNotNull(a,"The value is invalid.")}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.isValidCloudDBQuery=function(e,t){var n=this.queryConditions.length,r=0===n?null:this.queryConditions[n-1].conditionType;if(A.has(e)&&(0!==this.depth||"Or"===r||"And"===r)){if("OrderBy"===e)throw C.build('near "'+t+'": syntax error.');throw C.build('near "'+e+'": syntax error.')}if(("Or"===e||"And"===e)&&(0===n||"BeginGroup"===r||A.has(r)||"Or"===r||"And"===r))throw C.build('near "'+e+'": syntax error.');if("EndGroup"===e){if(this.depth<=0)throw C.build("The query beginGroup and endGroup should come in pairs with right direction.");if(0===n||"BeginGroup"===r||"Or"===r||"And"===r)throw C.build('near "'+e+'": syntax error.')}},e}(),k=function(){function e(e,t,n){this.snapshotObjects=e,this.upsertedObjects=t,this.deletedObjects=n}return e.prototype.getSnapshotObjects=function(){return this.snapshotObjects},e.prototype.setSnapshotObjects=function(e){this.snapshotObjects=e},e.prototype.getUpsertedObjects=function(){return this.upsertedObjects},e.prototype.setUpsertedObjects=function(e){this.upsertedObjects=e},e.prototype.getDeletedObjects=function(){return this.deletedObjects},e.prototype.setDeletedObjects=function(e){this.deletedObjects=e},e}(),M=function(){function e(e){this.capacity_=-1,this.cacheNodeMap=new Map,this.primaryKeys=e}return Object.defineProperty(e.prototype,"capacity",{get:function(){return this.capacity_},enumerable:!1,configurable:!0}),e.prototype.hash=function(e){for(var t=""+e,n=5381,r=t.length;r;)n=33*n^t.charCodeAt(--r);return""+(n>>>0)},e.prototype.getRecordHash=function(e){var t="R";return this.primaryKeys.forEach((function(n){t=t+"-"+e[n]})),this.hash(t)},e}(),_=function(e){this.versionId=e},j=function(e){function t(t){var n=e.call(this,t)||this;return n.capacity_=-1,n}return f(t,e),t.prototype.cache=function(e,t){var n=this.cacheNodeMap.get(t);return n||(n=new _(t),this.cacheNodeMap.set(t,n)),n.record=e,n},t.prototype.remove=function(e){e&&(this.cacheNodeMap.get(e)&&this.cacheNodeMap.delete(e))},t.prototype.get=function(e){if(e)return this.cacheNodeMap.get(e)},t}(M),x=function(){function e(e){this.value_=void 0,this.actions={},this.value_=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this.value_},set:function(e){var t,n;this.value_=e;var r=Object.getOwnPropertyNames(this.actions);try{for(var o=b(r),i=o.next();!i.done;i=o.next()){var s=i.value,a=this.actions[s];(null==a?void 0:a.isMeetCondition(this))&&a.execute(this)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},enumerable:!1,configurable:!0}),e.prototype.register=function(e){this.actions[e.id]=e},e.prototype.unregister=function(e){delete this.actions[e]},e.prototype.hasNoAction=function(){return 0===Object.getOwnPropertyNames(this.actions).length},e.prototype.release=function(){this.actions={},this.value_=void 0},e}(),U=function(){function e(e,t,n,r){this.isTimeout=!1,this.executed=!1,this.isRegistered=!1,this.isOnce=e,this.id=n,this.func=t,this.condition=r||function(e){return!0}}return Object.defineProperty(e.prototype,"isExecuted",{get:function(){return this.executed},enumerable:!1,configurable:!0}),e.prototype.isMeetCondition=function(e){return!1===this.isTimeout&&this.condition(e)},e.prototype.withTimeout=function(e,t){var n=this;return setTimeout((function(){n.isExecuted||(n.isTimeout=!0,t&&t())}),e),this},e.prototype.execute=function(e){this.isTimeout||(this.isRegistered||e.register(this),this.condition(e)&&this.executeAndTryUnregister(e))},e.prototype.executeAndTryUnregister=function(e){this.executed=!0;try{this.func(e)}catch(e){setTimeout((function(){throw e}),Math.floor(0))}this.isOnce&&e.unregister(this.id)},e}();!function(e){e[e.EMPTY=0]="EMPTY",e[e.SCHEMA_NEGOTIATE=1]="SCHEMA_NEGOTIATE",e[e.CACHE_UPDATE=2]="CACHE_UPDATE",e[e.OBJECT_UPDATE=3]="OBJECT_UPDATE",e[e.TRANSACTION=4]="TRANSACTION",e[e.OBJECT_QUERY=5]="OBJECT_QUERY",e[e.QUERY_SUB=6]="QUERY_SUB",e[e.QUERY_UNSUB=7]="QUERY_UNSUB",e[e.QUERY_SUB_PUSH=8]="QUERY_SUB_PUSH",e[e.ENCRYPTION_TASK=9]="ENCRYPTION_TASK",e[e.USER_DATA_QUERY=10]="USER_DATA_QUERY",e[e.SERVER_STATUS=11]="SERVER_STATUS"}(T||(T={})),function(e){e[e.EMPTY=0]="EMPTY",e[e.QUERY_SALT_VALUE=1]="QUERY_SALT_VALUE",e[e.QUERY_CIPHER_TEST=2]="QUERY_CIPHER_TEST",e[e.UPDATE_CIPHER_TEXT=3]="UPDATE_CIPHER_TEXT",e[e.INSERT_ENCRYPTION_INFO=4]="INSERT_ENCRYPTION_INFO",e[e.UPDATE_ENCRYPTION_INFO=5]="UPDATE_ENCRYPTION_INFO",e[e.NOTIFY_ENCRYPTION_COMMAND_CHANGED=6]="NOTIFY_ENCRYPTION_COMMAND_CHANGED",e[e.NOTIFY_ENCRYPTION_KEY_CHANGE_TO_NORMAL=7]="NOTIFY_ENCRYPTION_KEY_CHANGE_TO_NORMAL",e[e.NOTIFY_ENCRYPTION_KEY_CHANGE_TO_UPDATING=8]="NOTIFY_ENCRYPTION_KEY_CHANGE_TO_UPDATING",e[e.NOTIFY_ENCRYPTION_KEY_CHANGE_TO_UPDATE_INTERRUPT=9]="NOTIFY_ENCRYPTION_KEY_CHANGE_TO_UPDATE_INTERRUPT",e[e.MONITOR_USER_COMMAND_CHANGE=10]="MONITOR_USER_COMMAND_CHANGE",e[e.MONITOR_DATA_KEY_CHANGE=11]="MONITOR_DATA_KEY_CHANGE"}(I||(I={})),function(e){e[e.SYNC_UPSERT=1]="SYNC_UPSERT",e[e.SYNC_DELETE=2]="SYNC_DELETE",e[e.VERIFY=3]="VERIFY"}(w||(w={})),function(e){e[e.ALL=0]="ALL",e[e.UPSERT=1]="UPSERT",e[e.DELETE=2]="DELETE"}(R||(R={}));var q,L,K,V,B,F,z=new u("SequenceTaskQueue"),G=function(){function e(){this.tasks=[],this.isExecuting=!1}return e.prototype.scheduleProcess=function(e){z.debug("scheduleProcess start: "+this.isExecuting),this.tasks.push(e),this.isExecuting||this.process()},e.prototype.process=function(){var e=this;if(this.isExecuting=!0,z.debug("process start length: "+this.tasks.length),this.tasks.length){var t=this.tasks.shift();null==t||t.execute().then((function(){e.process()}))}else this.isExecuting=!1},e}(),Y=function(){function e(e){this.func=e}return e.prototype.execute=function(){return this.func.call(null)},e}(),Q=new u("SnapshotGenerator"),H=function(){function e(e,t,n){this.snapshotVersionIds=new Set,this.upsertedVersionIds=new Set,this.deletedVersionIds=new Set,this.version=new x(0),this.taskQueue=new G,this.clz=e,this.cloudDBZoneQuery=t,this.naturalBaseRef=n}return e.prototype.initialize=function(e){this.snapshotCache=new j(e)},e.prototype.getVersion=function(){return this.version},e.prototype.increaseVersion=function(){this.version.value=this.version.value+1},e.prototype.cacheSnapshotObjects=function(e,t,n){var r=this,o=new Y((function(){return y(r,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,this.processPushData(e,t,n)];case 1:return[2,r.sent()]}}))}))}));this.taskQueue.scheduleProcess(o)},e.prototype.processPushData=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o,i,s=this;return h(this,(function(a){switch(a.label){case 0:return Q.info("processPushData start:"+e.length+" "+this.snapshotVersionIds.size+"             "+this.upsertedVersionIds.size+" "+this.deletedVersionIds.size),0!==t?[3,5]:(this.deletedVersionIds.forEach((function(e){s.snapshotCache.remove(e)})),this.clearSnapshotVersionIds(),r=e.map((function(e){return e})).filter((function(e){return e.operationType===R.DELETE&&e.isValidVersion()})),o=e.map((function(e){return e})).filter((function(e){return e.operationType===R.UPSERT})),i=e.map((function(e){return e})).filter((function(e){return e.operationType===R.ALL})),Q.info("processPushData on: "+o.length+", "+r.length+", "+i.length),n!==R.DELETE&&n!==R.UPSERT?[3,2]:[4,this.handleIncrementalData(r,o)]);case 1:return a.sent(),[3,4];case 2:return[4,this.handlePushAllData(i)];case 3:a.sent(),a.label=4;case 4:Q.info("processPushData done: "+e.length+" "+this.snapshotVersionIds.size+"                 "+this.upsertedVersionIds.size+" "+this.deletedVersionIds.size),a.label=5;case 5:return this.increaseVersion(),[2,Promise.resolve(0)]}}))}))},e.prototype.handleIncrementalData=function(e,t){var n;return y(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d,p,f,y,g,v,S,m;return h(this,(function(h){switch(h.label){case 0:r=new Map;try{for(o=b(e),i=o.next();!i.done;i=o.next())l=i.value,(s=null===(n=this.snapshotCache.get(l.objectVersion))||void 0===n?void 0:n.record)&&(d=this.generateRecord(s),r.set(this.snapshotCache.getRecordHash(d),l.objectVersion),this.deletedVersionIds.add(l.objectVersion),this.snapshotVersionIds.delete(l.objectVersion))}catch(e){g={error:e}}finally{try{i&&!i.done&&(v=o.return)&&v.call(o)}finally{if(g)throw g.error}}a=this.getSnapshotCacheVersionIds(),h.label=1;case 1:h.trys.push([1,6,7,8]),u=b(t),c=u.next(),h.label=2;case 2:if(c.done)return[3,5];if(l=c.value,d=this.generateRecord(l),p=this.snapshotCache.getRecordHash(d),f=r.get(p))this.deletedVersionIds.delete(f);else if(a.has(p)&&a.get(p)===l.objectVersion)return[3,4];return[4,this.naturalBaseRef.getEntireEncryption().decryptEntireEncryptedFields(this.cloudDBZoneQuery,[l])];case 3:h.sent(),this.snapshotCache.cache(l,l.objectVersion),this.snapshotVersionIds.add(l.objectVersion),this.upsertedVersionIds.add(l.objectVersion),h.label=4;case 4:return c=u.next(),[3,2];case 5:return[3,8];case 6:return y=h.sent(),S={error:y},[3,8];case 7:try{c&&!c.done&&(m=u.return)&&m.call(u)}finally{if(S)throw S.error}return[7];case 8:return[2]}}))}))},e.prototype.handlePushAllData=function(e){var t,n,r,o;return y(this,void 0,void 0,(function(){var i,s,a,u,c,l,d,p,f,y,g,v,S=this;return h(this,(function(h){switch(h.label){case 0:i=new Set(this.snapshotVersionIds),s=this.getSnapshotCacheVersionIds(),h.label=1;case 1:h.trys.push([1,7,8,9]),a=b(e),u=a.next(),h.label=2;case 2:return u.done?[3,6]:(c=u.value,l=this.generateRecord(c),d=this.snapshotCache.getRecordHash(l),p=s.get(d),f=p&&(!(null===(n=null===(t=this.snapshotCache.get(p))||void 0===t?void 0:t.record)||void 0===n?void 0:n.objectVersion)||(null===(o=null===(r=this.snapshotCache.get(p))||void 0===r?void 0:r.record)||void 0===o?void 0:o.objectVersion)!==c.objectVersion),p&&!f?[3,4]:[4,this.naturalBaseRef.getEntireEncryption().decryptEntireEncryptedFields(this.cloudDBZoneQuery,[c])]);case 3:h.sent(),this.upsertedVersionIds.add(c.objectVersion),this.snapshotVersionIds.add(c.objectVersion),this.snapshotCache.cache(c,c.objectVersion),h.label=4;case 4:p&&i.delete(p),f&&(this.snapshotVersionIds.delete(p),this.snapshotCache.remove(p)),h.label=5;case 5:return u=a.next(),[3,2];case 6:return[3,9];case 7:return y=h.sent(),g={error:y},[3,9];case 8:try{u&&!u.done&&(v=a.return)&&v.call(a)}finally{if(g)throw g.error}return[7];case 9:return i.forEach((function(e){S.deletedVersionIds.add(e),S.snapshotVersionIds.delete(e)})),[2]}}))}))},e.prototype.clearSnapshotVersionIds=function(){this.upsertedVersionIds.clear(),this.deletedVersionIds.clear()},e.prototype.generateSnapshot=function(e,t){if(t){var n=D.deepCopyNumber(this.snapshotVersionIds),r=this.buildSnapshotObjects(e,n);return new k(r,r,[])}var o=D.deepCopyNumber(this.snapshotVersionIds),i=D.deepCopyNumber(this.upsertedVersionIds),s=D.deepCopyNumber(this.deletedVersionIds),a=this.buildSnapshotObjects(e,o),u=this.buildSnapshotObjects(e,i),c=this.buildSnapshotObjects(e,s);return new k(a,u,c)},e.prototype.buildSnapshotObjects=function(e,t){var n,r,o,i=[];try{for(var s=b(t),a=s.next();!a.done;a=s.next()){var u=a.value,c=null===(o=this.snapshotCache.get(u))||void 0===o?void 0:o.record;if(void 0!==c){var l=D.deepCopy([c.getUserObject()]);i.push(l[0])}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i},e.prototype.getSnapshotCache=function(){var e=this;return v(this.snapshotVersionIds).map((function(t){var n;return null===(n=e.snapshotCache.get(t))||void 0===n?void 0:n.record}))},e.prototype.getSnapshotCacheVersionIds=function(){var e=this,t=new Map;return this.getSnapshotCache().forEach((function(n){var r=e.generateRecord(n);t.set(e.snapshotCache.getRecordHash(r),n.objectVersion)})),t},e.prototype.generateRecord=function(e){return e.setObjectTypeName(this.clz),this.naturalBaseRef.getDataModelHelper().deserialize(this.clz,e.getObject())},e}(),W=new u("SubscribeManager"),J=function(){function e(e,t,n,r,o){this.exceptionCode=0,this.cloudSubRecordId="",this.cloudSubKey=-1,this.pushSeq=0,this.queryId=e,this.conditionSignature=t,this.naturalStoreName=n,this.cloudDBZoneQuery=r,this.naturalBaseRef=o,this.snapshotGenerator=new H(this.cloudDBZoneQuery.getClazz(),this.cloudDBZoneQuery,o)}return e.prototype.initialize=function(e){this.snapshotGenerator.initialize(e)},e.prototype.addListener=function(e,t){var n=this;new X((function(e){return y(n,void 0,void 0,(function(){var n;return h(this,(function(r){if(0!==this.exceptionCode)t.onSnapshot(void 0,C.build(this.exceptionCode));else{if(n=this.snapshotGenerator.generateSnapshot(this.cloudDBZoneQuery.getClazz(),e),!e&&0===n.getUpsertedObjects().length&&0===n.getDeletedObjects().length)return W.info("addListener: skip snapShot notify when first snapShot has nothing update!"),[2];t.onSnapshot(n,void 0)}return[2]}))}))}),e,(function(){var e=n.snapshotGenerator.getVersion().value;return void 0!==e&&e>0})).execute(this.snapshotGenerator.getVersion())},e.prototype.removeListener=function(e){return this.snapshotGenerator.getVersion().unregister(e.toString()),this.snapshotGenerator.getVersion().hasNoAction()},e.prototype.subscribe=function(e){return y(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return W.info("start subscribe!"),this.pushSeq=0,[4,this.naturalBaseRef.getNaturalCloudStorage().onSubscribe(Ct.DEFAULT_SUBSCRIBE,this.naturalBaseRef.getNaturalStore(this.naturalStoreName),[this.queryId,this.cloudDBZoneQuery.getClassName(),e])];case 1:return t.sent(),[2]}}))}))},e.prototype.unsubscribe=function(){var e;return y(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return W.info("start unsubscribe!"),[4,this.naturalBaseRef.getNaturalCloudStorage().onUnSubscribe(Ct.DEFAULT_SUBSCRIBE,this.naturalBaseRef.getNaturalStore(this.naturalStoreName),[this.queryId,null===(e=this.cloudSubRecordId)||void 0===e?void 0:e.toString(),this.cloudSubKey,this.cloudDBZoneQuery.getClassName()])];case 1:return t.sent(),[2]}}))}))},e.prototype.notify=function(e,t,n){this.exceptionCode=e,this.snapshotGenerator.cacheSnapshotObjects(t||[],e,n)},e.prototype.isErrorStatus=function(){return 0!==this.exceptionCode},e.prototype.getSnapshotCache=function(){return this.snapshotGenerator.getSnapshotCache()},e}(),X=function(e){function t(t,n,r){var o=e.call(this,!1,(function(){return o.executeCallback()}),n.toString(),r)||this;return o.isFirstSnapshot=!0,o.callback=t,o}return f(t,e),t.prototype.executeCallback=function(){var e=this.isFirstSnapshot;this.isFirstSnapshot=!1,this.callback(e)},t}(U),Z=new u("ListenerManager"),$=function(){function e(e,t){this.listenerCount=0,this.queryId=0,this.subscribeInfoMap=new Map,this.queryHashMap=new Map,this.listenerIdMap=new Map,this.naturalBaseRef=e,this.naturalStoreName=t}return e.prototype.generateSignature=function(e){var t=this,n=e.getQueryConditions();return n.sort((function(e,n){var r=t.compareValue(e.conditionType,n.conditionType);return 0!==r||0!==(r=t.compareValue(e.fieldName,n.fieldName))?r:t.compareValue(e.value,n.value)})),D.hash(e.getClassName()+JSON.stringify(n))},e.prototype.hasListener=function(e){return D.isNullOrUndefined(e)?0!==this.listenerIdMap.size:this.listenerIdMap.has(e)},e.prototype.addListener=function(e,t,n,r){return y(this,void 0,void 0,(function(){var o,i,s,a;return h(this,(function(u){switch(u.label){case 0:return this.listenerCount>=16?(Z.warn("AddListener: failed to add listener.\n             Too many snapshot. max size: 16."),[2,13]):(o=this.generateSignature(e),i=0,Z.info("addListener: listenerId:"+r),this.queryHashMap.has(o)?(i=this.queryHashMap.get(o),null==(s=this.subscribeInfoMap.get(i))||s.addListener(r,n),(null==s?void 0:s.isErrorStatus())?[4,s.subscribe(t)]:[3,2]):[3,3]);case 1:u.sent(),u.label=2;case 2:return[3,5];case 3:return this.queryId=this.queryId+1,i=this.queryId,s=new J(i,o,this.naturalStoreName,e,this.naturalBaseRef),a=this.naturalBaseRef.getDefaultNaturalStore().getAppSchema().get(e.getClassName()).getPrimaryKeys(),s.initialize(a),s.addListener(r,n),this.subscribeInfoMap.set(i,s),this.queryHashMap.set(o,i),[4,s.subscribe(t)];case 4:u.sent(),u.label=5;case 5:return this.listenerIdMap.set(r,i),this.listenerCount=this.listenerCount+1,[2,0]}}))}))},e.prototype.removeListener=function(e){return y(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return void 0===(t=this.listenerIdMap.get(e))?[2,Promise.resolve(0)]:(this.listenerIdMap.delete(e),(n=this.subscribeInfoMap.get(t))&&(this.listenerCount=this.listenerCount-1),(null==n?void 0:n.removeListener(e))?[4,null==n?void 0:n.unsubscribe()]:[3,2]);case 1:r.sent(),this.cleanSubscription(t),r.label=2;case 2:return[2,Promise.resolve(0)]}}))}))},e.prototype.cleanSubscribeInfo=function(e){var t=this;v(this.subscribeInfoMap.values()).filter((function(t){return t.cloudSubRecordId===e})).map((function(e){return e.queryId})).forEach((function(e){t.cleanSubscription(e)}))},e.prototype.cleanSubscription=function(e){var t,n;Z.info("cleanSubscription queryId:"+e),this.subscribeInfoMap.delete(e);try{for(var r=b(this.queryHashMap.keys()),o=r.next();!o.done;o=r.next()){var i=o.value;if(this.queryHashMap.get(i)===e)return void this.queryHashMap.delete(i)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getAllSubscribeInfo=function(){var e,t,n=new Map;try{for(var r=b(this.subscribeInfoMap.values()),o=r.next();!o.done;o=r.next()){var i=o.value;n.set(i.cloudSubRecordId,i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},e.prototype.getSubscribeInfoByRecordId=function(e){var t=v(this.subscribeInfoMap.values()).filter((function(t){return t.cloudSubRecordId===e}));return 0===t.length?void 0:t[0]},e.prototype.isSubscribeNotResponsed=function(e){var t=this.subscribeInfoMap.get(e);return!(!t||""!==t.cloudSubRecordId)},e.prototype.getSubscribeInfo=function(e){var t,n;try{for(var r=b(this.subscribeInfoMap),o=r.next();!o.done;o=r.next()){var i=g(o.value,2),s=i[0],a=i[1];if(e===s)return a}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.compareValue=function(e,t){return e>t?1:e<t?-1:0},e}();!function(e){e[e.Boolean=1]="Boolean",e[e.Byte=2]="Byte",e[e.Short=3]="Short",e[e.Integer=4]="Integer",e[e.Long=5]="Long",e[e.Float=6]="Float",e[e.Double=7]="Double",e[e.ByteArray=8]="ByteArray",e[e.String=9]="String",e[e.Date=10]="Date",e[e.Text=11]="Text",e[e.IntAutoIncrement=12]="IntAutoIncrement",e[e.LongAutoIncrement=13]="LongAutoIncrement",e[e.Unknown=14]="Unknown"}(q||(q={})),function(e){e.getFieldType=function(e){var t=q[e];return t||q.Unknown},e.valueOf=function(e){return e},e.toString=function(e){switch(e){case 1:return"Boolean";case 2:return"Byte";case 3:return"Short";case 4:return"Integer";case 5:return"Long";case 6:return"Float";case 7:return"Double";case 8:return"ByteArray";case 9:return"String";case 10:return"Date";case 11:return"Text";case 12:return"IntAutoIncrement";case 13:return"LongAutoIncrement";default:return"Unknown"}}}(L||(L={})),function(e){e.World="World",e.Authenticated="Authenticated",e.Creator="Creator",e.Administrator="Administrator"}(K||(K={})),function(e){e.getUserRole=function(e){var t=K[e];return t||K.World}}(V||(V={})),function(e){e[e.None=0]="None",e[e.Read=1]="Read",e[e.Upsert=2]="Upsert",e[e.Delete=4]="Delete"}(B||(B={})),function(e){e.getUserRight=function(e){switch(e){case"Read":return B.Read;case"Upsert":return B.Upsert;case"Delete":return B.Delete;default:return B.None}},e.getAllUserRight=function(t){var n=0;return t.forEach((function(t){var r=e.getUserRight(t);n|=r})),n},e.checkUserRight=function(e,t){return 0!=(e&t)},e.composeUserRight=function(e){var t=0;return e.forEach((function(e){t|=e})),t}}(F||(F={}));var ee,te=new Set(["rowid","naturalbase_version","naturalbase_syncstatus","naturalbase_deleted","naturalbase_operationtype","naturalbase_accesstime","naturalbase_operationtime","naturalbase_creator","naturalbase_lastmodifier"]),ne=new Set(["objecttypeinfohelper","t_data_upgrade_info","naturalbase_metadata"]);!function(e){e[e.VALID_VALUE=0]="VALID_VALUE",e[e.INVALID_TYPE=1]="INVALID_TYPE",e[e.INVALID_VALUE=2]="INVALID_VALUE"}(ee||(ee={}));var re=new u("SchemaValidators"),oe=/(^[a-zA-Z][A-Za-z0-9_]{0,28}[A-Za-z0-9]$)|(^[a-zA-Z]$)/,ie={};function se(e,t){ie[e]=t}function ae(e){var t=e.length;return t<=30&&t>=1?!!oe.test(e)||(re.warn("[Rule Invalidation] field-name-validation => Field Name is invalid."),!1):(re.warn("[Rule Invalidation] Field Name length should not exceed 30"),!1)}se("object-has-fields-validation",(function(e){if(0===e.getFieldInfos().size)throw C.build("The object type does not define any field.")})),se("field-not-support-notnull-validation",(function(e){var t,n;try{for(var r=b(e.getFieldInfos().values()),o=r.next();!o.done;o=r.next()){var i=o.value;if(i.isNotNull){if(i.fieldType===q.Date)throw C.build("Date type can not be set as not null value.");if(i.fieldType===q.ByteArray)throw C.build("ByteArray type can not be set as not null value.")}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),se("field-not-support-default-validation",(function(e){var t,n;try{for(var r=b(e.getFieldInfos().values()),o=r.next();!o.done;o=r.next()){var i=o.value;if(i.hasDefaultValue){if(i.fieldType===q.Date)throw C.build("Date type can not be set as default value.");if(i.fieldType===q.ByteArray)throw C.build("ByteArray type can not be set as default value.")}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),se("field-primarykey-not-support-default-validation",(function(e){var t,n;try{for(var r=b(e.getFieldInfos().values()),o=r.next();!o.done;o=r.next()){var i=o.value;if(i.isPrimaryKey&&i.hasDefaultValue)throw C.build("The primary key is forbidden to set default value.")}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),se("field-default-not-support-null-validation",(function(e){var t,n;try{for(var r=b(e.getFieldInfos().values()),o=r.next();!o.done;o=r.next()){var i=o.value;if(i.fieldType!==q.IntAutoIncrement&&i.fieldType!==q.LongAutoIncrement&&!i.isPrimaryKey&&i.isNotNull&&!i.hasDefaultValue)throw C.build("The field should be set default value while it is set not null.")}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),se("field-autoincrement-must-not-null-validation",(function(e){var t,n;try{for(var r=b(e.getFieldInfos().values()),o=r.next();!o.done;o=r.next()){var i=o.value;if(!i.isNotNull){if(i.fieldType===q.IntAutoIncrement)throw C.build("IntAutoIncrement type must be set as not null value.");if(i.fieldType===q.LongAutoIncrement)throw C.build("LongAutoIncrement type must be set as not null value.")}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),se("string-text-value-length-validation",(function(e){var t,n;try{for(var r=b(e.getFieldInfos().values()),o=r.next();!o.done;o=r.next()){var i=o.value;if((i.fieldType===q.String||i.fieldType===q.Text)&&!D.isNullOrUndefined(i.defaultValue)&&i.defaultValue.length>200)throw C.build("String default value length cannot be greater than 200.")}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),se("no-system-property-column",(function(e){var t,n;try{for(var r=b(e.getFieldInfos().values()),o=r.next();!o.done;o=r.next()){var i=o.value;if(te.has(i.fieldName.toLowerCase()))throw C.build("Field name "+i.fieldName+" is invalid.")}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),se("no-system-table-name",(function(e){var t;if(ne.has(null===(t=e.name)||void 0===t?void 0:t.toLowerCase()))throw C.build("The object name is invalid.")})),se("field-type-validation",(function(e){var t,n,r;try{for(var o=b(e.getFieldInfos().values()),i=o.next();!i.done;i=o.next()){var s=i.value;if((r=s.fieldType)!==q.Short&&r!==q.Long&&r!==q.Integer&&r!==q.Float&&r!==q.Double&&r!==q.String&&r!==q.Date&&r!==q.Byte&&r!==q.ByteArray&&r!==q.Text&&r!==q.Boolean&&r!==q.IntAutoIncrement&&r!==q.LongAutoIncrement)throw C.build("The type of "+s.fieldName+" field is not supported.")}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}})),se("primarykey-require",(function(e){var t,n;try{for(var r=b(e.getFieldInfos().values()),o=r.next();!o.done;o=r.next()){if(o.value.isPrimaryKey)return}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}throw C.build("The class does not have primary key.")})),se("field-not-support-primarykey",(function(e){var t,n;try{for(var r=b(e.getFieldInfos().values()),o=r.next();!o.done;o=r.next()){var i=o.value;if((i.fieldType===q.Date||i.fieldType===q.ByteArray||i.fieldType===q.Text)&&i.isPrimaryKey)throw C.build(L.toString(i.fieldType)+" type can not be set as primary key.")}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),se("no-non-defaultvalue",(function(e){var t,n;try{for(var r=b(e.getFieldInfos().values()),o=r.next();!o.done;o=r.next()){var i=o.value;if(i.hasDefaultValue&&D.isNullOrUndefined(i.defaultValue))throw C.build("The field should be set default value while it is set not null.")}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),se("primarykey-count-limitation",(function(e){if(v(e.getFieldInfos().values()).filter((function(e){return e.isPrimaryKey})).length>5)throw C.build("The count of primary key exceeds the limit.")})),se("string-fields-count-limitation",(function(e){if(v(e.getFieldInfos().values()).filter((function(e){return e.fieldType===q.String})).length>100)throw C.build("The count of string type field exceeds the limit.")})),se("field-name-validation",(function(e){var t,n;try{for(var r=b(e.getFieldNames()),o=r.next();!o.done;o=r.next()){var i=o.value;if(!ae(i))throw C.build("Field name "+i+" is invalid.")}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}})),se("objecttype-name-validation",(function(e){if(!function(e){if(e.length>30||e.length<1)return re.warn("[Rule Invalidation] Table Name length should not exceed 30\n         and less than 1."),!1;if(!oe.test(e))return re.warn("[Rule Invalidation] Table Name is invalid."),!1;return!0}(e.name))throw C.build("The object name is invalid.")}));var ue={};function ce(e,t){ue[e]=t}ce(q.Integer,(function(e){return Number.isInteger(e)?e<-2147483648||e>2147483647?ee.INVALID_VALUE:ee.VALID_VALUE:ee.INVALID_TYPE})),ce(q.String,(function(e){if("string"!=typeof e)return ee.INVALID_TYPE;if(e.length>200)throw C.build("String type length cannot be greater than 200.");if(-1!==e.indexOf("\0")||-1!==e.indexOf("\0"))throw C.build("The string contains illegal character, use the ByteArray type if you intend to send raw bytes.");return ee.VALID_VALUE})),ce(q.Short,(function(e){return Number.isSafeInteger(e)?e<-32768||e>32767?ee.INVALID_VALUE:ee.VALID_VALUE:ee.INVALID_TYPE})),ce(q.Long,(function(e){var t;return D.isNullOrUndefined(e)||"Long"===(null===(t=e.constructor)||void 0===t?void 0:t.name)?ee.VALID_VALUE:ee.INVALID_TYPE})),ce(q.Boolean,(function(e){return"boolean"==typeof e?ee.VALID_VALUE:ee.INVALID_TYPE})),ce(q.Byte,(function(e){return Number.isSafeInteger(e)?e<-128||e>127?ee.INVALID_VALUE:ee.VALID_VALUE:ee.INVALID_TYPE})),ce(q.Float,(function(e){return"number"!=typeof e?ee.INVALID_TYPE:e<-3402823e32||e>3402823e32?ee.INVALID_VALUE:ee.VALID_VALUE})),ce(q.Double,(function(e){return"number"!=typeof e?ee.INVALID_TYPE:Number.isFinite(e)?ee.VALID_VALUE:ee.INVALID_VALUE})),ce(q.ByteArray,(function(e){return e instanceof ArrayBuffer||e instanceof Uint8Array?ee.VALID_VALUE:ee.INVALID_TYPE})),ce(q.Date,(function(e){return e instanceof Date?isNaN(e.getTime())?ee.INVALID_VALUE:ee.VALID_VALUE:ee.INVALID_TYPE})),ce(q.Text,(function(e){if("string"==typeof e){if(-1!==e.indexOf("\0")||-1!==e.indexOf("\0"))throw C.build("The string contains illegal character, use the ByteArray type if you intend to send raw bytes.");return ee.VALID_VALUE}return ee.INVALID_TYPE})),ce(q.IntAutoIncrement,(function(e){return Number.isInteger(e)?e<1||e>2147483647?ee.INVALID_VALUE:ee.VALID_VALUE:ee.INVALID_TYPE})),ce(q.LongAutoIncrement,(function(e){var n;return D.isNullOrUndefined(e)||"Long"===(null===(n=e.constructor)||void 0===n?void 0:n.name)?-1===e.compare(t.fromString("1"))?ee.INVALID_VALUE:ee.VALID_VALUE:ee.INVALID_TYPE}));var le,de,pe=function(){function e(t){this.isNeedEncrypt=!1,this.notNull=!1,this.belongPrimaryKey=!1,this.fieldName="",this.fieldType=q.Unknown,this.signature=-1,this.hasDefaultValue=!1,this.opeName="",t&&(this.parseFieldInfo(t),this.signature=e.hash(this.fieldName))}return e.hash=function(e){for(var t=""+e,n=5381,r=t.length;r;)n=33*n^t.charCodeAt(--r);return Math.abs(n>>>0)},e.prototype.parseFieldInfo=function(e){this.isNeedEncrypt=e.isNeedEncrypt,this.fieldName=e.fieldName,this.notNull=e.notNull,this.belongPrimaryKey=e.belongPrimaryKey,this.fieldType=L.getFieldType(e.fieldType),this.isEncryptField&&null!==e.fieldName&&void 0!==e.fieldName&&(this.opeName=-1===e.fieldName.indexOf("#ope")?e.fieldName+"#ope":e.fieldName),Object.prototype.hasOwnProperty.call(e,"defaultValue")&&this.setDefaultValue(e.defaultValue)},e.prototype.setDefaultValue=function(e){switch(this.hasDefaultValue=!0,this.fieldType){case q.Boolean:this.defaultValue="true"===e;break;case q.Byte:case q.Double:case q.Float:case q.Integer:case q.Short:this.defaultValue=Number(e);break;case q.Long:this.defaultValue=t.fromString(e);break;case q.String:case q.Text:this.defaultValue=e}},Object.defineProperty(e.prototype,"isEncryptField",{get:function(){return this.isNeedEncrypt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isNotNull",{get:function(){return this.notNull},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPrimaryKey",{get:function(){return this.belongPrimaryKey},enumerable:!1,configurable:!0}),e.prototype.equalTo=function(e){var n,r;if(!e)return!1;var o=Object.getOwnPropertyNames(e);try{for(var i=b(o),s=i.next();!s.done;s=i.next()){var a=s.value;if(this[a]instanceof t&&e[a]instanceof t){var u=this[a],c=e[a];if(!u.equals(c))return!1}else if(this[a]!==e[a])return!1}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return!0},e}();!function(e){e[e.MORE_TABLES=1]="MORE_TABLES",e[e.LESS_TABLES=2]="LESS_TABLES",e[e.EQUAL_TABLES=3]="EQUAL_TABLES",e[e.DIFF_TABLES=4]="DIFF_TABLES"}(le||(le={})),function(e){e[e.MORE_FIELDS=1]="MORE_FIELDS",e[e.LESS_FIELDS=2]="LESS_FIELDS",e[e.EQUAL_FIELDS=3]="EQUAL_FIELDS",e[e.DIFF_FIELDS=4]="DIFF_FIELDS",e[e.INVALID_INDEX=5]="INVALID_INDEX",e[e.INVALID_SCHEMA=6]="INVALID_SCHEMA"}(de||(de={}));var fe=function(){function e(e,t){var n=this;(this.name_="",this.primaryKeyList=[],this.fieldInfos=new Map,this.permissions=new Map,e)&&(this.name_=t.objectTypeName,t.fields.forEach((function(e){var t=new pe(e);n.fieldInfos.set(t.fieldName,t),t.isPrimaryKey&&n.primaryKeyList.push(t)})),e.permissions.forEach((function(e){n.permissions.set(V.getUserRole(e.role),F.getAllUserRight(e.rights))})))}return Object.defineProperty(e.prototype,"name",{get:function(){return this.name_},enumerable:!1,configurable:!0}),e.validateObjectSchema=function(e){var t,n;try{for(var r=b(Object.getOwnPropertyNames(ie)),o=r.next();!o.done;o=r.next()){var i=o.value;ie[i](e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0},e.prototype.compareFields=function(e){if(!e)return de.INVALID_SCHEMA;var t=this.compareFieldInfo(e);return t===de.DIFF_FIELDS?de.INVALID_SCHEMA:t},e.prototype.compareFieldInfo=function(e){var t,n;if(this.fieldInfos.size<e.fieldInfos.size)return de.MORE_FIELDS;try{for(var r=b(this.fieldInfos.values()),o=r.next();!o.done;o=r.next()){var i=o.value;if(!i.equalTo(e.fieldInfos.get(i.fieldName)))return de.DIFF_FIELDS}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return de.EQUAL_FIELDS},e.prototype.getFieldInfo=function(e){return this.fieldInfos.get(e)},e.prototype.checkPermission=function(e,t){var n=this.permissions.get(e);return!!n&&F.checkUserRight(n,t)},e.prototype.getPrimaryKeys=function(){return v(this.fieldInfos.values()).filter((function(e){return e.isPrimaryKey})).map((function(e){return e.fieldName})).sort()},e.prototype.getPrimaryKeyFieldTypes=function(){return this.primaryKeyList},e.prototype.getFieldNames=function(){return v(this.fieldInfos.keys())},e.prototype.hasCompositePrimaryKey=function(){return this.getPrimaryKeys().length>1},e.prototype.getFieldInfos=function(){return this.fieldInfos},e.prototype.setPermission=function(e,t){this.permissions.set(e,t)},e.prototype.isLegalOpeFieldName=function(e){return-1!==e.indexOf("#ope")},e.prototype.isEncryptTable=function(){var e,t;try{for(var n=b(this.fieldInfos.values()),r=n.next();!r.done;r=n.next()){if(r.value.isEncryptField)return!0}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return!1},e.prototype.getEncryptFieldList=function(){return v(this.fieldInfos.values()).filter((function(e){return e.isEncryptField})).sort()},e}(),ye=new u("SchemaUtils"),he=function(){function e(){}return e.validateFieldValue=function(e,t){var n=ue[e](t);if(n===ee.INVALID_TYPE)throw C.build("The field type mismatches the value type.");if(n===ee.INVALID_VALUE){var r=L.toString(e);throw C.build("The value for a "+r+" column is invalid.")}},e.validateFieldValueForQuery=function(e,t){e===q.LongAutoIncrement?e=q.Long:e===q.IntAutoIncrement&&(e=q.Integer),this.validateFieldValue(e,t)},e.validateObjectSchema=function(e){var t,n;try{for(var r=b(Object.getOwnPropertyNames(ie)),o=r.next();!o.done;o=r.next()){var i=o.value;ie[i](e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0},e.compareSchemas=function(e,t,n,r){if(e>n)throw ye.error("compareSchemas: Object version downgrade is not support. current version: "+e),C.build(21);var o=this.compareTables(t,r);if(e===n){if(o===le.EQUAL_TABLES)return ye.warn("compareSchemas: ObjectType version and ObjectType has not changed."),!0;throw ye.error("compareSchemas: ObjectType version has not changed, but ObjectType has changed."),C.build(17)}switch(o){case le.EQUAL_TABLES:throw ye.error("compareSchemas: ObjectType version has changed, but ObjectType has not changed."),C.build(17);case le.LESS_TABLES:throw ye.error("compareSchemas: Remove ObjectType is not supported."),C.build(17);case le.DIFF_TABLES:throw ye.error("compareSchemas: cannot modify existing schema when upgrade."),C.build(17);case le.MORE_TABLES:default:return!1}},e.compareTables=function(e,t){var n,r;if(e.size>t.size)return le.LESS_TABLES;var o=!1;try{for(var i=b(e.values()),s=i.next();!s.done;s=i.next()){var a=s.value,u=a.name,c=t.get(u),l=a.compareFields(c);if(l!==de.MORE_FIELDS){if(l===de.EQUAL_FIELDS)continue;return le.DIFF_TABLES}o=!0}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return e.size<t.size||o?le.MORE_TABLES:le.EQUAL_TABLES},e}(),be=new u("NaturalStore"),ge=new Set(["Limit","OrderBy"]),ve=new Set(["Limit","Or","BeginGroup","EndGroup","And"]),Se=new Set(["Or","BeginGroup","EndGroup","EqualTo","And"]),me=new Set(["BeginGroup","EndGroup","Or","And"]),Te=new Set(["In","Average","Contain","BeginWith","EndWith"]),Ie=new Set(["EqualTo","NotEqualTo","GreaterThan","GreaterThanOrEqualTo","LessThan","LessThanOrEqualTo"]),we=new Set(["IsNull","IsNotNull","OrderBy","Count"]),Re=function(){function e(e,t){this.references=new Set,this.listenerManager=null,this.naturalStoreId=e,this.cloudStorage=t.getNaturalCloudStorage(),this.naturalBaseRef=t,this.listenerManager=new $(t,e)}return e.prototype.releaseNaturalStoreResource=function(){this.listenerManager=null},e.prototype.getNaturalStoreName=function(){return this.naturalStoreId},e.prototype.close=function(){this.releaseNaturalStoreResource()},e.prototype.hasSubscriber=function(){return!(!this.listenerManager||!this.listenerManager.hasListener())},e.prototype.executeUpsert=function(e){return y(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return[4,this.naturalBaseRef.getEntireEncryption().encryptEntireEncryptedFields(e)];case 1:return t=n.sent(),[4,this.cloudStorage.executeUpsert(t,this.naturalStoreId)];case 2:return[2,n.sent()]}}))}))},e.prototype.executeDelete=function(e){return y(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,this.naturalBaseRef.getEntireEncryption().isValidEncryptionOperation(D.getClassName(e[0]))];case 1:return t.sent(),[4,this.cloudStorage.executeDelete(e,this.naturalStoreId)];case 2:return[2,t.sent()]}}))}))},e.prototype.executeQuery=function(e){return y(this,void 0,void 0,(function(){var t,n,r;return h(this,(function(o){switch(o.label){case 0:return this.checkQueryClass(e),[4,this.naturalBaseRef.getEntireEncryption().isValidEncryptionOperation(e.getClassName())];case 1:return o.sent(),[4,this.getQueryConditionByString(e.getClassName(),e.getQueryConditions())];case 2:return t=o.sent(),[4,this.cloudStorage.executeQuery(this.naturalStoreId,e.getClassName(),t)];case 3:return n=o.sent(),[4,this.naturalBaseRef.getEntireEncryption().decryptEntireEncryptedFields(e,n)];case 4:return r=o.sent(),[2,new k(r,[],[])]}}))}))},e.prototype.executeTransactionQuery=function(e){return y(this,void 0,void 0,(function(){var t,n,r;return h(this,(function(o){switch(o.label){case 0:return[4,this.naturalBaseRef.getEntireEncryption().isValidEncryptionOperation(e.getClassName())];case 1:return o.sent(),[4,this.getQueryConditionByString(e.getClassName(),e.getQueryConditions())];case 2:return t=o.sent(),[4,this.cloudStorage.executeQuery(this.naturalStoreId,e.getClassName(),t)];case 3:return n=o.sent(),[4,this.naturalBaseRef.getEntireEncryption().decryptEntireEncryptedFields(e,n)];case 4:return r=o.sent(),[2,Promise.resolve({objects:n,decryptObjects:r})]}}))}))},e.prototype.executeAggregateQuery=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o;return h(this,(function(i){switch(i.label){case 0:return this.verifyAvgQuery(e,n),r=D.deepCopy(e.getQueryConditions()),this.addCondition(r,t,n),[4,this.getQueryConditionByString(e.getClassName(),r)];case 1:return o=i.sent(),[4,this.cloudStorage.executeAggregateQuery(this.naturalStoreId,e.getClassName(),o)];case 2:return[2,i.sent()]}}))}))},e.prototype.executeServerStatusQuery=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.cloudStorage.executeServerStatusQuery()];case 1:return[2,e.sent()]}}))}))},e.prototype.runTransaction=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o;return h(this,(function(i){switch(i.label){case 0:return[4,this.getTransactionOperation(n)];case 1:return r=i.sent(),o=D.deepCopy(t),[2,this.cloudStorage.runTransaction(e,o,r)]}}))}))},e.prototype.addSnapshotListener=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o;return h(this,(function(i){switch(i.label){case 0:return this.checkSubscribeQuery(e),[4,this.naturalBaseRef.getEntireEncryption().isValidEncryptionOperation(e.getClassName())];case 1:return i.sent(),[4,this.getQueryConditionByString(e.getClassName(),e.getQueryConditions())];case 2:return r=i.sent(),this.listenerManager?[4,this.listenerManager.addListener(e,r,t,n)]:[3,4];case 3:return o=i.sent(),[3,5];case 4:o=0,i.label=5;case 5:return[2,o]}}))}))},e.prototype.removeSnapshotListener=function(e){var t;return y(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,null===(t=this.listenerManager)||void 0===t?void 0:t.removeListener(e)];case 1:return n.sent(),[2,0]}}))}))},e.prototype.getAllSubscribeInfo=function(){return this.listenerManager?this.listenerManager.getAllSubscribeInfo():new Map},e.prototype.getSubscribeInfoByCloudSubRecordId=function(e){var t;return null===(t=this.listenerManager)||void 0===t?void 0:t.getSubscribeInfoByRecordId(e)},e.prototype.isSubscribeNotResponsed=function(e){var t=Number(e);return!(""===e||isNaN(t)||!this.listenerManager)&&this.listenerManager.isSubscribeNotResponsed(t)},e.prototype.handleSubscribeRes=function(e,t,n,r){var o,i=null===(o=this.listenerManager)||void 0===o?void 0:o.getSubscribeInfo(t);return i instanceof J&&(i.cloudSubRecordId=n,i.cloudSubKey=r,0!==e)?(i.notify(e,[]),e):0},e.prototype.handleUnsubscribeRes=function(e,t){var n;return 0!==t?t:(null===(n=this.listenerManager)||void 0===n||n.cleanSubscribeInfo(e),0)},e.prototype.handleSubPushRes=function(e,t,n,r){e.notify(t,n,r)},e.prototype.getQueryConditionByString=function(e,n){return y(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d,p,f;return h(this,(function(y){switch(y.label){case 0:r=[],y.label=1;case 1:y.trys.push([1,8,9,10]),o=b(n),i=o.next(),y.label=2;case 2:if(i.done)return[3,7];if("And"===(s=i.value).conditionType)return[3,6];if(this.isInvalidCondition(s))throw be.error("getQueryConditionByString fail for invalid query condition!"),C.build("Invalid query conditions.");if(a={fieldName:s.fieldName,conditionType:s.conditionType,value:void 0},!(u=this.naturalBaseRef.getDataModelHelper().getFieldInfoByName(e,s.fieldName))&&!ve.has(s.conditionType))throw C.build("The field name does not exist.");if(!(null==u?void 0:u.isEncryptField))return a.fieldType=null==u?void 0:u.fieldType,s.value instanceof Date?a.value=s.value.getTime():s.value instanceof t?a.value=s.value.toString():D.isArray(s.value)?a.value=this.arrayToString(s.value):a.value=s.value,r.push(a),[3,6];if(c=s.conditionType,Te.has(c))throw C.build("Encrypted field does not support "+c+".");return a.fieldName=s.fieldName+"#ope",a.fieldType=q.String,Ie.has(c)?(l=a,[4,this.naturalBaseRef.getEntireEncryption().conditionEntireEncryptedField(e,s.fieldName,u.fieldType,s.value)]):[3,4];case 3:return l.value=y.sent(),[3,5];case 4:a.value=s.value,y.label=5;case 5:r.push(a),y.label=6;case 6:return i=o.next(),[3,2];case 7:return[3,10];case 8:return d=y.sent(),p={error:d},[3,10];case 9:try{i&&!i.done&&(f=o.return)&&f.call(o)}finally{if(p)throw p.error}return[7];case 10:return[2,JSON.stringify({queryConditions:r})]}}))}))},e.prototype.arrayToString=function(e){var n,r,o=[];try{for(var i=b(e),s=i.next();!s.done;s=i.next()){var a=s.value,u=a;a instanceof Date?u=a.getTime():a instanceof t&&(u=a.toString()),o.push(u)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o},e.prototype.isInvalidCondition=function(e){return!e.conditionType||!ve.has(e.conditionType)&&!e.fieldName},e.prototype.getTransactionOperation=function(e){return y(this,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c;return h(this,(function(l){switch(l.label){case 0:t=[],l.label=1;case 1:l.trys.push([1,6,7,8]),n=b(e),r=n.next(),l.label=2;case 2:return r.done?[3,5]:(o=r.value,[4,this.naturalBaseRef.getEntireEncryption().encryptEntireEncryptedFields(o.objects)]);case 3:i=l.sent(),s={operationType:o.operationType,objectTypeName:o.objectTypeName,objects:i},t.push(s),l.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return a=l.sent(),u={error:a},[3,8];case 7:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2,Promise.resolve(t)]}}))}))},e.prototype.getAllSubscribeInfos=function(){var e=[],t=0;return this.getAllSubscribeInfo().forEach((function(n){e[t++]=[n.queryId,n.cloudSubRecordId,n.cloudSubKey,n.cloudDBZoneQuery.getClassName()]})),e},e.prototype.verifyAvgQuery=function(e,t){D.checkNotNull(t,"The field name must not be null."),this.checkQueryClass(e);var n=e.getClassName(),r=this.naturalBaseRef.getDataModelHelper().getFieldInfoByName(n,t);if(!r)throw C.build("The field name does not exist.");if(r.isEncryptField)throw C.build("Encrypted field does not support AVG.");switch(r.fieldType){case q.Byte:case q.Short:case q.Integer:case q.Long:case q.Float:case q.Double:case q.LongAutoIncrement:case q.IntAutoIncrement:return;default:throw C.build("The field type is not numeric.")}},e.prototype.checkQueryClass=function(e){var t,n;if(D.isNullOrUndefined(e))throw C.build("CloudDBZoneQuery must not be null.");if(!(e instanceof P))throw C.build("The type of input must be CloudDBZoneQuery.");var r=e.getClazz();if("function"!=typeof r)throw C.build("The input parameter is not a class.");if(!e.getQueryConditions())throw be.warn("checkSubscribeQuery: failed to get conditions array."),C.build("Invalid query conditions.");var o=Object.getOwnPropertyNames(new r);if(D.isEmpty(e.getClassName())||!this.naturalBaseRef.getDataModelHelper().validate(new r))throw C.build(16);var i=this.naturalBaseRef.getDataModelHelper().getFieldInfosByClassName(e.getClassName());if(o.length!==(null==i?void 0:i.size))throw C.build("The field size of input object is different with that of the imported class.");try{for(var s=b(o),a=s.next();!a.done;a=s.next()){var u=a.value;if(!i.has(u))throw C.build("The field does not exist.")}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}this.checkConditions(e)},e.prototype.checkConditions=function(e){var t,n;if(0!==e.getDepth())throw C.build("The query beginGroup and endGroup should come in pairs with right direction.");var r=e.getQueryConditions().length;if(r>30)throw C.build("Query type exceeds the limit.");for(var o=0,i=e.getClassName(),s=e.getQueryConditions(),a=0;a<r;a++){var u=s[a];if(me.has(u.conditionType)&&(o=this.validBeginOrEndGroup(u,s,a,o),this.validOrAndCondition(u,s,a)),ge.has(u.conditionType)&&(0!==o||0!==a&&("And"===s[a-1].conditionType||"Or"===s[a-1].conditionType))){if("OrderBy"===u.conditionType)throw C.build('near "'+u.value+'": syntax error.');throw C.build('near "'+u.conditionType+'": syntax error.')}if(!ve.has(u.conditionType)){D.checkNotNull(u.fieldName,"The field name must not be null.");var c=this.naturalBaseRef.getDataModelHelper().getFieldInfoByName(i,u.fieldName);if(!c)throw C.build("The field name does not exist.");if(!we.has(u.conditionType)){if(!this.checkConditionTypeAndFieldType(u.conditionType,c.fieldType))throw C.build("The "+q[c.fieldType]+" type does not support the "+u.conditionType+" operation.");var l=D.convertArray(u.value);try{for(var d=(t=void 0,b(l)),p=d.next();!p.done;p=d.next()){var f=p.value;he.validateFieldValueForQuery(c.fieldType,f)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}}}}},e.prototype.checkConditionTypeAndFieldType=function(e,t){switch(e){case"EqualTo":case"NotEqualTo":return t!==q.ByteArray;case"GreaterThan":case"GreaterThanOrEqualTo":case"LessThan":case"LessThanOrEqualTo":case"In":return t!==q.Boolean&&t!==q.ByteArray;case"BeginWith":case"EndWith":case"Contain":return t===q.Text||t===q.String;default:return!1}},e.prototype.checkSubscribeQuery=function(e){this.checkQueryClass(e),this.checkSubscribeCondition(e.getQueryConditions(),e.getClassName())},e.prototype.checkSubscribeCondition=function(e,t){var n,r;this.checkSubscribeConditionSize(e);try{for(var o=b(e),i=o.next();!i.done;i=o.next()){var s=i.value;this.checkSubscribeConditionType(s,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype.checkSubscribeConditionSize=function(e){var t,n,r=e.length;if(r<1||r>30)throw be.warn("checkSubscribeCondition: invalid condition count: "+r),C.build("Query type exceeds the limit.");var o=0;try{for(var i=b(e),s=i.next();!s.done;s=i.next()){"EqualTo"===s.value.conditionType&&o++}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}if(o<1||o>5)throw be.warn("checkSubscribeCondition: invalid equalTo condition count: "+o),C.build("Invalid query object. Only support 1 to 5 equalTo conditions.")},e.prototype.checkSubscribeConditionType=function(e,t){if(!Se.has(e.conditionType))throw be.warn("checkSubscribeConditionType: not support condition: "+e.conditionType),C.build('Invalid query object. Only support EqualTo, BeginGroup, EndGroup, Or and "And" condition.');if(!ve.has(e.conditionType)){var n=this.naturalBaseRef.getDataModelHelper().getFieldInfoByName(t,e.fieldName);if(!n)throw C.build("The field name does not exist.");if(n.fieldType===q.Text)throw be.warn("checkSubscribeQuery: not support EqualTo condition on text field."),C.build("Invalid query object. Not support EqualTo condition on text field.")}},e.prototype.getDataModelHelper=function(){return this.naturalBaseRef.getDataModelHelper()},e.prototype.validOrAndCondition=function(e,t,n){if(!("Or"!==e.conditionType&&"And"!==e.conditionType||0!==n&&n!==t.length-1&&"BeginGroup"!==t[n-1].conditionType&&"Or"!==t[n-1].conditionType&&"And"!==t[n-1].conditionType))throw C.build('near "'+e.conditionType+'": syntax error.')},e.prototype.validBeginOrEndGroup=function(e,t,n,r){if("BeginGroup"===e.conditionType&&r++,"EndGroup"===e.conditionType){if(--r<0)throw C.build("The query beginGroup and endGroup should come in pairs with right direction.");var o=t[n-1].conditionType;if("BeginGroup"===o||"Or"===o||"And"===o)throw C.build('near "'+e.conditionType+'": syntax error.')}return r},e.prototype.addCondition=function(e,t,n,r){if(e.length>=30)throw C.build("Query type exceeds the limit.");var o={conditionType:t,fieldName:n,value:r};e.push(o)},e}();let Oe=n;Oe.util.Long=t,Oe.configure();const Ee=Oe.Reader,Ce=Oe.Writer,Ne=Oe.util,De=Oe.roots.default||(Oe.roots.default={}),Ae=De.naturalcloudsyncv2=(()=>{const e={};return e.Schema=function(){function e(e){if(this.fs=[],e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.n="",e.prototype.fs=Ne.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=Ce.create()),null!=e.n&&Object.hasOwnProperty.call(e,"n")&&t.uint32(10).string(e.n),null!=e.fs&&e.fs.length)for(let n=0;n<e.fs.length;++n)De.naturalcloudsyncv2.SchemaField.encode(e.fs[n],t.uint32(18).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.Schema;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.n=e.string();break;case 2:r.fs&&r.fs.length||(r.fs=[]),r.fs.push(De.naturalcloudsyncv2.SchemaField.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.n&&e.hasOwnProperty("n")&&!Ne.isString(e.n))return"n: string expected";if(null!=e.fs&&e.hasOwnProperty("fs")){if(!Array.isArray(e.fs))return"fs: array expected";for(let t=0;t<e.fs.length;++t){let n=De.naturalcloudsyncv2.SchemaField.verify(e.fs[t]);if(n)return"fs."+n}}return null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.Schema)return e;let t=new De.naturalcloudsyncv2.Schema;if(null!=e.n&&(t.n=String(e.n)),e.fs){if(!Array.isArray(e.fs))throw TypeError(".naturalcloudsyncv2.Schema.fs: array expected");t.fs=[];for(let n=0;n<e.fs.length;++n){if("object"!=typeof e.fs[n])throw TypeError(".naturalcloudsyncv2.Schema.fs: object expected");t.fs[n]=De.naturalcloudsyncv2.SchemaField.fromObject(e.fs[n])}}return t},e.toObject=function(e,t){t||(t={});let n={};if((t.arrays||t.defaults)&&(n.fs=[]),t.defaults&&(n.n=""),null!=e.n&&e.hasOwnProperty("n")&&(n.n=e.n),e.fs&&e.fs.length){n.fs=[];for(let r=0;r<e.fs.length;++r)n.fs[r]=De.naturalcloudsyncv2.SchemaField.toObject(e.fs[r],t)}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.Schema"},e}(),e.SchemaField=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}let t;return e.prototype.n="",e.prototype.t=0,e.prototype.p=!1,e.prototype.e=!1,e.prototype.nn=!1,e.prototype.df=!1,e.prototype.bl=null,e.prototype.b=null,e.prototype.st=null,e.prototype.i=null,e.prototype.l=null,e.prototype.f=null,e.prototype.d=null,e.prototype.ba=null,e.prototype.s=null,Object.defineProperty(e.prototype,"defaultValue",{get:Ne.oneOfGetter(t=["bl","b","st","i","l","f","d","ba","s"]),set:Ne.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.n&&Object.hasOwnProperty.call(e,"n")&&t.uint32(10).string(e.n),null!=e.t&&Object.hasOwnProperty.call(e,"t")&&t.uint32(16).int32(e.t),null!=e.p&&Object.hasOwnProperty.call(e,"p")&&t.uint32(24).bool(e.p),null!=e.e&&Object.hasOwnProperty.call(e,"e")&&t.uint32(32).bool(e.e),null!=e.nn&&Object.hasOwnProperty.call(e,"nn")&&t.uint32(40).bool(e.nn),null!=e.df&&Object.hasOwnProperty.call(e,"df")&&t.uint32(48).bool(e.df),null!=e.bl&&Object.hasOwnProperty.call(e,"bl")&&t.uint32(56).bool(e.bl),null!=e.b&&Object.hasOwnProperty.call(e,"b")&&t.uint32(64).int32(e.b),null!=e.st&&Object.hasOwnProperty.call(e,"st")&&t.uint32(72).int32(e.st),null!=e.i&&Object.hasOwnProperty.call(e,"i")&&t.uint32(80).int32(e.i),null!=e.l&&Object.hasOwnProperty.call(e,"l")&&t.uint32(88).int64(e.l),null!=e.f&&Object.hasOwnProperty.call(e,"f")&&t.uint32(101).float(e.f),null!=e.d&&Object.hasOwnProperty.call(e,"d")&&t.uint32(105).double(e.d),null!=e.ba&&Object.hasOwnProperty.call(e,"ba")&&t.uint32(114).bytes(e.ba),null!=e.s&&Object.hasOwnProperty.call(e,"s")&&t.uint32(122).string(e.s),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.SchemaField;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.n=e.string();break;case 2:r.t=e.int32();break;case 3:r.p=e.bool();break;case 4:r.e=e.bool();break;case 5:r.nn=e.bool();break;case 6:r.df=e.bool();break;case 7:r.bl=e.bool();break;case 8:r.b=e.int32();break;case 9:r.st=e.int32();break;case 10:r.i=e.int32();break;case 11:r.l=e.int64();break;case 12:r.f=e.float();break;case 13:r.d=e.double();break;case 14:r.ba=e.bytes();break;case 15:r.s=e.string();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";let t={};if(null!=e.n&&e.hasOwnProperty("n")&&!Ne.isString(e.n))return"n: string expected";if(null!=e.t&&e.hasOwnProperty("t"))switch(e.t){default:return"t: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:}if(null!=e.p&&e.hasOwnProperty("p")&&"boolean"!=typeof e.p)return"p: boolean expected";if(null!=e.e&&e.hasOwnProperty("e")&&"boolean"!=typeof e.e)return"e: boolean expected";if(null!=e.nn&&e.hasOwnProperty("nn")&&"boolean"!=typeof e.nn)return"nn: boolean expected";if(null!=e.df&&e.hasOwnProperty("df")&&"boolean"!=typeof e.df)return"df: boolean expected";if(null!=e.bl&&e.hasOwnProperty("bl")&&(t.defaultValue=1,"boolean"!=typeof e.bl))return"bl: boolean expected";if(null!=e.b&&e.hasOwnProperty("b")){if(1===t.defaultValue)return"defaultValue: multiple values";if(t.defaultValue=1,!Ne.isInteger(e.b))return"b: integer expected"}if(null!=e.st&&e.hasOwnProperty("st")){if(1===t.defaultValue)return"defaultValue: multiple values";if(t.defaultValue=1,!Ne.isInteger(e.st))return"st: integer expected"}if(null!=e.i&&e.hasOwnProperty("i")){if(1===t.defaultValue)return"defaultValue: multiple values";if(t.defaultValue=1,!Ne.isInteger(e.i))return"i: integer expected"}if(null!=e.l&&e.hasOwnProperty("l")){if(1===t.defaultValue)return"defaultValue: multiple values";if(t.defaultValue=1,!(Ne.isInteger(e.l)||e.l&&Ne.isInteger(e.l.low)&&Ne.isInteger(e.l.high)))return"l: integer|Long expected"}if(null!=e.f&&e.hasOwnProperty("f")){if(1===t.defaultValue)return"defaultValue: multiple values";if(t.defaultValue=1,"number"!=typeof e.f)return"f: number expected"}if(null!=e.d&&e.hasOwnProperty("d")){if(1===t.defaultValue)return"defaultValue: multiple values";if(t.defaultValue=1,"number"!=typeof e.d)return"d: number expected"}if(null!=e.ba&&e.hasOwnProperty("ba")){if(1===t.defaultValue)return"defaultValue: multiple values";if(t.defaultValue=1,!(e.ba&&"number"==typeof e.ba.length||Ne.isString(e.ba)))return"ba: buffer expected"}if(null!=e.s&&e.hasOwnProperty("s")){if(1===t.defaultValue)return"defaultValue: multiple values";if(t.defaultValue=1,!Ne.isString(e.s))return"s: string expected"}return null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.SchemaField)return e;let t=new De.naturalcloudsyncv2.SchemaField;switch(null!=e.n&&(t.n=String(e.n)),e.t){default:if("number"==typeof e.t){t.t=e.t;break}break;case"TYPE_DEFAULT":case 0:t.t=0;break;case"TYPE_BOOLEAN":case 1:t.t=1;break;case"TYPE_BYTE":case 2:t.t=2;break;case"TYPE_SHORT":case 3:t.t=3;break;case"TYPE_INT32":case 4:t.t=4;break;case"TYPE_LONG":case 5:t.t=5;break;case"TYPE_FLOAT":case 6:t.t=6;break;case"TYPE_DOUBLE":case 7:t.t=7;break;case"TYPE_BYTE_ARRAY":case 8:t.t=8;break;case"TYPE_STRING":case 9:t.t=9;break;case"TYPE_DATE":case 10:t.t=10;break;case"TYPE_TEXT":case 11:t.t=11;break;case"TYPE_AUTO_INCREMENT_INT":case 12:t.t=12;break;case"TYPE_AUTO_INCREMENT_LONG":case 13:t.t=13}return null!=e.p&&(t.p=Boolean(e.p)),null!=e.e&&(t.e=Boolean(e.e)),null!=e.nn&&(t.nn=Boolean(e.nn)),null!=e.df&&(t.df=Boolean(e.df)),null!=e.bl&&(t.bl=Boolean(e.bl)),null!=e.b&&(t.b=0|e.b),null!=e.st&&(t.st=0|e.st),null!=e.i&&(t.i=0|e.i),null!=e.l&&(Ne.Long?(t.l=Ne.Long.fromValue(e.l)).unsigned=!1:"string"==typeof e.l?t.l=parseInt(e.l,10):"number"==typeof e.l?t.l=e.l:"object"==typeof e.l&&(t.l=new Ne.LongBits(e.l.low>>>0,e.l.high>>>0).toNumber())),null!=e.f&&(t.f=Number(e.f)),null!=e.d&&(t.d=Number(e.d)),null!=e.ba&&("string"==typeof e.ba?Ne.base64.decode(e.ba,t.ba=Ne.newBuffer(Ne.base64.length(e.ba)),0):e.ba.length>=0&&(t.ba=e.ba)),null!=e.s&&(t.s=String(e.s)),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.n="",n.t=t.enums===String?"TYPE_DEFAULT":0,n.p=!1,n.e=!1,n.nn=!1,n.df=!1),null!=e.n&&e.hasOwnProperty("n")&&(n.n=e.n),null!=e.t&&e.hasOwnProperty("t")&&(n.t=t.enums===String?void 0===De.naturalcloudsyncv2.FieldType[e.t]?e.t:De.naturalcloudsyncv2.FieldType[e.t]:e.t),null!=e.p&&e.hasOwnProperty("p")&&(n.p=e.p),null!=e.e&&e.hasOwnProperty("e")&&(n.e=e.e),null!=e.nn&&e.hasOwnProperty("nn")&&(n.nn=e.nn),null!=e.df&&e.hasOwnProperty("df")&&(n.df=e.df),null!=e.bl&&e.hasOwnProperty("bl")&&(n.bl=e.bl,t.oneofs&&(n.defaultValue="bl")),null!=e.b&&e.hasOwnProperty("b")&&(n.b=e.b,t.oneofs&&(n.defaultValue="b")),null!=e.st&&e.hasOwnProperty("st")&&(n.st=e.st,t.oneofs&&(n.defaultValue="st")),null!=e.i&&e.hasOwnProperty("i")&&(n.i=e.i,t.oneofs&&(n.defaultValue="i")),null!=e.l&&e.hasOwnProperty("l")&&("number"==typeof e.l?n.l=t.longs===String?String(e.l):e.l:n.l=t.longs===String?Ne.Long.prototype.toString.call(e.l):t.longs===Number?new Ne.LongBits(e.l.low>>>0,e.l.high>>>0).toNumber():e.l,t.oneofs&&(n.defaultValue="l")),null!=e.f&&e.hasOwnProperty("f")&&(n.f=t.json&&!isFinite(e.f)?String(e.f):e.f,t.oneofs&&(n.defaultValue="f")),null!=e.d&&e.hasOwnProperty("d")&&(n.d=t.json&&!isFinite(e.d)?String(e.d):e.d,t.oneofs&&(n.defaultValue="d")),null!=e.ba&&e.hasOwnProperty("ba")&&(n.ba=t.bytes===String?Ne.base64.encode(e.ba,0,e.ba.length):t.bytes===Array?Array.prototype.slice.call(e.ba):e.ba,t.oneofs&&(n.defaultValue="ba")),null!=e.s&&e.hasOwnProperty("s")&&(n.s=e.s,t.oneofs&&(n.defaultValue="s")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.SchemaField"},e}(),e.FieldType=function(){const e={},t=Object.create(e);return t[e[0]="TYPE_DEFAULT"]=0,t[e[1]="TYPE_BOOLEAN"]=1,t[e[2]="TYPE_BYTE"]=2,t[e[3]="TYPE_SHORT"]=3,t[e[4]="TYPE_INT32"]=4,t[e[5]="TYPE_LONG"]=5,t[e[6]="TYPE_FLOAT"]=6,t[e[7]="TYPE_DOUBLE"]=7,t[e[8]="TYPE_BYTE_ARRAY"]=8,t[e[9]="TYPE_STRING"]=9,t[e[10]="TYPE_DATE"]=10,t[e[11]="TYPE_TEXT"]=11,t[e[12]="TYPE_AUTO_INCREMENT_INT"]=12,t[e[13]="TYPE_AUTO_INCREMENT_LONG"]=13,t}(),e.OperationData=function(){function e(e){if(this.os=[],e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.os=Ne.emptyArray,e.prototype.t=0,e.prototype.i=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=Ce.create()),null!=e.os&&e.os.length)for(let n=0;n<e.os.length;++n)De.naturalcloudsyncv2.Obj.encode(e.os[n],t.uint32(10).fork()).ldelim();return null!=e.t&&Object.hasOwnProperty.call(e,"t")&&t.uint32(16).int32(e.t),null!=e.i&&Object.hasOwnProperty.call(e,"i")&&t.uint32(24).int32(e.i),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.OperationData;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.os&&r.os.length||(r.os=[]),r.os.push(De.naturalcloudsyncv2.Obj.decode(e,e.uint32()));break;case 2:r.t=e.int32();break;case 3:r.i=e.int32();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.os&&e.hasOwnProperty("os")){if(!Array.isArray(e.os))return"os: array expected";for(let t=0;t<e.os.length;++t){let n=De.naturalcloudsyncv2.Obj.verify(e.os[t]);if(n)return"os."+n}}return null!=e.t&&e.hasOwnProperty("t")&&!Ne.isInteger(e.t)?"t: integer expected":null!=e.i&&e.hasOwnProperty("i")&&!Ne.isInteger(e.i)?"i: integer expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.OperationData)return e;let t=new De.naturalcloudsyncv2.OperationData;if(e.os){if(!Array.isArray(e.os))throw TypeError(".naturalcloudsyncv2.OperationData.os: array expected");t.os=[];for(let n=0;n<e.os.length;++n){if("object"!=typeof e.os[n])throw TypeError(".naturalcloudsyncv2.OperationData.os: object expected");t.os[n]=De.naturalcloudsyncv2.Obj.fromObject(e.os[n])}}return null!=e.t&&(t.t=0|e.t),null!=e.i&&(t.i=0|e.i),t},e.toObject=function(e,t){t||(t={});let n={};if((t.arrays||t.defaults)&&(n.os=[]),t.defaults&&(n.t=0,n.i=0),e.os&&e.os.length){n.os=[];for(let r=0;r<e.os.length;++r)n.os[r]=De.naturalcloudsyncv2.Obj.toObject(e.os[r],t)}return null!=e.t&&e.hasOwnProperty("t")&&(n.t=e.t),null!=e.i&&e.hasOwnProperty("i")&&(n.i=e.i),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.OperationData"},e}(),e.Obj=function(){function e(e){if(this.fs=[],e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.fs=Ne.emptyArray,e.prototype.i=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=Ce.create()),null!=e.fs&&e.fs.length)for(let n=0;n<e.fs.length;++n)De.naturalcloudsyncv2.Field.encode(e.fs[n],t.uint32(10).fork()).ldelim();return null!=e.i&&Object.hasOwnProperty.call(e,"i")&&t.uint32(16).int32(e.i),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.Obj;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.fs&&r.fs.length||(r.fs=[]),r.fs.push(De.naturalcloudsyncv2.Field.decode(e,e.uint32()));break;case 2:r.i=e.int32();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.fs&&e.hasOwnProperty("fs")){if(!Array.isArray(e.fs))return"fs: array expected";for(let t=0;t<e.fs.length;++t){let n=De.naturalcloudsyncv2.Field.verify(e.fs[t]);if(n)return"fs."+n}}return null!=e.i&&e.hasOwnProperty("i")&&!Ne.isInteger(e.i)?"i: integer expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.Obj)return e;let t=new De.naturalcloudsyncv2.Obj;if(e.fs){if(!Array.isArray(e.fs))throw TypeError(".naturalcloudsyncv2.Obj.fs: array expected");t.fs=[];for(let n=0;n<e.fs.length;++n){if("object"!=typeof e.fs[n])throw TypeError(".naturalcloudsyncv2.Obj.fs: object expected");t.fs[n]=De.naturalcloudsyncv2.Field.fromObject(e.fs[n])}}return null!=e.i&&(t.i=0|e.i),t},e.toObject=function(e,t){t||(t={});let n={};if((t.arrays||t.defaults)&&(n.fs=[]),t.defaults&&(n.i=0),e.fs&&e.fs.length){n.fs=[];for(let r=0;r<e.fs.length;++r)n.fs[r]=De.naturalcloudsyncv2.Field.toObject(e.fs[r],t)}return null!=e.i&&e.hasOwnProperty("i")&&(n.i=e.i),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.Obj"},e}(),e.Field=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}let t;return e.prototype.n=!1,e.prototype.bl=null,e.prototype.b=null,e.prototype.st=null,e.prototype.i=null,e.prototype.l=null,e.prototype.f=null,e.prototype.d=null,e.prototype.ba=null,e.prototype.s=null,Object.defineProperty(e.prototype,"value",{get:Ne.oneOfGetter(t=["bl","b","st","i","l","f","d","ba","s"]),set:Ne.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.n&&Object.hasOwnProperty.call(e,"n")&&t.uint32(8).bool(e.n),null!=e.bl&&Object.hasOwnProperty.call(e,"bl")&&t.uint32(16).bool(e.bl),null!=e.b&&Object.hasOwnProperty.call(e,"b")&&t.uint32(24).int32(e.b),null!=e.st&&Object.hasOwnProperty.call(e,"st")&&t.uint32(32).int32(e.st),null!=e.i&&Object.hasOwnProperty.call(e,"i")&&t.uint32(40).int32(e.i),null!=e.l&&Object.hasOwnProperty.call(e,"l")&&t.uint32(48).int64(e.l),null!=e.f&&Object.hasOwnProperty.call(e,"f")&&t.uint32(61).float(e.f),null!=e.d&&Object.hasOwnProperty.call(e,"d")&&t.uint32(65).double(e.d),null!=e.ba&&Object.hasOwnProperty.call(e,"ba")&&t.uint32(74).bytes(e.ba),null!=e.s&&Object.hasOwnProperty.call(e,"s")&&t.uint32(82).string(e.s),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.Field;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.n=e.bool();break;case 2:r.bl=e.bool();break;case 3:r.b=e.int32();break;case 4:r.st=e.int32();break;case 5:r.i=e.int32();break;case 6:r.l=e.int64();break;case 7:r.f=e.float();break;case 8:r.d=e.double();break;case 9:r.ba=e.bytes();break;case 10:r.s=e.string();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";let t={};if(null!=e.n&&e.hasOwnProperty("n")&&"boolean"!=typeof e.n)return"n: boolean expected";if(null!=e.bl&&e.hasOwnProperty("bl")&&(t.value=1,"boolean"!=typeof e.bl))return"bl: boolean expected";if(null!=e.b&&e.hasOwnProperty("b")){if(1===t.value)return"value: multiple values";if(t.value=1,!Ne.isInteger(e.b))return"b: integer expected"}if(null!=e.st&&e.hasOwnProperty("st")){if(1===t.value)return"value: multiple values";if(t.value=1,!Ne.isInteger(e.st))return"st: integer expected"}if(null!=e.i&&e.hasOwnProperty("i")){if(1===t.value)return"value: multiple values";if(t.value=1,!Ne.isInteger(e.i))return"i: integer expected"}if(null!=e.l&&e.hasOwnProperty("l")){if(1===t.value)return"value: multiple values";if(t.value=1,!(Ne.isInteger(e.l)||e.l&&Ne.isInteger(e.l.low)&&Ne.isInteger(e.l.high)))return"l: integer|Long expected"}if(null!=e.f&&e.hasOwnProperty("f")){if(1===t.value)return"value: multiple values";if(t.value=1,"number"!=typeof e.f)return"f: number expected"}if(null!=e.d&&e.hasOwnProperty("d")){if(1===t.value)return"value: multiple values";if(t.value=1,"number"!=typeof e.d)return"d: number expected"}if(null!=e.ba&&e.hasOwnProperty("ba")){if(1===t.value)return"value: multiple values";if(t.value=1,!(e.ba&&"number"==typeof e.ba.length||Ne.isString(e.ba)))return"ba: buffer expected"}if(null!=e.s&&e.hasOwnProperty("s")){if(1===t.value)return"value: multiple values";if(t.value=1,!Ne.isString(e.s))return"s: string expected"}return null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.Field)return e;let t=new De.naturalcloudsyncv2.Field;return null!=e.n&&(t.n=Boolean(e.n)),null!=e.bl&&(t.bl=Boolean(e.bl)),null!=e.b&&(t.b=0|e.b),null!=e.st&&(t.st=0|e.st),null!=e.i&&(t.i=0|e.i),null!=e.l&&(Ne.Long?(t.l=Ne.Long.fromValue(e.l)).unsigned=!1:"string"==typeof e.l?t.l=parseInt(e.l,10):"number"==typeof e.l?t.l=e.l:"object"==typeof e.l&&(t.l=new Ne.LongBits(e.l.low>>>0,e.l.high>>>0).toNumber())),null!=e.f&&(t.f=Number(e.f)),null!=e.d&&(t.d=Number(e.d)),null!=e.ba&&("string"==typeof e.ba?Ne.base64.decode(e.ba,t.ba=Ne.newBuffer(Ne.base64.length(e.ba)),0):e.ba.length>=0&&(t.ba=e.ba)),null!=e.s&&(t.s=String(e.s)),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.n=!1),null!=e.n&&e.hasOwnProperty("n")&&(n.n=e.n),null!=e.bl&&e.hasOwnProperty("bl")&&(n.bl=e.bl,t.oneofs&&(n.value="bl")),null!=e.b&&e.hasOwnProperty("b")&&(n.b=e.b,t.oneofs&&(n.value="b")),null!=e.st&&e.hasOwnProperty("st")&&(n.st=e.st,t.oneofs&&(n.value="st")),null!=e.i&&e.hasOwnProperty("i")&&(n.i=e.i,t.oneofs&&(n.value="i")),null!=e.l&&e.hasOwnProperty("l")&&("number"==typeof e.l?n.l=t.longs===String?String(e.l):e.l:n.l=t.longs===String?Ne.Long.prototype.toString.call(e.l):t.longs===Number?new Ne.LongBits(e.l.low>>>0,e.l.high>>>0).toNumber():e.l,t.oneofs&&(n.value="l")),null!=e.f&&e.hasOwnProperty("f")&&(n.f=t.json&&!isFinite(e.f)?String(e.f):e.f,t.oneofs&&(n.value="f")),null!=e.d&&e.hasOwnProperty("d")&&(n.d=t.json&&!isFinite(e.d)?String(e.d):e.d,t.oneofs&&(n.value="d")),null!=e.ba&&e.hasOwnProperty("ba")&&(n.ba=t.bytes===String?Ne.base64.encode(e.ba,0,e.ba.length):t.bytes===Array?Array.prototype.slice.call(e.ba):e.ba,t.oneofs&&(n.value="ba")),null!=e.s&&e.hasOwnProperty("s")&&(n.s=e.s,t.oneofs&&(n.value="s")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.Field"},e}(),e.MessageInfo=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id=Ne.Long?Ne.Long.fromBits(0,0,!1):0,e.prototype.type=0,e.prototype.subType=0,e.prototype.opStore=null,e.prototype.traceId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&t.uint32(8).int64(e.id),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(16).int32(e.type),null!=e.subType&&Object.hasOwnProperty.call(e,"subType")&&t.uint32(24).int32(e.subType),null!=e.opStore&&Object.hasOwnProperty.call(e,"opStore")&&De.naturalcloudsyncv2.Store.encode(e.opStore,t.uint32(34).fork()).ldelim(),null!=e.traceId&&Object.hasOwnProperty.call(e,"traceId")&&t.uint32(42).string(e.traceId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.MessageInfo;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.id=e.int64();break;case 2:r.type=e.int32();break;case 3:r.subType=e.int32();break;case 4:r.opStore=De.naturalcloudsyncv2.Store.decode(e,e.uint32());break;case 5:r.traceId=e.string();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!(Ne.isInteger(e.id)||e.id&&Ne.isInteger(e.id.low)&&Ne.isInteger(e.id.high)))return"id: integer|Long expected";if(null!=e.type&&e.hasOwnProperty("type")&&!Ne.isInteger(e.type))return"type: integer expected";if(null!=e.subType&&e.hasOwnProperty("subType")&&!Ne.isInteger(e.subType))return"subType: integer expected";if(null!=e.opStore&&e.hasOwnProperty("opStore")){let t=De.naturalcloudsyncv2.Store.verify(e.opStore);if(t)return"opStore."+t}return null!=e.traceId&&e.hasOwnProperty("traceId")&&!Ne.isString(e.traceId)?"traceId: string expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.MessageInfo)return e;let t=new De.naturalcloudsyncv2.MessageInfo;if(null!=e.id&&(Ne.Long?(t.id=Ne.Long.fromValue(e.id)).unsigned=!1:"string"==typeof e.id?t.id=parseInt(e.id,10):"number"==typeof e.id?t.id=e.id:"object"==typeof e.id&&(t.id=new Ne.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber())),null!=e.type&&(t.type=0|e.type),null!=e.subType&&(t.subType=0|e.subType),null!=e.opStore){if("object"!=typeof e.opStore)throw TypeError(".naturalcloudsyncv2.MessageInfo.opStore: object expected");t.opStore=De.naturalcloudsyncv2.Store.fromObject(e.opStore)}return null!=e.traceId&&(t.traceId=String(e.traceId)),t},e.toObject=function(e,t){t||(t={});let n={};if(t.defaults){if(Ne.Long){let e=new Ne.Long(0,0,!1);n.id=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else n.id=t.longs===String?"0":0;n.type=0,n.subType=0,n.opStore=null,n.traceId=""}return null!=e.id&&e.hasOwnProperty("id")&&("number"==typeof e.id?n.id=t.longs===String?String(e.id):e.id:n.id=t.longs===String?Ne.Long.prototype.toString.call(e.id):t.longs===Number?new Ne.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber():e.id),null!=e.type&&e.hasOwnProperty("type")&&(n.type=e.type),null!=e.subType&&e.hasOwnProperty("subType")&&(n.subType=e.subType),null!=e.opStore&&e.hasOwnProperty("opStore")&&(n.opStore=De.naturalcloudsyncv2.Store.toObject(e.opStore,t)),null!=e.traceId&&e.hasOwnProperty("traceId")&&(n.traceId=e.traceId),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.MessageInfo"},e}(),e.Store=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.storeName="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.storeName&&Object.hasOwnProperty.call(e,"storeName")&&t.uint32(10).string(e.storeName),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.Store;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.storeName=e.string();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.storeName&&e.hasOwnProperty("storeName")&&!Ne.isString(e.storeName)?"storeName: string expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.Store)return e;let t=new De.naturalcloudsyncv2.Store;return null!=e.storeName&&(t.storeName=String(e.storeName)),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.storeName=""),null!=e.storeName&&e.hasOwnProperty("storeName")&&(n.storeName=e.storeName),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.Store"},e}(),e.EncryptionInfo=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.keyStatus=0,e.prototype.firstSalt=Ne.newBuffer([]),e.prototype.secondSalt=Ne.newBuffer([]),e.prototype.rootToken=Ne.newBuffer([]),e.prototype.cipherText=Ne.newBuffer([]),e.prototype.oldCipherText=Ne.newBuffer([]),e.prototype.keyVer=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.keyStatus&&Object.hasOwnProperty.call(e,"keyStatus")&&t.uint32(8).int32(e.keyStatus),null!=e.firstSalt&&Object.hasOwnProperty.call(e,"firstSalt")&&t.uint32(18).bytes(e.firstSalt),null!=e.secondSalt&&Object.hasOwnProperty.call(e,"secondSalt")&&t.uint32(26).bytes(e.secondSalt),null!=e.rootToken&&Object.hasOwnProperty.call(e,"rootToken")&&t.uint32(34).bytes(e.rootToken),null!=e.cipherText&&Object.hasOwnProperty.call(e,"cipherText")&&t.uint32(42).bytes(e.cipherText),null!=e.oldCipherText&&Object.hasOwnProperty.call(e,"oldCipherText")&&t.uint32(50).bytes(e.oldCipherText),null!=e.keyVer&&Object.hasOwnProperty.call(e,"keyVer")&&t.uint32(56).int32(e.keyVer),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.EncryptionInfo;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.keyStatus=e.int32();break;case 2:r.firstSalt=e.bytes();break;case 3:r.secondSalt=e.bytes();break;case 4:r.rootToken=e.bytes();break;case 5:r.cipherText=e.bytes();break;case 6:r.oldCipherText=e.bytes();break;case 7:r.keyVer=e.int32();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.keyStatus&&e.hasOwnProperty("keyStatus")&&!Ne.isInteger(e.keyStatus)?"keyStatus: integer expected":null!=e.firstSalt&&e.hasOwnProperty("firstSalt")&&!(e.firstSalt&&"number"==typeof e.firstSalt.length||Ne.isString(e.firstSalt))?"firstSalt: buffer expected":null!=e.secondSalt&&e.hasOwnProperty("secondSalt")&&!(e.secondSalt&&"number"==typeof e.secondSalt.length||Ne.isString(e.secondSalt))?"secondSalt: buffer expected":null!=e.rootToken&&e.hasOwnProperty("rootToken")&&!(e.rootToken&&"number"==typeof e.rootToken.length||Ne.isString(e.rootToken))?"rootToken: buffer expected":null!=e.cipherText&&e.hasOwnProperty("cipherText")&&!(e.cipherText&&"number"==typeof e.cipherText.length||Ne.isString(e.cipherText))?"cipherText: buffer expected":null!=e.oldCipherText&&e.hasOwnProperty("oldCipherText")&&!(e.oldCipherText&&"number"==typeof e.oldCipherText.length||Ne.isString(e.oldCipherText))?"oldCipherText: buffer expected":null!=e.keyVer&&e.hasOwnProperty("keyVer")&&!Ne.isInteger(e.keyVer)?"keyVer: integer expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.EncryptionInfo)return e;let t=new De.naturalcloudsyncv2.EncryptionInfo;return null!=e.keyStatus&&(t.keyStatus=0|e.keyStatus),null!=e.firstSalt&&("string"==typeof e.firstSalt?Ne.base64.decode(e.firstSalt,t.firstSalt=Ne.newBuffer(Ne.base64.length(e.firstSalt)),0):e.firstSalt.length>=0&&(t.firstSalt=e.firstSalt)),null!=e.secondSalt&&("string"==typeof e.secondSalt?Ne.base64.decode(e.secondSalt,t.secondSalt=Ne.newBuffer(Ne.base64.length(e.secondSalt)),0):e.secondSalt.length>=0&&(t.secondSalt=e.secondSalt)),null!=e.rootToken&&("string"==typeof e.rootToken?Ne.base64.decode(e.rootToken,t.rootToken=Ne.newBuffer(Ne.base64.length(e.rootToken)),0):e.rootToken.length>=0&&(t.rootToken=e.rootToken)),null!=e.cipherText&&("string"==typeof e.cipherText?Ne.base64.decode(e.cipherText,t.cipherText=Ne.newBuffer(Ne.base64.length(e.cipherText)),0):e.cipherText.length>=0&&(t.cipherText=e.cipherText)),null!=e.oldCipherText&&("string"==typeof e.oldCipherText?Ne.base64.decode(e.oldCipherText,t.oldCipherText=Ne.newBuffer(Ne.base64.length(e.oldCipherText)),0):e.oldCipherText.length>=0&&(t.oldCipherText=e.oldCipherText)),null!=e.keyVer&&(t.keyVer=0|e.keyVer),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.keyStatus=0,t.bytes===String?n.firstSalt="":(n.firstSalt=[],t.bytes!==Array&&(n.firstSalt=Ne.newBuffer(n.firstSalt))),t.bytes===String?n.secondSalt="":(n.secondSalt=[],t.bytes!==Array&&(n.secondSalt=Ne.newBuffer(n.secondSalt))),t.bytes===String?n.rootToken="":(n.rootToken=[],t.bytes!==Array&&(n.rootToken=Ne.newBuffer(n.rootToken))),t.bytes===String?n.cipherText="":(n.cipherText=[],t.bytes!==Array&&(n.cipherText=Ne.newBuffer(n.cipherText))),t.bytes===String?n.oldCipherText="":(n.oldCipherText=[],t.bytes!==Array&&(n.oldCipherText=Ne.newBuffer(n.oldCipherText))),n.keyVer=0),null!=e.keyStatus&&e.hasOwnProperty("keyStatus")&&(n.keyStatus=e.keyStatus),null!=e.firstSalt&&e.hasOwnProperty("firstSalt")&&(n.firstSalt=t.bytes===String?Ne.base64.encode(e.firstSalt,0,e.firstSalt.length):t.bytes===Array?Array.prototype.slice.call(e.firstSalt):e.firstSalt),null!=e.secondSalt&&e.hasOwnProperty("secondSalt")&&(n.secondSalt=t.bytes===String?Ne.base64.encode(e.secondSalt,0,e.secondSalt.length):t.bytes===Array?Array.prototype.slice.call(e.secondSalt):e.secondSalt),null!=e.rootToken&&e.hasOwnProperty("rootToken")&&(n.rootToken=t.bytes===String?Ne.base64.encode(e.rootToken,0,e.rootToken.length):t.bytes===Array?Array.prototype.slice.call(e.rootToken):e.rootToken),null!=e.cipherText&&e.hasOwnProperty("cipherText")&&(n.cipherText=t.bytes===String?Ne.base64.encode(e.cipherText,0,e.cipherText.length):t.bytes===Array?Array.prototype.slice.call(e.cipherText):e.cipherText),null!=e.oldCipherText&&e.hasOwnProperty("oldCipherText")&&(n.oldCipherText=t.bytes===String?Ne.base64.encode(e.oldCipherText,0,e.oldCipherText.length):t.bytes===Array?Array.prototype.slice.call(e.oldCipherText):e.oldCipherText),null!=e.keyVer&&e.hasOwnProperty("keyVer")&&(n.keyVer=e.keyVer),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.EncryptionInfo"},e}(),e.SyncRequestMessage=function(){function e(e){if(this.schemas=[],this.opData=[],this.subReqMsg=[],this.unSubReqMsg=[],this.enReqInfo=[],e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.msgInfo=null,e.prototype.clientInfo=null,e.prototype.schemas=Ne.emptyArray,e.prototype.opData=Ne.emptyArray,e.prototype.queryReqMsg=null,e.prototype.subReqMsg=Ne.emptyArray,e.prototype.unSubReqMsg=Ne.emptyArray,e.prototype.enReqInfo=Ne.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=Ce.create()),null!=e.msgInfo&&Object.hasOwnProperty.call(e,"msgInfo")&&De.naturalcloudsyncv2.MessageInfo.encode(e.msgInfo,t.uint32(10).fork()).ldelim(),null!=e.clientInfo&&Object.hasOwnProperty.call(e,"clientInfo")&&De.naturalcloudsyncv2.ClientInfo.encode(e.clientInfo,t.uint32(18).fork()).ldelim(),null!=e.schemas&&e.schemas.length)for(let n=0;n<e.schemas.length;++n)De.naturalcloudsyncv2.Schema.encode(e.schemas[n],t.uint32(26).fork()).ldelim();if(null!=e.opData&&e.opData.length)for(let n=0;n<e.opData.length;++n)De.naturalcloudsyncv2.OperationData.encode(e.opData[n],t.uint32(34).fork()).ldelim();if(null!=e.queryReqMsg&&Object.hasOwnProperty.call(e,"queryReqMsg")&&De.naturalcloudsyncv2.QueryRequestMessage.encode(e.queryReqMsg,t.uint32(42).fork()).ldelim(),null!=e.subReqMsg&&e.subReqMsg.length)for(let n=0;n<e.subReqMsg.length;++n)De.naturalcloudsyncv2.SubscribeRequestMessage.encode(e.subReqMsg[n],t.uint32(50).fork()).ldelim();if(null!=e.unSubReqMsg&&e.unSubReqMsg.length)for(let n=0;n<e.unSubReqMsg.length;++n)De.naturalcloudsyncv2.UnsubscribeRequestMessage.encode(e.unSubReqMsg[n],t.uint32(58).fork()).ldelim();if(null!=e.enReqInfo&&e.enReqInfo.length)for(let n=0;n<e.enReqInfo.length;++n)De.naturalcloudsyncv2.EncryptionInfo.encode(e.enReqInfo[n],t.uint32(66).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.SyncRequestMessage;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.msgInfo=De.naturalcloudsyncv2.MessageInfo.decode(e,e.uint32());break;case 2:r.clientInfo=De.naturalcloudsyncv2.ClientInfo.decode(e,e.uint32());break;case 3:r.schemas&&r.schemas.length||(r.schemas=[]),r.schemas.push(De.naturalcloudsyncv2.Schema.decode(e,e.uint32()));break;case 4:r.opData&&r.opData.length||(r.opData=[]),r.opData.push(De.naturalcloudsyncv2.OperationData.decode(e,e.uint32()));break;case 5:r.queryReqMsg=De.naturalcloudsyncv2.QueryRequestMessage.decode(e,e.uint32());break;case 6:r.subReqMsg&&r.subReqMsg.length||(r.subReqMsg=[]),r.subReqMsg.push(De.naturalcloudsyncv2.SubscribeRequestMessage.decode(e,e.uint32()));break;case 7:r.unSubReqMsg&&r.unSubReqMsg.length||(r.unSubReqMsg=[]),r.unSubReqMsg.push(De.naturalcloudsyncv2.UnsubscribeRequestMessage.decode(e,e.uint32()));break;case 8:r.enReqInfo&&r.enReqInfo.length||(r.enReqInfo=[]),r.enReqInfo.push(De.naturalcloudsyncv2.EncryptionInfo.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.msgInfo&&e.hasOwnProperty("msgInfo")){let t=De.naturalcloudsyncv2.MessageInfo.verify(e.msgInfo);if(t)return"msgInfo."+t}if(null!=e.clientInfo&&e.hasOwnProperty("clientInfo")){let t=De.naturalcloudsyncv2.ClientInfo.verify(e.clientInfo);if(t)return"clientInfo."+t}if(null!=e.schemas&&e.hasOwnProperty("schemas")){if(!Array.isArray(e.schemas))return"schemas: array expected";for(let t=0;t<e.schemas.length;++t){let n=De.naturalcloudsyncv2.Schema.verify(e.schemas[t]);if(n)return"schemas."+n}}if(null!=e.opData&&e.hasOwnProperty("opData")){if(!Array.isArray(e.opData))return"opData: array expected";for(let t=0;t<e.opData.length;++t){let n=De.naturalcloudsyncv2.OperationData.verify(e.opData[t]);if(n)return"opData."+n}}if(null!=e.queryReqMsg&&e.hasOwnProperty("queryReqMsg")){let t=De.naturalcloudsyncv2.QueryRequestMessage.verify(e.queryReqMsg);if(t)return"queryReqMsg."+t}if(null!=e.subReqMsg&&e.hasOwnProperty("subReqMsg")){if(!Array.isArray(e.subReqMsg))return"subReqMsg: array expected";for(let t=0;t<e.subReqMsg.length;++t){let n=De.naturalcloudsyncv2.SubscribeRequestMessage.verify(e.subReqMsg[t]);if(n)return"subReqMsg."+n}}if(null!=e.unSubReqMsg&&e.hasOwnProperty("unSubReqMsg")){if(!Array.isArray(e.unSubReqMsg))return"unSubReqMsg: array expected";for(let t=0;t<e.unSubReqMsg.length;++t){let n=De.naturalcloudsyncv2.UnsubscribeRequestMessage.verify(e.unSubReqMsg[t]);if(n)return"unSubReqMsg."+n}}if(null!=e.enReqInfo&&e.hasOwnProperty("enReqInfo")){if(!Array.isArray(e.enReqInfo))return"enReqInfo: array expected";for(let t=0;t<e.enReqInfo.length;++t){let n=De.naturalcloudsyncv2.EncryptionInfo.verify(e.enReqInfo[t]);if(n)return"enReqInfo."+n}}return null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.SyncRequestMessage)return e;let t=new De.naturalcloudsyncv2.SyncRequestMessage;if(null!=e.msgInfo){if("object"!=typeof e.msgInfo)throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.msgInfo: object expected");t.msgInfo=De.naturalcloudsyncv2.MessageInfo.fromObject(e.msgInfo)}if(null!=e.clientInfo){if("object"!=typeof e.clientInfo)throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.clientInfo: object expected");t.clientInfo=De.naturalcloudsyncv2.ClientInfo.fromObject(e.clientInfo)}if(e.schemas){if(!Array.isArray(e.schemas))throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.schemas: array expected");t.schemas=[];for(let n=0;n<e.schemas.length;++n){if("object"!=typeof e.schemas[n])throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.schemas: object expected");t.schemas[n]=De.naturalcloudsyncv2.Schema.fromObject(e.schemas[n])}}if(e.opData){if(!Array.isArray(e.opData))throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.opData: array expected");t.opData=[];for(let n=0;n<e.opData.length;++n){if("object"!=typeof e.opData[n])throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.opData: object expected");t.opData[n]=De.naturalcloudsyncv2.OperationData.fromObject(e.opData[n])}}if(null!=e.queryReqMsg){if("object"!=typeof e.queryReqMsg)throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.queryReqMsg: object expected");t.queryReqMsg=De.naturalcloudsyncv2.QueryRequestMessage.fromObject(e.queryReqMsg)}if(e.subReqMsg){if(!Array.isArray(e.subReqMsg))throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.subReqMsg: array expected");t.subReqMsg=[];for(let n=0;n<e.subReqMsg.length;++n){if("object"!=typeof e.subReqMsg[n])throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.subReqMsg: object expected");t.subReqMsg[n]=De.naturalcloudsyncv2.SubscribeRequestMessage.fromObject(e.subReqMsg[n])}}if(e.unSubReqMsg){if(!Array.isArray(e.unSubReqMsg))throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.unSubReqMsg: array expected");t.unSubReqMsg=[];for(let n=0;n<e.unSubReqMsg.length;++n){if("object"!=typeof e.unSubReqMsg[n])throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.unSubReqMsg: object expected");t.unSubReqMsg[n]=De.naturalcloudsyncv2.UnsubscribeRequestMessage.fromObject(e.unSubReqMsg[n])}}if(e.enReqInfo){if(!Array.isArray(e.enReqInfo))throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.enReqInfo: array expected");t.enReqInfo=[];for(let n=0;n<e.enReqInfo.length;++n){if("object"!=typeof e.enReqInfo[n])throw TypeError(".naturalcloudsyncv2.SyncRequestMessage.enReqInfo: object expected");t.enReqInfo[n]=De.naturalcloudsyncv2.EncryptionInfo.fromObject(e.enReqInfo[n])}}return t},e.toObject=function(e,t){t||(t={});let n={};if((t.arrays||t.defaults)&&(n.schemas=[],n.opData=[],n.subReqMsg=[],n.unSubReqMsg=[],n.enReqInfo=[]),t.defaults&&(n.msgInfo=null,n.clientInfo=null,n.queryReqMsg=null),null!=e.msgInfo&&e.hasOwnProperty("msgInfo")&&(n.msgInfo=De.naturalcloudsyncv2.MessageInfo.toObject(e.msgInfo,t)),null!=e.clientInfo&&e.hasOwnProperty("clientInfo")&&(n.clientInfo=De.naturalcloudsyncv2.ClientInfo.toObject(e.clientInfo,t)),e.schemas&&e.schemas.length){n.schemas=[];for(let r=0;r<e.schemas.length;++r)n.schemas[r]=De.naturalcloudsyncv2.Schema.toObject(e.schemas[r],t)}if(e.opData&&e.opData.length){n.opData=[];for(let r=0;r<e.opData.length;++r)n.opData[r]=De.naturalcloudsyncv2.OperationData.toObject(e.opData[r],t)}if(null!=e.queryReqMsg&&e.hasOwnProperty("queryReqMsg")&&(n.queryReqMsg=De.naturalcloudsyncv2.QueryRequestMessage.toObject(e.queryReqMsg,t)),e.subReqMsg&&e.subReqMsg.length){n.subReqMsg=[];for(let r=0;r<e.subReqMsg.length;++r)n.subReqMsg[r]=De.naturalcloudsyncv2.SubscribeRequestMessage.toObject(e.subReqMsg[r],t)}if(e.unSubReqMsg&&e.unSubReqMsg.length){n.unSubReqMsg=[];for(let r=0;r<e.unSubReqMsg.length;++r)n.unSubReqMsg[r]=De.naturalcloudsyncv2.UnsubscribeRequestMessage.toObject(e.unSubReqMsg[r],t)}if(e.enReqInfo&&e.enReqInfo.length){n.enReqInfo=[];for(let r=0;r<e.enReqInfo.length;++r)n.enReqInfo[r]=De.naturalcloudsyncv2.EncryptionInfo.toObject(e.enReqInfo[r],t)}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.SyncRequestMessage"},e}(),e.ClientInfo=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.uid="",e.prototype.pid="",e.prototype.cid="",e.prototype.aid="",e.prototype.appVer=Ne.Long?Ne.Long.fromBits(0,0,!1):0,e.prototype.msgVer=0,e.prototype.enVer=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.uid&&Object.hasOwnProperty.call(e,"uid")&&t.uint32(10).string(e.uid),null!=e.pid&&Object.hasOwnProperty.call(e,"pid")&&t.uint32(18).string(e.pid),null!=e.cid&&Object.hasOwnProperty.call(e,"cid")&&t.uint32(26).string(e.cid),null!=e.aid&&Object.hasOwnProperty.call(e,"aid")&&t.uint32(34).string(e.aid),null!=e.appVer&&Object.hasOwnProperty.call(e,"appVer")&&t.uint32(40).int64(e.appVer),null!=e.msgVer&&Object.hasOwnProperty.call(e,"msgVer")&&t.uint32(48).int32(e.msgVer),null!=e.enVer&&Object.hasOwnProperty.call(e,"enVer")&&t.uint32(56).int32(e.enVer),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.ClientInfo;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.uid=e.string();break;case 2:r.pid=e.string();break;case 3:r.cid=e.string();break;case 4:r.aid=e.string();break;case 5:r.appVer=e.int64();break;case 6:r.msgVer=e.int32();break;case 7:r.enVer=e.int32();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.uid&&e.hasOwnProperty("uid")&&!Ne.isString(e.uid)?"uid: string expected":null!=e.pid&&e.hasOwnProperty("pid")&&!Ne.isString(e.pid)?"pid: string expected":null!=e.cid&&e.hasOwnProperty("cid")&&!Ne.isString(e.cid)?"cid: string expected":null!=e.aid&&e.hasOwnProperty("aid")&&!Ne.isString(e.aid)?"aid: string expected":null!=e.appVer&&e.hasOwnProperty("appVer")&&!(Ne.isInteger(e.appVer)||e.appVer&&Ne.isInteger(e.appVer.low)&&Ne.isInteger(e.appVer.high))?"appVer: integer|Long expected":null!=e.msgVer&&e.hasOwnProperty("msgVer")&&!Ne.isInteger(e.msgVer)?"msgVer: integer expected":null!=e.enVer&&e.hasOwnProperty("enVer")&&!Ne.isInteger(e.enVer)?"enVer: integer expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.ClientInfo)return e;let t=new De.naturalcloudsyncv2.ClientInfo;return null!=e.uid&&(t.uid=String(e.uid)),null!=e.pid&&(t.pid=String(e.pid)),null!=e.cid&&(t.cid=String(e.cid)),null!=e.aid&&(t.aid=String(e.aid)),null!=e.appVer&&(Ne.Long?(t.appVer=Ne.Long.fromValue(e.appVer)).unsigned=!1:"string"==typeof e.appVer?t.appVer=parseInt(e.appVer,10):"number"==typeof e.appVer?t.appVer=e.appVer:"object"==typeof e.appVer&&(t.appVer=new Ne.LongBits(e.appVer.low>>>0,e.appVer.high>>>0).toNumber())),null!=e.msgVer&&(t.msgVer=0|e.msgVer),null!=e.enVer&&(t.enVer=0|e.enVer),t},e.toObject=function(e,t){t||(t={});let n={};if(t.defaults){if(n.uid="",n.pid="",n.cid="",n.aid="",Ne.Long){let e=new Ne.Long(0,0,!1);n.appVer=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else n.appVer=t.longs===String?"0":0;n.msgVer=0,n.enVer=0}return null!=e.uid&&e.hasOwnProperty("uid")&&(n.uid=e.uid),null!=e.pid&&e.hasOwnProperty("pid")&&(n.pid=e.pid),null!=e.cid&&e.hasOwnProperty("cid")&&(n.cid=e.cid),null!=e.aid&&e.hasOwnProperty("aid")&&(n.aid=e.aid),null!=e.appVer&&e.hasOwnProperty("appVer")&&("number"==typeof e.appVer?n.appVer=t.longs===String?String(e.appVer):e.appVer:n.appVer=t.longs===String?Ne.Long.prototype.toString.call(e.appVer):t.longs===Number?new Ne.LongBits(e.appVer.low>>>0,e.appVer.high>>>0).toNumber():e.appVer),null!=e.msgVer&&e.hasOwnProperty("msgVer")&&(n.msgVer=e.msgVer),null!=e.enVer&&e.hasOwnProperty("enVer")&&(n.enVer=e.enVer),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.ClientInfo"},e}(),e.QueryRequestMessage=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.queryType=0,e.prototype.queryTable="",e.prototype.queryCond="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.queryType&&Object.hasOwnProperty.call(e,"queryType")&&t.uint32(8).int32(e.queryType),null!=e.queryTable&&Object.hasOwnProperty.call(e,"queryTable")&&t.uint32(18).string(e.queryTable),null!=e.queryCond&&Object.hasOwnProperty.call(e,"queryCond")&&t.uint32(26).string(e.queryCond),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.QueryRequestMessage;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.queryType=e.int32();break;case 2:r.queryTable=e.string();break;case 3:r.queryCond=e.string();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.queryType&&e.hasOwnProperty("queryType")&&!Ne.isInteger(e.queryType)?"queryType: integer expected":null!=e.queryTable&&e.hasOwnProperty("queryTable")&&!Ne.isString(e.queryTable)?"queryTable: string expected":null!=e.queryCond&&e.hasOwnProperty("queryCond")&&!Ne.isString(e.queryCond)?"queryCond: string expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.QueryRequestMessage)return e;let t=new De.naturalcloudsyncv2.QueryRequestMessage;return null!=e.queryType&&(t.queryType=0|e.queryType),null!=e.queryTable&&(t.queryTable=String(e.queryTable)),null!=e.queryCond&&(t.queryCond=String(e.queryCond)),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.queryType=0,n.queryTable="",n.queryCond=""),null!=e.queryType&&e.hasOwnProperty("queryType")&&(n.queryType=e.queryType),null!=e.queryTable&&e.hasOwnProperty("queryTable")&&(n.queryTable=e.queryTable),null!=e.queryCond&&e.hasOwnProperty("queryCond")&&(n.queryCond=e.queryCond),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.QueryRequestMessage"},e}(),e.SubscribeRequestMessage=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.subId="",e.prototype.subStore="",e.prototype.subTable="",e.prototype.subCond="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.subId&&Object.hasOwnProperty.call(e,"subId")&&t.uint32(10).string(e.subId),null!=e.subStore&&Object.hasOwnProperty.call(e,"subStore")&&t.uint32(18).string(e.subStore),null!=e.subTable&&Object.hasOwnProperty.call(e,"subTable")&&t.uint32(26).string(e.subTable),null!=e.subCond&&Object.hasOwnProperty.call(e,"subCond")&&t.uint32(34).string(e.subCond),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.SubscribeRequestMessage;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.subId=e.string();break;case 2:r.subStore=e.string();break;case 3:r.subTable=e.string();break;case 4:r.subCond=e.string();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.subId&&e.hasOwnProperty("subId")&&!Ne.isString(e.subId)?"subId: string expected":null!=e.subStore&&e.hasOwnProperty("subStore")&&!Ne.isString(e.subStore)?"subStore: string expected":null!=e.subTable&&e.hasOwnProperty("subTable")&&!Ne.isString(e.subTable)?"subTable: string expected":null!=e.subCond&&e.hasOwnProperty("subCond")&&!Ne.isString(e.subCond)?"subCond: string expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.SubscribeRequestMessage)return e;let t=new De.naturalcloudsyncv2.SubscribeRequestMessage;return null!=e.subId&&(t.subId=String(e.subId)),null!=e.subStore&&(t.subStore=String(e.subStore)),null!=e.subTable&&(t.subTable=String(e.subTable)),null!=e.subCond&&(t.subCond=String(e.subCond)),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.subId="",n.subStore="",n.subTable="",n.subCond=""),null!=e.subId&&e.hasOwnProperty("subId")&&(n.subId=e.subId),null!=e.subStore&&e.hasOwnProperty("subStore")&&(n.subStore=e.subStore),null!=e.subTable&&e.hasOwnProperty("subTable")&&(n.subTable=e.subTable),null!=e.subCond&&e.hasOwnProperty("subCond")&&(n.subCond=e.subCond),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.SubscribeRequestMessage"},e}(),e.UnsubscribeRequestMessage=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.subRecId="",e.prototype.unSubStore="",e.prototype.unSubTable="",e.prototype.subKey=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.subRecId&&Object.hasOwnProperty.call(e,"subRecId")&&t.uint32(10).string(e.subRecId),null!=e.unSubStore&&Object.hasOwnProperty.call(e,"unSubStore")&&t.uint32(18).string(e.unSubStore),null!=e.unSubTable&&Object.hasOwnProperty.call(e,"unSubTable")&&t.uint32(26).string(e.unSubTable),null!=e.subKey&&Object.hasOwnProperty.call(e,"subKey")&&t.uint32(32).int32(e.subKey),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.UnsubscribeRequestMessage;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.subRecId=e.string();break;case 2:r.unSubStore=e.string();break;case 3:r.unSubTable=e.string();break;case 4:r.subKey=e.int32();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.subRecId&&e.hasOwnProperty("subRecId")&&!Ne.isString(e.subRecId)?"subRecId: string expected":null!=e.unSubStore&&e.hasOwnProperty("unSubStore")&&!Ne.isString(e.unSubStore)?"unSubStore: string expected":null!=e.unSubTable&&e.hasOwnProperty("unSubTable")&&!Ne.isString(e.unSubTable)?"unSubTable: string expected":null!=e.subKey&&e.hasOwnProperty("subKey")&&!Ne.isInteger(e.subKey)?"subKey: integer expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.UnsubscribeRequestMessage)return e;let t=new De.naturalcloudsyncv2.UnsubscribeRequestMessage;return null!=e.subRecId&&(t.subRecId=String(e.subRecId)),null!=e.unSubStore&&(t.unSubStore=String(e.unSubStore)),null!=e.unSubTable&&(t.unSubTable=String(e.unSubTable)),null!=e.subKey&&(t.subKey=0|e.subKey),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.subRecId="",n.unSubStore="",n.unSubTable="",n.subKey=0),null!=e.subRecId&&e.hasOwnProperty("subRecId")&&(n.subRecId=e.subRecId),null!=e.unSubStore&&e.hasOwnProperty("unSubStore")&&(n.unSubStore=e.unSubStore),null!=e.unSubTable&&e.hasOwnProperty("unSubTable")&&(n.unSubTable=e.unSubTable),null!=e.subKey&&e.hasOwnProperty("subKey")&&(n.subKey=e.subKey),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.UnsubscribeRequestMessage"},e}(),e.ServerStatus=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.timestamp=Ne.Long?Ne.Long.fromBits(0,0,!1):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.timestamp&&Object.hasOwnProperty.call(e,"timestamp")&&t.uint32(8).int64(e.timestamp),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.ServerStatus;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.timestamp=e.int64();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.timestamp&&e.hasOwnProperty("timestamp")&&!(Ne.isInteger(e.timestamp)||e.timestamp&&Ne.isInteger(e.timestamp.low)&&Ne.isInteger(e.timestamp.high))?"timestamp: integer|Long expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.ServerStatus)return e;let t=new De.naturalcloudsyncv2.ServerStatus;return null!=e.timestamp&&(Ne.Long?(t.timestamp=Ne.Long.fromValue(e.timestamp)).unsigned=!1:"string"==typeof e.timestamp?t.timestamp=parseInt(e.timestamp,10):"number"==typeof e.timestamp?t.timestamp=e.timestamp:"object"==typeof e.timestamp&&(t.timestamp=new Ne.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});let n={};if(t.defaults)if(Ne.Long){let e=new Ne.Long(0,0,!1);n.timestamp=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else n.timestamp=t.longs===String?"0":0;return null!=e.timestamp&&e.hasOwnProperty("timestamp")&&("number"==typeof e.timestamp?n.timestamp=t.longs===String?String(e.timestamp):e.timestamp:n.timestamp=t.longs===String?Ne.Long.prototype.toString.call(e.timestamp):t.longs===Number?new Ne.LongBits(e.timestamp.low>>>0,e.timestamp.high>>>0).toNumber():e.timestamp),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.ServerStatus"},e}(),e.SyncResponseMessage=function(){function e(e){if(this.schemas=[],this.opData=[],this.permRecs=[],this.subResMsg=[],this.unSubResMsg=[],this.enResInfo=[],e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.msgInfo=null,e.prototype.resInfo=null,e.prototype.schemas=Ne.emptyArray,e.prototype.opData=Ne.emptyArray,e.prototype.permRecs=Ne.emptyArray,e.prototype.updateResMsg=null,e.prototype.queryResMsg=null,e.prototype.subResMsg=Ne.emptyArray,e.prototype.unSubResMsg=Ne.emptyArray,e.prototype.subPushMsg=null,e.prototype.enResInfo=Ne.emptyArray,e.prototype.serverStatus=null,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=Ce.create()),null!=e.msgInfo&&Object.hasOwnProperty.call(e,"msgInfo")&&De.naturalcloudsyncv2.MessageInfo.encode(e.msgInfo,t.uint32(10).fork()).ldelim(),null!=e.resInfo&&Object.hasOwnProperty.call(e,"resInfo")&&De.naturalcloudsyncv2.ResponseInfo.encode(e.resInfo,t.uint32(18).fork()).ldelim(),null!=e.schemas&&e.schemas.length)for(let n=0;n<e.schemas.length;++n)De.naturalcloudsyncv2.Schema.encode(e.schemas[n],t.uint32(26).fork()).ldelim();if(null!=e.opData&&e.opData.length)for(let n=0;n<e.opData.length;++n)De.naturalcloudsyncv2.OperationData.encode(e.opData[n],t.uint32(34).fork()).ldelim();if(null!=e.permRecs&&e.permRecs.length)for(let n=0;n<e.permRecs.length;++n)De.naturalcloudsyncv2.PermissionRecord.encode(e.permRecs[n],t.uint32(42).fork()).ldelim();if(null!=e.updateResMsg&&Object.hasOwnProperty.call(e,"updateResMsg")&&De.naturalcloudsyncv2.UpdateResponseMessage.encode(e.updateResMsg,t.uint32(50).fork()).ldelim(),null!=e.queryResMsg&&Object.hasOwnProperty.call(e,"queryResMsg")&&De.naturalcloudsyncv2.QueryResponseMessage.encode(e.queryResMsg,t.uint32(58).fork()).ldelim(),null!=e.subResMsg&&e.subResMsg.length)for(let n=0;n<e.subResMsg.length;++n)De.naturalcloudsyncv2.SubscribeResponseMessage.encode(e.subResMsg[n],t.uint32(66).fork()).ldelim();if(null!=e.unSubResMsg&&e.unSubResMsg.length)for(let n=0;n<e.unSubResMsg.length;++n)De.naturalcloudsyncv2.UnsubscribeResponseMessage.encode(e.unSubResMsg[n],t.uint32(74).fork()).ldelim();if(null!=e.subPushMsg&&Object.hasOwnProperty.call(e,"subPushMsg")&&De.naturalcloudsyncv2.SubscribePushMessage.encode(e.subPushMsg,t.uint32(82).fork()).ldelim(),null!=e.enResInfo&&e.enResInfo.length)for(let n=0;n<e.enResInfo.length;++n)De.naturalcloudsyncv2.EncryptionInfo.encode(e.enResInfo[n],t.uint32(90).fork()).ldelim();return null!=e.serverStatus&&Object.hasOwnProperty.call(e,"serverStatus")&&De.naturalcloudsyncv2.ServerStatus.encode(e.serverStatus,t.uint32(98).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.SyncResponseMessage;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.msgInfo=De.naturalcloudsyncv2.MessageInfo.decode(e,e.uint32());break;case 2:r.resInfo=De.naturalcloudsyncv2.ResponseInfo.decode(e,e.uint32());break;case 3:r.schemas&&r.schemas.length||(r.schemas=[]),r.schemas.push(De.naturalcloudsyncv2.Schema.decode(e,e.uint32()));break;case 4:r.opData&&r.opData.length||(r.opData=[]),r.opData.push(De.naturalcloudsyncv2.OperationData.decode(e,e.uint32()));break;case 5:r.permRecs&&r.permRecs.length||(r.permRecs=[]),r.permRecs.push(De.naturalcloudsyncv2.PermissionRecord.decode(e,e.uint32()));break;case 6:r.updateResMsg=De.naturalcloudsyncv2.UpdateResponseMessage.decode(e,e.uint32());break;case 7:r.queryResMsg=De.naturalcloudsyncv2.QueryResponseMessage.decode(e,e.uint32());break;case 8:r.subResMsg&&r.subResMsg.length||(r.subResMsg=[]),r.subResMsg.push(De.naturalcloudsyncv2.SubscribeResponseMessage.decode(e,e.uint32()));break;case 9:r.unSubResMsg&&r.unSubResMsg.length||(r.unSubResMsg=[]),r.unSubResMsg.push(De.naturalcloudsyncv2.UnsubscribeResponseMessage.decode(e,e.uint32()));break;case 10:r.subPushMsg=De.naturalcloudsyncv2.SubscribePushMessage.decode(e,e.uint32());break;case 11:r.enResInfo&&r.enResInfo.length||(r.enResInfo=[]),r.enResInfo.push(De.naturalcloudsyncv2.EncryptionInfo.decode(e,e.uint32()));break;case 12:r.serverStatus=De.naturalcloudsyncv2.ServerStatus.decode(e,e.uint32());break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.msgInfo&&e.hasOwnProperty("msgInfo")){let t=De.naturalcloudsyncv2.MessageInfo.verify(e.msgInfo);if(t)return"msgInfo."+t}if(null!=e.resInfo&&e.hasOwnProperty("resInfo")){let t=De.naturalcloudsyncv2.ResponseInfo.verify(e.resInfo);if(t)return"resInfo."+t}if(null!=e.schemas&&e.hasOwnProperty("schemas")){if(!Array.isArray(e.schemas))return"schemas: array expected";for(let t=0;t<e.schemas.length;++t){let n=De.naturalcloudsyncv2.Schema.verify(e.schemas[t]);if(n)return"schemas."+n}}if(null!=e.opData&&e.hasOwnProperty("opData")){if(!Array.isArray(e.opData))return"opData: array expected";for(let t=0;t<e.opData.length;++t){let n=De.naturalcloudsyncv2.OperationData.verify(e.opData[t]);if(n)return"opData."+n}}if(null!=e.permRecs&&e.hasOwnProperty("permRecs")){if(!Array.isArray(e.permRecs))return"permRecs: array expected";for(let t=0;t<e.permRecs.length;++t){let n=De.naturalcloudsyncv2.PermissionRecord.verify(e.permRecs[t]);if(n)return"permRecs."+n}}if(null!=e.updateResMsg&&e.hasOwnProperty("updateResMsg")){let t=De.naturalcloudsyncv2.UpdateResponseMessage.verify(e.updateResMsg);if(t)return"updateResMsg."+t}if(null!=e.queryResMsg&&e.hasOwnProperty("queryResMsg")){let t=De.naturalcloudsyncv2.QueryResponseMessage.verify(e.queryResMsg);if(t)return"queryResMsg."+t}if(null!=e.subResMsg&&e.hasOwnProperty("subResMsg")){if(!Array.isArray(e.subResMsg))return"subResMsg: array expected";for(let t=0;t<e.subResMsg.length;++t){let n=De.naturalcloudsyncv2.SubscribeResponseMessage.verify(e.subResMsg[t]);if(n)return"subResMsg."+n}}if(null!=e.unSubResMsg&&e.hasOwnProperty("unSubResMsg")){if(!Array.isArray(e.unSubResMsg))return"unSubResMsg: array expected";for(let t=0;t<e.unSubResMsg.length;++t){let n=De.naturalcloudsyncv2.UnsubscribeResponseMessage.verify(e.unSubResMsg[t]);if(n)return"unSubResMsg."+n}}if(null!=e.subPushMsg&&e.hasOwnProperty("subPushMsg")){let t=De.naturalcloudsyncv2.SubscribePushMessage.verify(e.subPushMsg);if(t)return"subPushMsg."+t}if(null!=e.enResInfo&&e.hasOwnProperty("enResInfo")){if(!Array.isArray(e.enResInfo))return"enResInfo: array expected";for(let t=0;t<e.enResInfo.length;++t){let n=De.naturalcloudsyncv2.EncryptionInfo.verify(e.enResInfo[t]);if(n)return"enResInfo."+n}}if(null!=e.serverStatus&&e.hasOwnProperty("serverStatus")){let t=De.naturalcloudsyncv2.ServerStatus.verify(e.serverStatus);if(t)return"serverStatus."+t}return null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.SyncResponseMessage)return e;let t=new De.naturalcloudsyncv2.SyncResponseMessage;if(null!=e.msgInfo){if("object"!=typeof e.msgInfo)throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.msgInfo: object expected");t.msgInfo=De.naturalcloudsyncv2.MessageInfo.fromObject(e.msgInfo)}if(null!=e.resInfo){if("object"!=typeof e.resInfo)throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.resInfo: object expected");t.resInfo=De.naturalcloudsyncv2.ResponseInfo.fromObject(e.resInfo)}if(e.schemas){if(!Array.isArray(e.schemas))throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.schemas: array expected");t.schemas=[];for(let n=0;n<e.schemas.length;++n){if("object"!=typeof e.schemas[n])throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.schemas: object expected");t.schemas[n]=De.naturalcloudsyncv2.Schema.fromObject(e.schemas[n])}}if(e.opData){if(!Array.isArray(e.opData))throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.opData: array expected");t.opData=[];for(let n=0;n<e.opData.length;++n){if("object"!=typeof e.opData[n])throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.opData: object expected");t.opData[n]=De.naturalcloudsyncv2.OperationData.fromObject(e.opData[n])}}if(e.permRecs){if(!Array.isArray(e.permRecs))throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.permRecs: array expected");t.permRecs=[];for(let n=0;n<e.permRecs.length;++n){if("object"!=typeof e.permRecs[n])throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.permRecs: object expected");t.permRecs[n]=De.naturalcloudsyncv2.PermissionRecord.fromObject(e.permRecs[n])}}if(null!=e.updateResMsg){if("object"!=typeof e.updateResMsg)throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.updateResMsg: object expected");t.updateResMsg=De.naturalcloudsyncv2.UpdateResponseMessage.fromObject(e.updateResMsg)}if(null!=e.queryResMsg){if("object"!=typeof e.queryResMsg)throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.queryResMsg: object expected");t.queryResMsg=De.naturalcloudsyncv2.QueryResponseMessage.fromObject(e.queryResMsg)}if(e.subResMsg){if(!Array.isArray(e.subResMsg))throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.subResMsg: array expected");t.subResMsg=[];for(let n=0;n<e.subResMsg.length;++n){if("object"!=typeof e.subResMsg[n])throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.subResMsg: object expected");t.subResMsg[n]=De.naturalcloudsyncv2.SubscribeResponseMessage.fromObject(e.subResMsg[n])}}if(e.unSubResMsg){if(!Array.isArray(e.unSubResMsg))throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.unSubResMsg: array expected");t.unSubResMsg=[];for(let n=0;n<e.unSubResMsg.length;++n){if("object"!=typeof e.unSubResMsg[n])throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.unSubResMsg: object expected");t.unSubResMsg[n]=De.naturalcloudsyncv2.UnsubscribeResponseMessage.fromObject(e.unSubResMsg[n])}}if(null!=e.subPushMsg){if("object"!=typeof e.subPushMsg)throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.subPushMsg: object expected");t.subPushMsg=De.naturalcloudsyncv2.SubscribePushMessage.fromObject(e.subPushMsg)}if(e.enResInfo){if(!Array.isArray(e.enResInfo))throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.enResInfo: array expected");t.enResInfo=[];for(let n=0;n<e.enResInfo.length;++n){if("object"!=typeof e.enResInfo[n])throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.enResInfo: object expected");t.enResInfo[n]=De.naturalcloudsyncv2.EncryptionInfo.fromObject(e.enResInfo[n])}}if(null!=e.serverStatus){if("object"!=typeof e.serverStatus)throw TypeError(".naturalcloudsyncv2.SyncResponseMessage.serverStatus: object expected");t.serverStatus=De.naturalcloudsyncv2.ServerStatus.fromObject(e.serverStatus)}return t},e.toObject=function(e,t){t||(t={});let n={};if((t.arrays||t.defaults)&&(n.schemas=[],n.opData=[],n.permRecs=[],n.subResMsg=[],n.unSubResMsg=[],n.enResInfo=[]),t.defaults&&(n.msgInfo=null,n.resInfo=null,n.updateResMsg=null,n.queryResMsg=null,n.subPushMsg=null,n.serverStatus=null),null!=e.msgInfo&&e.hasOwnProperty("msgInfo")&&(n.msgInfo=De.naturalcloudsyncv2.MessageInfo.toObject(e.msgInfo,t)),null!=e.resInfo&&e.hasOwnProperty("resInfo")&&(n.resInfo=De.naturalcloudsyncv2.ResponseInfo.toObject(e.resInfo,t)),e.schemas&&e.schemas.length){n.schemas=[];for(let r=0;r<e.schemas.length;++r)n.schemas[r]=De.naturalcloudsyncv2.Schema.toObject(e.schemas[r],t)}if(e.opData&&e.opData.length){n.opData=[];for(let r=0;r<e.opData.length;++r)n.opData[r]=De.naturalcloudsyncv2.OperationData.toObject(e.opData[r],t)}if(e.permRecs&&e.permRecs.length){n.permRecs=[];for(let r=0;r<e.permRecs.length;++r)n.permRecs[r]=De.naturalcloudsyncv2.PermissionRecord.toObject(e.permRecs[r],t)}if(null!=e.updateResMsg&&e.hasOwnProperty("updateResMsg")&&(n.updateResMsg=De.naturalcloudsyncv2.UpdateResponseMessage.toObject(e.updateResMsg,t)),null!=e.queryResMsg&&e.hasOwnProperty("queryResMsg")&&(n.queryResMsg=De.naturalcloudsyncv2.QueryResponseMessage.toObject(e.queryResMsg,t)),e.subResMsg&&e.subResMsg.length){n.subResMsg=[];for(let r=0;r<e.subResMsg.length;++r)n.subResMsg[r]=De.naturalcloudsyncv2.SubscribeResponseMessage.toObject(e.subResMsg[r],t)}if(e.unSubResMsg&&e.unSubResMsg.length){n.unSubResMsg=[];for(let r=0;r<e.unSubResMsg.length;++r)n.unSubResMsg[r]=De.naturalcloudsyncv2.UnsubscribeResponseMessage.toObject(e.unSubResMsg[r],t)}if(null!=e.subPushMsg&&e.hasOwnProperty("subPushMsg")&&(n.subPushMsg=De.naturalcloudsyncv2.SubscribePushMessage.toObject(e.subPushMsg,t)),e.enResInfo&&e.enResInfo.length){n.enResInfo=[];for(let r=0;r<e.enResInfo.length;++r)n.enResInfo[r]=De.naturalcloudsyncv2.EncryptionInfo.toObject(e.enResInfo[r],t)}return null!=e.serverStatus&&e.hasOwnProperty("serverStatus")&&(n.serverStatus=De.naturalcloudsyncv2.ServerStatus.toObject(e.serverStatus,t)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.SyncResponseMessage"},e}(),e.ResponseInfo=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.resCode=0,e.prototype.resInfo="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.resCode&&Object.hasOwnProperty.call(e,"resCode")&&t.uint32(8).int32(e.resCode),null!=e.resInfo&&Object.hasOwnProperty.call(e,"resInfo")&&t.uint32(18).string(e.resInfo),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.ResponseInfo;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.resCode=e.int32();break;case 2:r.resInfo=e.string();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.resCode&&e.hasOwnProperty("resCode")&&!Ne.isInteger(e.resCode)?"resCode: integer expected":null!=e.resInfo&&e.hasOwnProperty("resInfo")&&!Ne.isString(e.resInfo)?"resInfo: string expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.ResponseInfo)return e;let t=new De.naturalcloudsyncv2.ResponseInfo;return null!=e.resCode&&(t.resCode=0|e.resCode),null!=e.resInfo&&(t.resInfo=String(e.resInfo)),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.resCode=0,n.resInfo=""),null!=e.resCode&&e.hasOwnProperty("resCode")&&(n.resCode=e.resCode),null!=e.resInfo&&e.hasOwnProperty("resInfo")&&(n.resInfo=e.resInfo),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.ResponseInfo"},e}(),e.PermissionRecord=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.tableName="",e.prototype.roleType="",e.prototype.readPerm=!1,e.prototype.upsertPerm=!1,e.prototype.deletePerm=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.tableName&&Object.hasOwnProperty.call(e,"tableName")&&t.uint32(10).string(e.tableName),null!=e.roleType&&Object.hasOwnProperty.call(e,"roleType")&&t.uint32(18).string(e.roleType),null!=e.readPerm&&Object.hasOwnProperty.call(e,"readPerm")&&t.uint32(24).bool(e.readPerm),null!=e.upsertPerm&&Object.hasOwnProperty.call(e,"upsertPerm")&&t.uint32(32).bool(e.upsertPerm),null!=e.deletePerm&&Object.hasOwnProperty.call(e,"deletePerm")&&t.uint32(40).bool(e.deletePerm),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.PermissionRecord;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.tableName=e.string();break;case 2:r.roleType=e.string();break;case 3:r.readPerm=e.bool();break;case 4:r.upsertPerm=e.bool();break;case 5:r.deletePerm=e.bool();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.tableName&&e.hasOwnProperty("tableName")&&!Ne.isString(e.tableName)?"tableName: string expected":null!=e.roleType&&e.hasOwnProperty("roleType")&&!Ne.isString(e.roleType)?"roleType: string expected":null!=e.readPerm&&e.hasOwnProperty("readPerm")&&"boolean"!=typeof e.readPerm?"readPerm: boolean expected":null!=e.upsertPerm&&e.hasOwnProperty("upsertPerm")&&"boolean"!=typeof e.upsertPerm?"upsertPerm: boolean expected":null!=e.deletePerm&&e.hasOwnProperty("deletePerm")&&"boolean"!=typeof e.deletePerm?"deletePerm: boolean expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.PermissionRecord)return e;let t=new De.naturalcloudsyncv2.PermissionRecord;return null!=e.tableName&&(t.tableName=String(e.tableName)),null!=e.roleType&&(t.roleType=String(e.roleType)),null!=e.readPerm&&(t.readPerm=Boolean(e.readPerm)),null!=e.upsertPerm&&(t.upsertPerm=Boolean(e.upsertPerm)),null!=e.deletePerm&&(t.deletePerm=Boolean(e.deletePerm)),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.tableName="",n.roleType="",n.readPerm=!1,n.upsertPerm=!1,n.deletePerm=!1),null!=e.tableName&&e.hasOwnProperty("tableName")&&(n.tableName=e.tableName),null!=e.roleType&&e.hasOwnProperty("roleType")&&(n.roleType=e.roleType),null!=e.readPerm&&e.hasOwnProperty("readPerm")&&(n.readPerm=e.readPerm),null!=e.upsertPerm&&e.hasOwnProperty("upsertPerm")&&(n.upsertPerm=e.upsertPerm),null!=e.deletePerm&&e.hasOwnProperty("deletePerm")&&(n.deletePerm=e.deletePerm),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.PermissionRecord"},e}(),e.UpdateResponseMessage=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.successRecCount=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.successRecCount&&Object.hasOwnProperty.call(e,"successRecCount")&&t.uint32(8).int32(e.successRecCount),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.UpdateResponseMessage;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.successRecCount=e.int32();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.successRecCount&&e.hasOwnProperty("successRecCount")&&!Ne.isInteger(e.successRecCount)?"successRecCount: integer expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.UpdateResponseMessage)return e;let t=new De.naturalcloudsyncv2.UpdateResponseMessage;return null!=e.successRecCount&&(t.successRecCount=0|e.successRecCount),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.successRecCount=0),null!=e.successRecCount&&e.hasOwnProperty("successRecCount")&&(n.successRecCount=e.successRecCount),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.UpdateResponseMessage"},e}(),e.QueryResponseMessage=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.queryType=0,e.prototype.isComplete=!1,e.prototype.aggQueryRes=null,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.queryType&&Object.hasOwnProperty.call(e,"queryType")&&t.uint32(8).int32(e.queryType),null!=e.isComplete&&Object.hasOwnProperty.call(e,"isComplete")&&t.uint32(16).bool(e.isComplete),null!=e.aggQueryRes&&Object.hasOwnProperty.call(e,"aggQueryRes")&&De.naturalcloudsyncv2.AggregateQueryResult.encode(e.aggQueryRes,t.uint32(26).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.QueryResponseMessage;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.queryType=e.int32();break;case 2:r.isComplete=e.bool();break;case 3:r.aggQueryRes=De.naturalcloudsyncv2.AggregateQueryResult.decode(e,e.uint32());break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.queryType&&e.hasOwnProperty("queryType")&&!Ne.isInteger(e.queryType))return"queryType: integer expected";if(null!=e.isComplete&&e.hasOwnProperty("isComplete")&&"boolean"!=typeof e.isComplete)return"isComplete: boolean expected";if(null!=e.aggQueryRes&&e.hasOwnProperty("aggQueryRes")){let t=De.naturalcloudsyncv2.AggregateQueryResult.verify(e.aggQueryRes);if(t)return"aggQueryRes."+t}return null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.QueryResponseMessage)return e;let t=new De.naturalcloudsyncv2.QueryResponseMessage;if(null!=e.queryType&&(t.queryType=0|e.queryType),null!=e.isComplete&&(t.isComplete=Boolean(e.isComplete)),null!=e.aggQueryRes){if("object"!=typeof e.aggQueryRes)throw TypeError(".naturalcloudsyncv2.QueryResponseMessage.aggQueryRes: object expected");t.aggQueryRes=De.naturalcloudsyncv2.AggregateQueryResult.fromObject(e.aggQueryRes)}return t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.queryType=0,n.isComplete=!1,n.aggQueryRes=null),null!=e.queryType&&e.hasOwnProperty("queryType")&&(n.queryType=e.queryType),null!=e.isComplete&&e.hasOwnProperty("isComplete")&&(n.isComplete=e.isComplete),null!=e.aggQueryRes&&e.hasOwnProperty("aggQueryRes")&&(n.aggQueryRes=De.naturalcloudsyncv2.AggregateQueryResult.toObject(e.aggQueryRes,t)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.QueryResponseMessage"},e}(),e.AggregateQueryResult=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}let t;return e.prototype.isNull=!1,e.prototype.longRes=null,e.prototype.doubleRes=null,Object.defineProperty(e.prototype,"result",{get:Ne.oneOfGetter(t=["longRes","doubleRes"]),set:Ne.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.isNull&&Object.hasOwnProperty.call(e,"isNull")&&t.uint32(8).bool(e.isNull),null!=e.longRes&&Object.hasOwnProperty.call(e,"longRes")&&t.uint32(16).int64(e.longRes),null!=e.doubleRes&&Object.hasOwnProperty.call(e,"doubleRes")&&t.uint32(25).double(e.doubleRes),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.AggregateQueryResult;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.isNull=e.bool();break;case 2:r.longRes=e.int64();break;case 3:r.doubleRes=e.double();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";let t={};if(null!=e.isNull&&e.hasOwnProperty("isNull")&&"boolean"!=typeof e.isNull)return"isNull: boolean expected";if(null!=e.longRes&&e.hasOwnProperty("longRes")&&(t.result=1,!(Ne.isInteger(e.longRes)||e.longRes&&Ne.isInteger(e.longRes.low)&&Ne.isInteger(e.longRes.high))))return"longRes: integer|Long expected";if(null!=e.doubleRes&&e.hasOwnProperty("doubleRes")){if(1===t.result)return"result: multiple values";if(t.result=1,"number"!=typeof e.doubleRes)return"doubleRes: number expected"}return null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.AggregateQueryResult)return e;let t=new De.naturalcloudsyncv2.AggregateQueryResult;return null!=e.isNull&&(t.isNull=Boolean(e.isNull)),null!=e.longRes&&(Ne.Long?(t.longRes=Ne.Long.fromValue(e.longRes)).unsigned=!1:"string"==typeof e.longRes?t.longRes=parseInt(e.longRes,10):"number"==typeof e.longRes?t.longRes=e.longRes:"object"==typeof e.longRes&&(t.longRes=new Ne.LongBits(e.longRes.low>>>0,e.longRes.high>>>0).toNumber())),null!=e.doubleRes&&(t.doubleRes=Number(e.doubleRes)),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.isNull=!1),null!=e.isNull&&e.hasOwnProperty("isNull")&&(n.isNull=e.isNull),null!=e.longRes&&e.hasOwnProperty("longRes")&&("number"==typeof e.longRes?n.longRes=t.longs===String?String(e.longRes):e.longRes:n.longRes=t.longs===String?Ne.Long.prototype.toString.call(e.longRes):t.longs===Number?new Ne.LongBits(e.longRes.low>>>0,e.longRes.high>>>0).toNumber():e.longRes,t.oneofs&&(n.result="longRes")),null!=e.doubleRes&&e.hasOwnProperty("doubleRes")&&(n.doubleRes=t.json&&!isFinite(e.doubleRes)?String(e.doubleRes):e.doubleRes,t.oneofs&&(n.result="doubleRes")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.AggregateQueryResult"},e}(),e.SubscribeResponseMessage=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.subRecId="",e.prototype.subId="",e.prototype.subKey=0,e.prototype.subResCode=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.subRecId&&Object.hasOwnProperty.call(e,"subRecId")&&t.uint32(10).string(e.subRecId),null!=e.subId&&Object.hasOwnProperty.call(e,"subId")&&t.uint32(18).string(e.subId),null!=e.subKey&&Object.hasOwnProperty.call(e,"subKey")&&t.uint32(24).int32(e.subKey),null!=e.subResCode&&Object.hasOwnProperty.call(e,"subResCode")&&t.uint32(32).int32(e.subResCode),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.SubscribeResponseMessage;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.subRecId=e.string();break;case 2:r.subId=e.string();break;case 3:r.subKey=e.int32();break;case 4:r.subResCode=e.int32();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.subRecId&&e.hasOwnProperty("subRecId")&&!Ne.isString(e.subRecId)?"subRecId: string expected":null!=e.subId&&e.hasOwnProperty("subId")&&!Ne.isString(e.subId)?"subId: string expected":null!=e.subKey&&e.hasOwnProperty("subKey")&&!Ne.isInteger(e.subKey)?"subKey: integer expected":null!=e.subResCode&&e.hasOwnProperty("subResCode")&&!Ne.isInteger(e.subResCode)?"subResCode: integer expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.SubscribeResponseMessage)return e;let t=new De.naturalcloudsyncv2.SubscribeResponseMessage;return null!=e.subRecId&&(t.subRecId=String(e.subRecId)),null!=e.subId&&(t.subId=String(e.subId)),null!=e.subKey&&(t.subKey=0|e.subKey),null!=e.subResCode&&(t.subResCode=0|e.subResCode),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.subRecId="",n.subId="",n.subKey=0,n.subResCode=0),null!=e.subRecId&&e.hasOwnProperty("subRecId")&&(n.subRecId=e.subRecId),null!=e.subId&&e.hasOwnProperty("subId")&&(n.subId=e.subId),null!=e.subKey&&e.hasOwnProperty("subKey")&&(n.subKey=e.subKey),null!=e.subResCode&&e.hasOwnProperty("subResCode")&&(n.subResCode=e.subResCode),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.SubscribeResponseMessage"},e}(),e.UnsubscribeResponseMessage=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.unSubRecId="",e.prototype.unSubResCode=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.unSubRecId&&Object.hasOwnProperty.call(e,"unSubRecId")&&t.uint32(10).string(e.unSubRecId),null!=e.unSubResCode&&Object.hasOwnProperty.call(e,"unSubResCode")&&t.uint32(16).int32(e.unSubResCode),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.UnsubscribeResponseMessage;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.unSubRecId=e.string();break;case 2:r.unSubResCode=e.int32();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.unSubRecId&&e.hasOwnProperty("unSubRecId")&&!Ne.isString(e.unSubRecId)?"unSubRecId: string expected":null!=e.unSubResCode&&e.hasOwnProperty("unSubResCode")&&!Ne.isInteger(e.unSubResCode)?"unSubResCode: integer expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.UnsubscribeResponseMessage)return e;let t=new De.naturalcloudsyncv2.UnsubscribeResponseMessage;return null!=e.unSubRecId&&(t.unSubRecId=String(e.unSubRecId)),null!=e.unSubResCode&&(t.unSubResCode=0|e.unSubResCode),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.unSubRecId="",n.unSubResCode=0),null!=e.unSubRecId&&e.hasOwnProperty("unSubRecId")&&(n.unSubRecId=e.unSubRecId),null!=e.unSubResCode&&e.hasOwnProperty("unSubResCode")&&(n.unSubResCode=e.unSubResCode),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.UnsubscribeResponseMessage"},e}(),e.SubscribePushMessage=function(){function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.subRecId="",e.prototype.pushSeq=Ne.Long?Ne.Long.fromBits(0,0,!1):0,e.prototype.subKey=0,e.prototype.subId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=Ce.create()),null!=e.subRecId&&Object.hasOwnProperty.call(e,"subRecId")&&t.uint32(10).string(e.subRecId),null!=e.pushSeq&&Object.hasOwnProperty.call(e,"pushSeq")&&t.uint32(16).int64(e.pushSeq),null!=e.subKey&&Object.hasOwnProperty.call(e,"subKey")&&t.uint32(24).int32(e.subKey),null!=e.subId&&Object.hasOwnProperty.call(e,"subId")&&t.uint32(34).string(e.subId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ee||(e=Ee.create(e));let n=void 0===t?e.len:e.pos+t,r=new De.naturalcloudsyncv2.SubscribePushMessage;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 1:r.subRecId=e.string();break;case 2:r.pushSeq=e.int64();break;case 3:r.subKey=e.int32();break;case 4:r.subId=e.string();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof Ee||(e=new Ee(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.subRecId&&e.hasOwnProperty("subRecId")&&!Ne.isString(e.subRecId)?"subRecId: string expected":null!=e.pushSeq&&e.hasOwnProperty("pushSeq")&&!(Ne.isInteger(e.pushSeq)||e.pushSeq&&Ne.isInteger(e.pushSeq.low)&&Ne.isInteger(e.pushSeq.high))?"pushSeq: integer|Long expected":null!=e.subKey&&e.hasOwnProperty("subKey")&&!Ne.isInteger(e.subKey)?"subKey: integer expected":null!=e.subId&&e.hasOwnProperty("subId")&&!Ne.isString(e.subId)?"subId: string expected":null},e.fromObject=function(e){if(e instanceof De.naturalcloudsyncv2.SubscribePushMessage)return e;let t=new De.naturalcloudsyncv2.SubscribePushMessage;return null!=e.subRecId&&(t.subRecId=String(e.subRecId)),null!=e.pushSeq&&(Ne.Long?(t.pushSeq=Ne.Long.fromValue(e.pushSeq)).unsigned=!1:"string"==typeof e.pushSeq?t.pushSeq=parseInt(e.pushSeq,10):"number"==typeof e.pushSeq?t.pushSeq=e.pushSeq:"object"==typeof e.pushSeq&&(t.pushSeq=new Ne.LongBits(e.pushSeq.low>>>0,e.pushSeq.high>>>0).toNumber())),null!=e.subKey&&(t.subKey=0|e.subKey),null!=e.subId&&(t.subId=String(e.subId)),t},e.toObject=function(e,t){t||(t={});let n={};if(t.defaults){if(n.subRecId="",Ne.Long){let e=new Ne.Long(0,0,!1);n.pushSeq=t.longs===String?e.toString():t.longs===Number?e.toNumber():e}else n.pushSeq=t.longs===String?"0":0;n.subKey=0,n.subId=""}return null!=e.subRecId&&e.hasOwnProperty("subRecId")&&(n.subRecId=e.subRecId),null!=e.pushSeq&&e.hasOwnProperty("pushSeq")&&("number"==typeof e.pushSeq?n.pushSeq=t.longs===String?String(e.pushSeq):e.pushSeq:n.pushSeq=t.longs===String?Ne.Long.prototype.toString.call(e.pushSeq):t.longs===Number?new Ne.LongBits(e.pushSeq.low>>>0,e.pushSeq.high>>>0).toNumber():e.pushSeq),null!=e.subKey&&e.hasOwnProperty("subKey")&&(n.subKey=e.subKey),null!=e.subId&&e.hasOwnProperty("subId")&&(n.subId=e.subId),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,Oe.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/naturalcloudsyncv2.SubscribePushMessage"},e}(),e})();var Pe,ke=Ae.Field,Me=Ae.Schema,_e=Ae.SchemaField,je=Ae.FieldType,xe=Ae.OperationData,Ue=new u("ObjectWrapper"),qe=function(){function e(t,n,r){var o,i,s;if(this.creator="",this.objectVersion=0,this.objectTypeName="",this.values=n,this.operationType=r,r===R.DELETE){if(!n||0===n.length||!n[0].l)return void Ue.warn("invalid object version of delete wrapper object");this.objectVersion=n[0].l.toNumber()}else this.schema=Me.fromObject(Me.toObject(t,new Rt)),e.addSystemSchemaField(this.schema),this.objectTypeName=t.n,this.creator=null===(o=n[t.fs.indexOf(t.fs.find((function(e){return"naturalbase_creator"===e.n})))])||void 0===o?void 0:o.s,this.objectVersion=null===(s=null===(i=n[t.fs.indexOf(t.fs.find((function(e){return"naturalbase_version"===e.n})))])||void 0===i?void 0:i.l)||void 0===s?void 0:s.toNumber()}return e.findSchemaIndex=function(e,t){var n=-1,r=e.find((function(e,r){return e.n===t&&(n=r,!0)}));return[n,r]},e.addSystemSchemaField=function(e){var t=e.fs.find((function(e){return"naturalbase_creator"===e.n})),n=e.fs.find((function(e){return"naturalbase_version"===e.n})),r=e.fs.find((function(e){return"naturalbase_deleted"===e.n}));t||e.fs.push(_e.create({n:"naturalbase_creator",t:je.TYPE_STRING})),n||e.fs.push(_e.create({n:"naturalbase_version",t:je.TYPE_LONG})),r||e.fs.push(_e.create({n:"naturalbase_deleted",t:je.TYPE_BOOLEAN}))},e.buildObjs=function(t,n,r){var o,i,s=[];try{for(var a=b(t),u=a.next();!u.done;u=a.next()){var c=u.value,l=e.getClassName(c),d=g(this.findSchemaIndex(n,l),2),p=d[0],f=d[1];if(p<0||!f)throw C.build(1003);s.push(this.buildObj(c,f,r,p))}}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}return s},e.buildVerifyObjs=function(t,n){var r,o,i,s,a=[];try{for(var u=b(t),c=u.next();!c.done;c=u.next()){var l=c.value,d=g(e.findSchemaIndex(n,l.objectTypeName),2),p=d[0],f=d[1],y=l.toSyncObject();if(p<0||!f)throw C.build(1003);y.i=p,y.fs.push(ke.create({n:!1,bl:!1}));try{for(var h=(i=void 0,b(f.fs)),v=h.next();!v.done;v=h.next()){v.value.n.indexOf("#ope")>-1&&y.fs.splice(-3,0,ke.create({n:!0}))}}catch(e){i={error:e}}finally{try{v&&!v.done&&(s=h.return)&&s.call(h)}finally{if(i)throw i.error}}a.push(y)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}return a},e.buildTransactionData=function(e,t,n){var r,o,i;try{for(var s=b(t),a=s.next();!a.done;a=s.next()){var u=a.value,c=u.objectTypeName,l=u.operationType,d=u.operationType===w.SYNC_DELETE,p=u.objects,f=g(this.findSchemaIndex(n,c),2),y=f[0],h=f[1];if(y<0||!h)throw C.build(1003);var S=this.buildObjs(p,n,d),m=this.buildOperationData(S,l);(i=e.opData).push.apply(i,v(m))}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}},e.buildOperationData=function(e,t){var n,r,o,i=[],s=this.groupBy(e,"i");try{for(var a=b(s),u=a.next();!u.done;u=a.next()){var c=u.value,l=null===(o=c[0])||void 0===o?void 0:o.i;i.push(xe.create({os:c,t:t,i:l}))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i},e.groupBy=function(e,t){for(var n,r,o={},i=0;i<e.length;i++){var s=e[i],a=s[t];o[a]=o[a]||[],o[a].push(s)}var u=[];try{for(var c=b(Object.entries(o)),l=c.next();!l.done;l=c.next()){var d=g(l.value,2),p=(d[0],d[1]);u.push(p)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return u},e.buildSubObjs=function(e,n){var r,o,i,s,a=[];try{for(var u=b(e),c=u.next();!c.done;c=u.next()){var l=c.value,d=l.getUserObject(),p=[];try{for(var f=(i=void 0,b(n.fs)),y=f.next();!y.done;y=f.next()){var h=y.value;if("naturalbase_version"!==h.n){var g=ke.create(),v=h.t;g[Le.get(v)]=d[h.n],p.push(g)}else null!=l.objectVersion&&p.push(ke.create({l:t.fromNumber(l.objectVersion)}))}}catch(e){i={error:e}}finally{try{y&&!y.done&&(s=f.return)&&s.call(f)}finally{if(i)throw i.error}}a.push(Ae.Obj.create({fs:p}))}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}return a},e.buildObj=function(t,n,r,o){var i,s,a=[];try{for(var u=b(n.fs),c=u.next();!c.done;c=u.next()){var l=c.value,d=l.n,p=l.p;if("naturalbase_creator"===d)a.push(ke.create({n:!0}));else if("naturalbase_version"===d)a.push(ke.create({n:!0}));else if("naturalbase_deleted"===d)a.push(ke.create({n:!1,bl:r}));else{var f=t[d],y=l.t,h=void 0;h=!(p||!r)||e.isNullValue(f,y);var g=ke.create({n:h});h||(g[Le.get(y)]=y===je.TYPE_DATE?f.getTime():f),a.push(g)}}}catch(e){i={error:e}}finally{try{c&&!c.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}return Ae.Obj.create({fs:a,i:o})},e.isNullValue=function(e,t){var n;return null==e||(t===je.TYPE_DATE?!(e instanceof Date):t===je.TYPE_LONG&&"Long"!==(null===(n=null==e?void 0:e.constructor)||void 0===n?void 0:n.name))},e.getClassName=function(e){return e.constructor.className?e.constructor.className:e.constructor.name},e.prototype.toSyncObject=function(){var e=Ae.Obj.create();return e.fs=this.values,e},e.prototype.setObjectTypeName=function(e){this.objectTypeName=e.className?e.className:e.name},e.prototype.getUserObject=function(){return this.userObject},e.prototype.setUserObject=function(e){this.userObject=e},e.prototype.getObject=function(){for(var e=Me.toObject(this.schema,new Rt),n=this.values.map((function(e){return ke.toObject(e,{longs:t,defaults:!0})})),r={},o=0;o<n.length;o++){var i=e.fs[o],s=i.n,a=i.e?je.TYPE_BYTE_ARRAY:i.t,u=n[o],c=u.n,l=Le.get(a);r[s]=c?void 0:u[l]}return r},e.prototype.clone=function(){var t,n,r=[];try{for(var o=b(this.values),i=o.next();!i.done;i=o.next()){var s=i.value,a=ke.toObject(s,new Rt);r.push(ke.fromObject(a))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return new e(this.schema,r)},e.prototype.isValidVersion=function(){return 0!==this.objectVersion},e}(),Le=new Map;Le.set(je.TYPE_BOOLEAN,"bl"),Le.set(je.TYPE_BYTE,"b"),Le.set(je.TYPE_BYTE_ARRAY,"ba"),Le.set(je.TYPE_DATE,"l"),Le.set(je.TYPE_DOUBLE,"d"),Le.set(je.TYPE_FLOAT,"f"),Le.set(je.TYPE_INT32,"i"),Le.set(je.TYPE_LONG,"l"),Le.set(je.TYPE_SHORT,"st"),Le.set(je.TYPE_STRING,"s"),Le.set(je.TYPE_TEXT,"s"),Le.set(je.TYPE_AUTO_INCREMENT_INT,"i"),Le.set(je.TYPE_AUTO_INCREMENT_LONG,"l"),function(e){e[e.CONVENTIONAL_QUERY=0]="CONVENTIONAL_QUERY",e[e.AVG_QUERY=1]="AVG_QUERY"}(Pe||(Pe={}));var Ke,Ve=function(){};!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.NORMAL=1]="NORMAL",e[e.UPDATING=2]="UPDATING",e[e.INTERRUPT=3]="INTERRUPT"}(Ke||(Ke={}));var Be,Fe=function(){function e(){this.keyStatus_=Ke.DEFAULT,this.keyVersion_=0}return Object.defineProperty(e.prototype,"firstSaltValue",{get:function(){return this.firstSaltValue_},set:function(e){this.firstSaltValue_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"secondSaltValue",{get:function(){return this.secondSaltValue_},set:function(e){this.secondSaltValue_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rootKeyToken",{get:function(){return this.rootKeyToken_},set:function(e){this.rootKeyToken_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataKeyCipherText",{get:function(){return this.dataKeyCipherText_},set:function(e){this.dataKeyCipherText_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldDataKeyCipherText",{get:function(){return this.oldDataKeyCipherText_},set:function(e){this.oldDataKeyCipherText_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keyStatus",{get:function(){return this.keyStatus_},set:function(e){this.keyStatus_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keyVersion",{get:function(){return this.keyVersion_},set:function(e){this.keyVersion_=e},enumerable:!1,configurable:!0}),e.prototype.clear=function(){var e,t,n,r,o;null===(e=this.firstSaltValue_)||void 0===e||e.set([],0),null===(t=this.secondSaltValue_)||void 0===t||t.set([],0),null===(n=this.rootKeyToken_)||void 0===n||n.set([],0),null===(r=this.dataKeyCipherText_)||void 0===r||r.set([],0),null===(o=this.oldDataKeyCipherText_)||void 0===o||o.set([],0)},e}(),ze=function(){function e(e,t){this.encryptInfo_=[],this.resultCode_=0,this.resultCode_=e,this.encryptInfo_=t}return Object.defineProperty(e.prototype,"resultCode",{get:function(){return this.resultCode_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"encryptInfo",{get:function(){return this.encryptInfo_},enumerable:!1,configurable:!0}),e}(),Ge=new u("CommunicateTask"),Ye=function(){function e(e,t,n){this.delayMs=0,this.isCanceled=!1,this.task=e,this.func=e.request,this.delayMs=t,this.handle=n}return e.prototype.execute=function(){var e=this.handle;if(!this.isCanceled)try{this.func.call(this.task)}catch(t){Ge.error(t),null==e||e.handle(!1,t)}},e.prototype.getDelayMs=function(){return this.delayMs},e.prototype.cleanDelayMs=function(){this.delayMs=0},e.prototype.cancel=function(){this.isCanceled=!0},e}(),Qe=new u("CommunicateTaskQueue"),He=function(){function e(){this.tasks=[],this.taskId=0,this.head=0,this.isShutdown=!1,this.isExecuting=!1}return e.prototype.enqueueTask=function(e){if(this.isShutdown)return Qe.log("[CommunicateTaskQueue] enqueueTask fail due to shutdown!"),-1;var t=++this.taskId;return this.tasks.push(e),this.isExecuting||this.process(),t},e.prototype.process=function(){var e=this;this.isExecuting=!0;var t=this.tasks.splice(0,1);if(0===t.length)this.isExecuting=!1;else{this.head++;var n=t[0];this.timerHandle=setTimeout((function(){return y(e,void 0,void 0,(function(){return h(this,(function(e){return this.timerHandle||clearTimeout(this.timerHandle),n.execute(),this.process(),[2]}))}))}),n.getDelayMs())}},e}(),We=function(){function e(){}return e.setConfigAdapter=function(e){this.configClazz=e},e.getConfigInstance=function(){return this.configInstance||(this.configInstance=new this.configClazz),this.configInstance},e}(),Je=new u("WebSocketClient"),Xe=0,Ze=45e3;!function(e){e[e.Disconnected=0]="Disconnected",e[e.RequestToConnect=1]="RequestToConnect",e[e.Connecting=2]="Connecting",e[e.Connected=3]="Connected",e[e.Disconnecting=4]="Disconnecting"}(Be||(Be={}));var $e,et=function(){function e(e){this.msgId=0,this.connectionState=Be.Disconnected,this.isHeartBeatHasResp=0,this.isReconnecting=!1,this.isInitiativeStop=!1,this.keepaliveTimer=null,this.currentBaseMs=0,this.lastAttemptTime=Date.now(),this.backoffFactor=1.5,this.timerHandler=null,this.deviceId=0,this.currentVersion=0,this.isEnableBackUrl=!1,this.subscribeDatas=new Set,this.encryptRequest=new Set,this.unsubscribeCallbacks=new Map,this.isConnected=new x(!1),this.certificateService=e}return e.setClient=function(e){this.websocketAdapterClazz=e},e.prototype.registerConnectCallback=function(e){e&&(this.connectCallback=e)},e.prototype.registerDisconnectCallback=function(e){e&&(this.disconnectCallback=e)},e.prototype.start=function(t,n){if(this.isInitiativeStop=!1,this.keepaliveTimer||this.resetKeepAlive(),this.connectionState!==Be.Connected&&this.connectionState!==Be.Connecting){Je.info("start enter"),this.connectionState=Be.Connecting;var r=this.getWebSocketListeners(n);this.websocketAdapter=new e.websocketAdapterClazz(r,We.getConfigInstance().getRegionMap().get(this.certificateService.getAGCRoutePolicy())),this.websocketAdapter.connect(t)}else Je.info("websocket's already started, connectionState: "+this.connectionState)},e.prototype.stop=function(){return y(this,void 0,void 0,(function(){var e,t;return h(this,(function(n){switch(n.label){case 0:return this.connectionState===Be.Disconnecting||this.connectionState===Be.Disconnected?[2]:[4,this.certificateService.getHeaderParam()];case 1:return e=n.sent(),t={websocketMsgType:"UNREGISTER",websocketMsgId:this.msgId++,websocketMsgBody:{method:"POST",path:"/agc/apigw/clouddb/clouddbservice/sync/unregister",headers:e,body:""}},this.connectionState===Be.Connected&&this.simplifiedSendMessage(JSON.stringify(t)),this.connectionState=Be.Disconnecting,Je.info("start to stop"),this.websocketAdapter.close(),this.clearKeepAliveTimer(),[2]}}))}))},e.prototype.registerResponseCallback=function(e){e&&(this.responseCallback=e)},e.prototype.notifyResponseCallback=function(e,t){this.responseCallback&&this.responseCallback(e,t)},e.prototype.sendSubscribeRequest=function(e){return y(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return D.isNotNullObject(e)?(Je.info("sendSubscribeRequest state:"+this.connectionState),this.start(this.certificateService.getSubscribeOptions()),this.connectionState!==Be.Connected?(Je.log("sendSubscribeRequest: network is not available, schedule to sendMessages!"),this.subscribeDatas.add(e),[2]):((t=new Set).add(e),Je.log("sendSubscribeRequest start sendMessages"),[4,this.sendMessages(t)])):(Je.error("sendSubscribeRequest: Invalid request, stop to send!"),[2]);case 1:return n.sent(),[2]}}))}))},e.prototype.sendUnsubscribeRequest=function(e,t){return y(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return D.isNotNullObject(e)?(Je.info("sendUnsubscribeRequest state:"+this.connectionState),this.connectionState===Be.Disconnecting||this.connectionState===Be.Disconnected?(Je.info("sendUnsubscribeRequest it is not connect state, skip to send unsubscribe request!"),t.call(null),[2]):this.connectionState!==Be.Connected?[3,2]:((n=new Set).add(e),Je.log("sendUnsubscribeRequest start sendMessages"),this.unsubscribeCallbacks.set(e.taskId.toString(),t),[4,this.sendMessages(n)])):(Je.error("sendUnsubscribeRequest: Invalid request, stop to send!"),[2]);case 1:return r.sent(),[3,3];case 2:Je.log("sendUnsubscribeRequest connectionState: "+this.connectionState+", skip to send request."),r.label=3;case 3:return[2]}}))}))},e.prototype.getWebSocketListeners=function(e){var t,n=this;return t=this,{_onopen:function(){n.onOpen(t,e)},_onerror:function(e){n.onError(t)},_onclose:function(r,o,i){n.onClose(t,r,e)},_onmessage:function(e){n.onMessage(t,e)}}},e.prototype.onOpen=function(e,t){return y(this,void 0,void 0,(function(){var n,r;return h(this,(function(o){switch(o.label){case 0:return[4,this.certificateService.getHeaderParam()];case 1:return n=o.sent(),Je.info("onOpen enter"),e.connectionState=Be.Connected,e.currentVersion=e.currentVersion+1,r={websocketMsgType:"REGISTER",websocketMsgId:this.msgId++,websocketMsgBody:{method:"POST",path:"/agc/apigw/clouddb/clouddbservice/sync/register",params:{_v:$e.JSON},headers:n,body:""}},e.simplifiedSendMessage(JSON.stringify(r)),t&&t(),[2]}}))}))},e.prototype.subEncryption=function(e,t){return y(this,void 0,void 0,(function(){var n;return h(this,(function(r){switch(r.label){case 0:return Je.info("subEncryption enter: connectionState: "+this.connectionState),this.start(this.certificateService.getSubscribeOptions()),this.connectionState!==Be.Connected?(this.encryptRequest.add(e),Je.info("subEncryption: websocket has not established yet, schedule to add encryption listener!"),[2]):((n=new Set).add(e),[4,this.sendMessages(n)]);case 1:return r.sent(),t&&t(),Je.debug("subEncryption: sendMessages done!"),[2]}}))}))},e.prototype.sendMessages=function(e){return y(this,void 0,void 0,(function(){var t,n=this;return h(this,(function(r){switch(r.label){case 0:return e.size?[4,this.certificateService.getHeaderParam()]:[2];case 1:return t=r.sent(),e.forEach((function(r){r.deviceId=n.deviceId;var o={websocketMsgType:"COMMON_MSG",websocketMsgId:n.msgId++,websocketMsgBody:{method:"POST",path:"/agc/apigw/clouddb/clouddbservice/sync/message",params:{_v:$e.JSON},headers:t,body:JSON.stringify(Et.serializeMessage(r,n.certificateService))}};e.delete(r),n.simplifiedSendMessage(JSON.stringify(o))})),e.clear(),[2]}}))}))},e.prototype.onError=function(e){Je.info("onError enter"),e.resetConnectionState(),this.disconnectCallback&&this.disconnectCallback(this.isInitiativeStop),Je.debug("onError done")},e.prototype.onClose=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o,i,s;return h(this,(function(a){Je.info("onClose enter"),e.resetConnectionState(),Je.info("onClose message.code: "+t+" isReconnecting: "+e.isReconnecting),n&&n(),this.disconnectCallback&&(Je.info("onClose disconnectCallback is called"),this.disconnectCallback(this.isInitiativeStop)),Je.info("onClose done"),this.msgId=0,Je.info("Start release all unsubscribeCallbacks.");try{for(r=b(this.unsubscribeCallbacks.values()),o=r.next();!o.done;o=r.next())o.value.call()}catch(e){i={error:e}}finally{try{o&&!o.done&&(s=r.return)&&s.call(r)}finally{if(i)throw i.error}}return this.unsubscribeCallbacks.clear(),Je.info("Release all unsubscribeCallbacks success."),[2]}))}))},e.prototype.resetConnectionState=function(){this.clearKeepAliveTimer(),this.connectionState=Be.Disconnected,this.isConnected.value=!1},e.prototype.isReconnectingState=function(){return this.isReconnecting},e.prototype.sizeof=function(e){var t,n,r,o=0;for(n=0,r=e.length;n<r;n++)o+=(t=e.charCodeAt(n))<=127?1:t<=2047?2:t<=65535?3:4;return o},e.prototype.onMessage=function(e,t){if(Je.info("onMessage enter"),t){var n=void 0;try{n=JSON.parse(t)}catch(e){return void Je.error("onMessage: fail ,parse data failed, type =  "+typeof t+".")}Object.prototype.hasOwnProperty.call(n,"websocketMsgType")?this.handleAGCMessage(n,e,this):Je.warn("Unknown websocket message length = "+(null==t?void 0:t.length))}},e.prototype.handleAGCMessage=function(e,t,n){Je.info("receive agc push message msgId: "+e.websocketMsgId);var r=this.getAGCMsgHandlerMap().find((function(t){return t.agcMessageType===e.websocketMsgType}));r?(Je.info("handleAGCMessage websocketMsgType: "+e.websocketMsgType),r.handler(e,t,n)):Je.debug("handleAGCMessage: useless agcMessage responseType: "+(null==e?void 0:e.websocketMsgType))},e.prototype.getAGCMsgHandlerMap=function(){var e=this;return[{agcMessageType:"REGISTER_RSP",handler:function(t,n,r){var o=e.parseJson(t.websocketMsgBody.body).channelId;o&&(r.setDeviceId(o),r.resubscribeAll(),r.connectCallback&&r.connectCallback())}},{agcMessageType:"HEARTBEAT_RSP",handler:function(e,t,n){n.isHeartBeatHasResp=0;var r=1e3*Math.floor(e.websocketChannelIdleTimeout/3);Ze!==r&&(Ze=r,n.resetKeepAlive())}},{agcMessageType:"NOTIFY_MSG",handler:function(t,n,r){r.simplifiedSendMessage(JSON.stringify({websocketMsgType:"NOTIFY_MSG_RSP",websocketMsgId:t.websocketMsgId,websocketMsgBody:{status:200,body:"ok"}}));var o=e.parseJson(t.websocketMsgBody.body),i=o.msgInfo,s=i.id,a=i.type;a&&(e.unsubscribeCallbacks.delete(s),a!==T.QUERY_SUB&&a!==T.QUERY_UNSUB||Je.debug("TrafficStatistics:"+Xe+++".Receiver                         "+e.sizeof(t.websocketMsgBody.body)+"B."),n.notifyResponseCallback(!0,o))}}]},e.prototype.sendHeartBeatMessage=function(){var e=this,t=this;if(t.isHeartBeatHasResp++,this.connectionState===Be.Connected){var n={websocketMsgType:"HEARTBEAT",websocketMsgId:this.msgId++};setTimeout((function(){Je.debug("start check heartBeat response."),t.isHeartBeatHasResp>2&&(Je.warn("heartBeat timeout, lost "+t.isHeartBeatHasResp+" package."),e.connectionState=Be.Disconnecting,e.websocketAdapter.close({eventCode:3001})),Je.debug("check heartBeat response finish.")}),1e4),this.simplifiedSendMessage(JSON.stringify(n))}},e.prototype.resetKeepAlive=function(){var e=this;this.clearKeepAliveTimer(),Je.debug("resetKeepAlive enter."),this.sendHeartBeatMessage(),this.keepaliveTimer=setInterval((function(){e.sendHeartBeatMessage()}),Math.floor(Ze))},e.prototype.parseJson=function(e){var t={};if("string"!=typeof e)return Je.warn("parse json type error for"+typeof e),t;try{t=JSON.parse(e)}catch(t){Je.warn("Parse json error for"+t+",message length ="+(null==e?void 0:e.length))}return t},e.prototype.needReconnect=function(){return this.connectionState!==Be.Connected&&!this.isInitiativeStop},e.prototype.reconnect=function(){var e=this,t=Math.floor(1.5*this.currentBaseMs),n=Math.max(0,Date.now()-this.lastAttemptTime),r=Math.max(0,t-n);this.lastAttemptTime=Date.now(),Je.info("reconnect enter: remainingDelayMs: "+r+" connState: "+this.connectionState);var o=this.isEnableBackUrl?this.certificateService.getSubscribeBackOptions():this.certificateService.getSubscribeOptions();this.isEnableBackUrl=!this.isEnableBackUrl,this.timerHandler=setTimeout((function(){e.start(o,(function(){e.needReconnect()?(clearTimeout(e.timerHandler),e.isReconnecting=!0,e.reconnect()):(e.currentBaseMs=0,e.isReconnecting=!1)}))}),r),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<1e3&&(this.currentBaseMs=1e3),this.currentBaseMs>6e4&&(this.currentBaseMs=6e4)},e.prototype.clearKeepAliveTimer=function(){this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null)},e.prototype.stopHeartBeat=function(){this.isInitiativeStop=!0,this.clearKeepAliveTimer()},e.prototype.resubscribeAll=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return Je.info("schedule to resubscribeAll: "+this.encryptRequest.size+" "+this.subscribeDatas.size),[4,this.sendMessages(this.encryptRequest)];case 1:return e.sent(),[4,this.sendMessages(this.subscribeDatas)];case 2:return e.sent(),[2]}}))}))},e.prototype.simplifiedSendMessage=function(e,t,n){var r={data:e,success:t||function(){},fail:n||function(){}};Je.info("simplifiedSendMessage sendMessage"),this.websocketAdapter.sendMessage(r)},e.prototype.setDeviceId=function(e){this.deviceId=e,this.currentVersion++},e}(),tt="1.5.1",nt=new u("ContextWrapper"),rt=function(){function e(){}return e.setApplicationType=function(t){e.appType=t},e.getApplicationType=function(){return e.appType},e.setApplicationVersion=function(t){e.appVersion=t},e.getApplicationVersion=function(){return e.appVersion},e.getWSocketMessageType=function(e){var t,n,r,o;if(Object.prototype.hasOwnProperty.call(e,"msgInfo"))switch(nt.log("getWSocketMessageType responseType: "+(null===(t=e.msgInfo)||void 0===t?void 0:t.type)+" errorCode: "+(null===(n=e.resInfo)||void 0===n?void 0:n.resCode)),null===(r=e.msgInfo)||void 0===r?void 0:r.type){case T.QUERY_SUB:return"SubscribeResponse";case T.QUERY_SUB_PUSH:return"SnapshotUpdate";case T.QUERY_UNSUB:return"UnsubscribeResponse";case T.ENCRYPTION_TASK:return"EncryptionResponse";default:nt.warn("unknown WSocket message type "+(null===(o=e.msgInfo)||void 0===o?void 0:o.type))}return"ErrorMessage"},e.appType="Unknown",e.appVersion=tt,e}(),ot=Ae.SyncResponseMessage,it=new u("SyncRequestProcessor"),st=function(){function e(e){var t=this;this.webSocketResponse=new Map,this.taskMap=new Map,this.communicateTaskQueue=new He,this.subscribeTaskIdSet=new Set,this.subscribeRecordSet=new Set,this.certificateService=e,this.webSocketClient=new et(e),this.webSocketClient.registerResponseCallback((function(e,n){t.onWebSocketResponse(e,n)}))}return e.generateTaskId=function(){return this.taskId=this.taskId.add(1),this.taskId},e.setTraceId=function(e){this.traceId=e},e.generalTraceId=function(){return this.traceId?this.traceId:D.generateTraceId()},e.prototype.registerConnectCallback=function(e){var t=this;this.webSocketClient.registerConnectCallback((function(){t.hasSubscriber()&&(it.info("do clear subscribes onConnect."),t.clearSubscriber()),e.call(null)}))},e.prototype.registerDisconnectCallback=function(e){var t=this;this.webSocketClient.registerDisconnectCallback((function(n){t.needToConnectWebSocket()&&!t.webSocketClient.isReconnectingState()&&(it.info("do reconnect when there is Subscriber or encryptionMonitor onDisconnect."),t.webSocketClient.reconnect()),e.call(null,n)}))},e.prototype.registerWebSocketCallBack=function(e,t){var n,r;t.syncRequest&&t.syncRequest.taskId?this.taskMap.set((null===(r=null===(n=t.syncRequest)||void 0===n?void 0:n.taskId)||void 0===r?void 0:r.toString())||-1,t):this.webSocketResponse.set(e,t)},e.prototype.process=function(e){if(0!==this.verifyRequest())return it.warn("invalid request!"),void e.handle(1,new Ve);this.communicateTaskQueue.enqueueTask(new Ye(e,0,e.handle))},e.prototype.verifyRequest=function(){var e=this.certificateService.getContext();return D.isEmpty(e)?1014:e.productId?0:1014},e.prototype.onWebSocketResponse=function(e,t){var n,r,o,i,s,a=this;if(e){var u=ot.fromObject(t),c=rt.getWSocketMessageType(u),l={responseCode:(null===(n=u.resInfo)||void 0===n?void 0:n.resCode)||0,responseType:null===(r=u.msgInfo)||void 0===r?void 0:r.type,taskId:null===(o=u.msgInfo)||void 0===o?void 0:o.id,storeName:null===(s=null===(i=u.msgInfo)||void 0===i?void 0:i.opStore)||void 0===s?void 0:s.storeName},d=D.isNullOrUndefined(l.taskId)||l.taskId<=0?-1:l.taskId;it.info("onWebSocketResponse taskId: "+d+" responseType: "+l.responseType+"            dataType:"+c),(-1===d?v(this.webSocketResponse).filter((function(e){var t=g(e,2),n=t[0];t[1];return n===c})):v(this.taskMap).filter((function(e){var t=g(e,2),n=t[0];t[1];return n===d.toString()}))).forEach((function(e){var t=g(e,2);t[0];t[1].onResponse(u,l,a)})),-1!==d&&this.taskMap.delete(d.toString())}else it.error("onWebSocketResponse: fail!")},e.prototype.getSubscribeTaskIdSet=function(){return this.subscribeTaskIdSet},e.prototype.getSubscribeRecordSet=function(){return this.subscribeRecordSet},e.prototype.clearSubscriber=function(){this.subscribeRecordSet.clear(),this.subscribeTaskIdSet.clear()},e.prototype.hasSubscriber=function(){return 0!==this.subscribeRecordSet.size||0!==this.subscribeTaskIdSet.size},e.prototype.needToDisconnectWebsocket=function(){return!this.hasSubscriber()&&!this.encryptionInfoPush},e.prototype.needToConnectWebSocket=function(){return this.hasSubscriber()||!!this.encryptionInfoPush},e.prototype.disConnectWebSocket=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.webSocketClient.stop()];case 1:return e.sent(),[2]}}))}))},e.prototype.tryToDisconnectWebsocket=function(){this.encryptionInfoPush=void 0,this.hasSubscriber()?it.info("[tryToDisconnectWebsocket] won't disconnect websocket since there's subscriber!"):(this.webSocketClient.stop(),it.info("[tryToDisconnectWebsocket] since has no subscriber!"))},e.prototype.addEncryptStatusMonitor=function(e){this.encryptionInfoPush=e},e.prototype.getEncryptionInfoPush=function(){return this.encryptionInfoPush},e.prototype.getWebSocketClient=function(){return this.webSocketClient},e.taskId=t.fromNumber(1),e}(),at=function(){function e(){this.taskId_=st.generateTaskId(),this.encryptionVersion_=0,this.schemas_=[],this.traceId_=st.generalTraceId()}return Object.defineProperty(e.prototype,"schemas",{get:function(){return this.schemas_},set:function(e){this.schemas_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestSubType",{get:function(){return this.requestSubType_},set:function(e){this.requestSubType_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"requestType",{get:function(){return this.requestType_},set:function(e){this.requestType_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"traceId",{get:function(){return this.traceId_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"naturalStoreName",{get:function(){return this.naturalStoreName_},set:function(e){this.naturalStoreName_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"taskId",{get:function(){return this.taskId_},set:function(e){this.taskId_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"encryptionVersion",{get:function(){return this.encryptionVersion_},set:function(e){this.encryptionVersion_=e},enumerable:!1,configurable:!0}),e}(),ut=function(e){function t(){var t=e.call(this)||this;return t.objectList_=[],t.requestType=T.OBJECT_UPDATE,t}return f(t,e),Object.defineProperty(t.prototype,"objList",{get:function(){return this.objectList_},set:function(e){this.objectList_=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"operationType",{get:function(){return this.operationType_},set:function(e){this.operationType_=e},enumerable:!1,configurable:!0}),t}(at),ct=Ae.ClientInfo,lt=Ae.EncryptionInfo,dt=Ae.SyncResponseMessage,pt=Ae.SyncRequestMessage,ft=Ae.MessageInfo,yt=Ae.Store,ht=Ae.OperationData,bt=Ae.SubscribePushMessage,gt=Ae.Schema,vt=Ae.SchemaField,St=Ae.FieldType,mt=Ae.QueryRequestMessage,Tt=Ae.SubscribeRequestMessage,It=Ae.UnsubscribeRequestMessage,wt=Ae.ServerStatus,Rt=function(){this.longs=String,this.defaults=!0},Ot=new u("ProtoHelper"),Et=function(){function e(){}return e.serializeMessage=function(t,n){var r=pt.create(),o=ft.create();o.id=t.taskId;var i=yt.create();if(i.storeName=t.naturalStoreName||"",o.opStore=i,o.type=t.requestType,o.subType=t.requestSubType,o.traceId=t.traceId,Ot.info("[request] traceId:"+t.traceId+", requestType: "+t.requestType),r.clientInfo=e.buildClientInfo(n),r.msgInfo=o,r.clientInfo.enVer=t.encryptionVersion,o.type===T.QUERY_SUB)r.schemas=t.schemas.map((function(t){return e.schemaSub2Proto(t)}));else if(o.type!==T.SERVER_STATUS){var s=o.type!==T.SCHEMA_NEGOTIATE,a=!1;t instanceof ut&&(a=t.operationType===w.SYNC_DELETE),r.schemas=t.schemas.map((function(t){return e.schema2Proto(t,s,a)}))}var u=v(e.serializationActions())[o.type];if(!u)throw Ot.warn("unknown message type"+o.type),C.build(1008);if(u.call(null,t,r),e.isWebSocketMessageType(t))return pt.toObject(r,new Rt);var c=pt.encode(r).finish();return c.buffer.slice(c.byteOffset,c.byteOffset+c.length)},e.deserializeMessage=function(t){var n,r,o=dt.decode(new Uint8Array(t)),i=o.msgInfo,s=i.type,a=i.id,u={storeName:(null===(n=i.opStore)||void 0===n?void 0:n.storeName)||"",taskId:a,responseCode:(null===(r=o.resInfo)||void 0===r?void 0:r.resCode)||0,type:s,subType:i.subType||0,response:void 0};0!==u.responseCode&&Ot.warn("cloud sync not execute success , responseCode =  "+u.responseCode);var c=v(e.deserializationActions())[i.type];if(!c)throw Ot.warn("unknown message type"+s),C.build(1008);return u.response=c.call(null,u,o),u},e.parseValue=function(e,t){var n,r;if(!e||0===e.length)return[];var o=[];try{for(var i=b(e),s=i.next();!s.done;s=i.next()){s.value.os.forEach((function(e){o.push(new qe(t[e.i],e.fs))}))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o},e.schemaSub2Proto=function(e){var t=[];return v(e.getFieldInfos().values()).forEach((function(e){e.isPrimaryKey&&t.push(vt.fromObject({n:e.fieldName,t:e.fieldType}))})),t.push(vt.fromObject({n:"naturalbase_version",t:St.TYPE_LONG})),gt.create({n:e.name,fs:t})},e.schema2Proto=function(e,t,n){var r,o,i=[],s=[];try{for(var a=b(v(e.getFieldInfos().values())),u=a.next();!u.done;u=a.next()){var c=u.value,l=c.fieldType;t&&c.isEncryptField&&!n&&i.push(vt.create({n:c.fieldName+"#ope",t:St.TYPE_STRING}));var d=vt.create({n:c.fieldName,t:t&&c.isEncryptField?St.TYPE_BYTE_ARRAY:l,p:c.isPrimaryKey,e:c.isEncryptField,nn:c.isNotNull,df:c.hasDefaultValue});d.defaultValue=c.defaultValue,d[Le.get(l)]=c.defaultValue,n&&!c.isPrimaryKey||s.push(d)}}catch(e){r={error:e}}finally{try{u&&!u.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return gt.create({n:e.name,fs:s.concat(i)})},e.isWebSocketMessageType=function(e){var t=e.requestType;return t===T.QUERY_SUB||t===T.QUERY_UNSUB||t===T.ENCRYPTION_TASK&&(e.requestSubType===I.MONITOR_USER_COMMAND_CHANGE||e.requestSubType===I.MONITOR_DATA_KEY_CHANGE)},e.buildClientInfo=function(e){var t=e.getContext(),n=new Object({appVer:t.appVersion,msgVer:2,pid:t.productId,cid:t.clientId,aid:t.appId}),r=ct.verify(n);if(null!=r)throw Ot.warn(r),C.build(1003);return ct.fromObject(n)},e.objectUpdateDeserialization=function(e,t){return{queryId:t.msgInfo.id.toString(),successNumber:t.updateResMsg.successRecCount}},e.objectUpdateSerialization=function(e,t){t.schemas.forEach((function(e){qe.addSystemSchemaField(e)}));var n=e.operationType===w.SYNC_DELETE,r=qe.buildObjs(e.objList,t.schemas,n),o=ht.create({os:r,t:e.operationType,i:0});t.opData=[o]},e.encryptionDeserialization=function(e,t){var n=null==t?void 0:t.enResInfo;if(!n)throw Ot.error("ProtoHelper:deserializationActions encryption get invalid encryptionResponseMessage"),C.build("ProtoHelper:deserializationActions encryption get invalid encryptionResponseMessage");return{encryptionMessageType:t.msgInfo.subType,encryptionInfoList:n.map((function(e){var t=new Fe;return t.keyStatus=e.keyStatus,t.firstSaltValue=e.firstSalt,t.secondSaltValue=e.secondSalt,t.rootKeyToken=e.rootToken,t.dataKeyCipherText=e.cipherText,t.oldDataKeyCipherText=e.oldCipherText,t.keyVersion=e.keyVer,t}))}},e.encryptionSerialization=function(e,t){t.msgInfo.subType=e.requestSubType,t.msgInfo.type=T.ENCRYPTION_TASK,t.enReqInfo=e.requestInfo.map((function(e){return lt.create({keyStatus:e.keyStatus,firstSalt:e.firstSaltValue,secondSalt:e.secondSaltValue,rootToken:e.rootKeyToken,cipherText:e.dataKeyCipherText,oldCipherText:e.oldDataKeyCipherText,keyVer:e.keyVersion})}))},e.objectQueryDeserialization=function(t,n){var r,o=n.queryResMsg,i=n.opData,s=n.schemas;return{tableName:null===(r=s[0])||void 0===r?void 0:r.n,queryResult:o.isComplete,queryType:o.queryType,totalLength:i.length,aggreResult:o.aggQueryRes,responseObject:e.parseValue(i,s)}},e.objectQuerySerialization=function(e,t){t.queryReqMsg=mt.create({queryType:e.queryType,queryTable:e.tableName,queryCond:e.queryCondition})},e.transactionDeserialization=function(e,t){var n;return{transactionId:t.msgInfo.id.toString(),transactionResult:null===(n=t.resInfo)||void 0===n?void 0:n.resCode}},e.transactionSerialization=function(e,t){var n;t.schemas.forEach((function(e){qe.addSystemSchemaField(e)}));var r=t.schemas,o=e.verifyObjects,i=qe.buildVerifyObjs(o,r),s=qe.buildOperationData(i,w.VERIFY);(n=t.opData).push.apply(n,v(s));var a=e.transactionDatas;qe.buildTransactionData(t,a,r)},e.querySubscribeDeserialization=function(e,t){return{subscribeResults:t.subResMsg.map((function(e){return e.toJSON()}))}},e.querySubscribeSerialization=function(e,t){var n=[];t.subReqMsg=e.subscribeDatas.map((function(e){if(e.snapshotObjs&&e.snapshotObjs.length>0){var r=g(qe.findSchemaIndex(t.schemas,e.tableName),2),o=r[0],i=r[1];if(o<0||!i)throw C.build(1003);var s=qe.buildSubObjs(e.snapshotObjs,i);n.push(ht.create({os:s}))}return Tt.create({subId:e.subscribeId,subTable:e.tableName,subCond:e.subscribeCondition,subStore:e.naturalStoreName})})),t.opData=n},e.queryUnsubscribeDeserialization=function(e,t){return{unSubScribeResults:t.unSubResMsg.map((function(e){return e.toJSON()}))}},e.queryUnSubscribeSerialization=function(e,t){t.unSubReqMsg=e.unSubscribeDatas.map((function(e){return It.create({subRecId:e.cloudSubRecordId,unSubStore:e.naturalStoreName,unSubTable:e.tableName,subKey:e.cloudSubKey})}))},e.querySubPushDeserialization=function(e,t){var n,r,o=bt.toObject(t.subPushMsg,new Rt),i=t.schemas,s=t.opData.map((function(e){var t=ht.toObject(e,new Rt);return t.tableName=i[e.i].n,t})),a=(null===(r=null===(n=t.msgInfo)||void 0===n?void 0:n.opStore)||void 0===r?void 0:r.storeName)||"";return{pushSeq:o.pushSeq,storeName:a,subRecId:o.subRecId,subKey:o.subKey,subscribeId:o.subId,responseObject:s}},e.serverStatusQueryDeserialization=function(e,t){if(t.serverStatus){var n=wt.toObject(t.serverStatus,new Rt);return{serverTimestamp:Number(n.timestamp)}}return{}},e.serverStatusQuerySerialization=function(){},e.emptyFuncDeserialization=function(e,t){Ot.error("Call deserialization empty function.")},e.emptyFuncSerialization=function(e,t){Ot.error("Call serialization empty function.")},e.deserializationActions=function(){return[e.emptyFuncDeserialization,e.emptyFuncDeserialization,e.emptyFuncDeserialization,e.objectUpdateDeserialization,e.transactionDeserialization,e.objectQueryDeserialization,e.querySubscribeDeserialization,e.queryUnsubscribeDeserialization,e.querySubPushDeserialization,e.encryptionDeserialization,e.emptyFuncDeserialization,e.serverStatusQueryDeserialization]},e.serializationActions=function(){return[e.emptyFuncSerialization,e.emptyFuncSerialization,e.emptyFuncSerialization,e.objectUpdateSerialization,e.transactionSerialization,e.objectQuerySerialization,e.querySubscribeSerialization,e.queryUnSubscribeSerialization,e.emptyFuncSerialization,e.encryptionSerialization,e.emptyFuncDeserialization,e.serverStatusQuerySerialization]},e}();!function(e){e[e.PROTOBUF=3]="PROTOBUF",e[e.JSON=4]="JSON"}($e||($e={}));var Ct,Nt=function(e){function t(){var t=e.call(this)||this;return t.subscribeDatas_=[],t.requestType=T.QUERY_SUB,t}return f(t,e),Object.defineProperty(t.prototype,"subscribeDatas",{get:function(){return this.subscribeDatas_},set:function(e){this.subscribeDatas_=e},enumerable:!1,configurable:!0}),t}(at),Dt=function(){function e(){this.snapshotObjs_=[]}return Object.defineProperty(e.prototype,"naturalStoreName",{get:function(){return this.naturalStoreName_},set:function(e){this.naturalStoreName_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableName",{get:function(){return this.tableName_},set:function(e){this.tableName_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subscribeId",{get:function(){return this.subscribeId_},set:function(e){this.subscribeId_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subscribeCondition",{get:function(){return this.subscribeCondition_},set:function(e){this.subscribeCondition_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"snapshotObjs",{get:function(){return this.snapshotObjs_},set:function(e){this.snapshotObjs_=e},enumerable:!1,configurable:!0}),e}(),At=function(e){function t(){var t=e.call(this)||this;return t.requestType=T.OBJECT_QUERY,t}return f(t,e),Object.defineProperty(t.prototype,"tableName",{get:function(){return this.tableName_},set:function(e){this.tableName_=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queryCondition",{get:function(){return this.queryCondition_},set:function(e){this.queryCondition_=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"queryType",{get:function(){return this.queryType_},set:function(e){this.queryType_=e},enumerable:!1,configurable:!0}),t}(at),Pt=function(e){function t(){var t=e.call(this)||this;return t.verifyObjects_=[],t.transactionDatas_=[],t.requestType=T.TRANSACTION,t}return f(t,e),Object.defineProperty(t.prototype,"verifyObjects",{get:function(){return this.verifyObjects_},set:function(e){this.verifyObjects_=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transactionDatas",{get:function(){return this.transactionDatas_},set:function(e){this.transactionDatas_=e},enumerable:!1,configurable:!0}),t}(at),kt=function(e){function t(){var t=e.call(this)||this;return t.unSubscribeDatas_=[],t.requestType=T.QUERY_UNSUB,t}return f(t,e),Object.defineProperty(t.prototype,"unSubscribeDatas",{get:function(){return this.unSubscribeDatas_},set:function(e){this.unSubscribeDatas_=e},enumerable:!1,configurable:!0}),t}(at),Mt=function(){function e(){}return Object.defineProperty(e.prototype,"naturalStoreName",{get:function(){return this.naturalStoreName_},set:function(e){this.naturalStoreName_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableName",{get:function(){return this.tableName_},set:function(e){this.tableName_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cloudSubRecordId",{get:function(){return this.cloudSubRecordId_},set:function(e){this.cloudSubRecordId_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cloudSubKey",{get:function(){return this.cloudSubKey_},set:function(e){this.cloudSubKey_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"subscribeId",{get:function(){return this.subscribeId_},set:function(e){this.subscribeId_=e},enumerable:!1,configurable:!0}),e}(),_t=function(){},jt=function(e){function t(t,n,r){var o=e.call(this)||this;return o.syncRequest=t,o.handle=n,o.syncProcessor=r,o}return f(t,e),t}(_t),xt=new u("SubscribeTask"),Ut=function(e){function t(t,n,r,o){var i=e.call(this,t,r,o)||this;return i.syncRequest.encryptionVersion=n,i.onSubscribeResponse=r,i}return f(t,e),t.prototype.onResponse=function(e,t,n){var r,o=[];e.subResMsg.forEach((function(t){var r,i;i=1004008===(null===(r=e.resInfo)||void 0===r?void 0:r.resCode)?1004008:t.subResCode,o.push({cloudSubRecordId:null==t?void 0:t.subRecId,subscribeId:null==t?void 0:t.subId,subKey:null==t?void 0:t.subKey,result:i,subResponseCode:t.subResCode}),(null==t?void 0:t.subRecId)&&n.getSubscribeRecordSet().add(null==t?void 0:t.subRecId)})),t.response={subscribeResults:o},n.getSubscribeTaskIdSet().has(e.msgInfo.id.toString())&&(xt.info("[onResponse] subscribeTaskIdSet size : "+n.getSubscribeTaskIdSet().size),n.getSubscribeTaskIdSet().delete(e.msgInfo.id.toString())),xt.info("[onResponse] subscribeResults size : "+o.length),null===(r=this.onSubscribeResponse)||void 0===r||r.call(null,0,t)},t.prototype.request=function(){var e,t,n;xt.info("[request] taskId: "+this.syncRequest.taskId+"             requestType: "+this.syncRequest.requestType),this.syncRequest.taskId&&(null===(e=this.syncProcessor)||void 0===e||e.getSubscribeTaskIdSet().add(this.syncRequest.taskId.toString())),xt.info("[request] subscribeRecordSet len: "+(null===(t=this.syncProcessor)||void 0===t?void 0:t.getSubscribeRecordSet().size)),null===(n=this.syncProcessor)||void 0===n||n.getWebSocketClient().sendSubscribeRequest(this.syncRequest)},t}(jt),qt=new u("HttpsClient"),Lt=function(){function e(t){this.productId="",this.certificateService=t,this.httpAdapter=new e.httpAdapterClazz}return e.setClient=function(e){this.httpAdapterClazz=e},e.prototype.send=function(e,t,n,r){return y(this,void 0,void 0,(function(){return h(this,(function(o){switch(o.label){case 0:return D.isEmpty(this.certificateService.getContext())?(r(!1,C.build(1003)),[2]):(this.productId=this.certificateService.getContext().productId,!this.productId?(r(!1,C.build(1003)),[2]):[4,this.processRequest(this.certificateService.getUrl()+e,this.certificateService.getBackUrl()+e,t,n,r)]);case 1:return o.sent(),[2]}}))}))},e.prototype.processRequest=function(e,t,n,r,o){return y(this,void 0,void 0,(function(){var i,s,a;return h(this,(function(u){switch(u.label){case 0:i=r instanceof ArrayBuffer,s=i?r:JSON.stringify(r),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.certificateService.getHeaderParam(i)];case 2:return void 0===(a=u.sent())?(o(!1,C.build(1013)),[2]):(this.requestForSync(e,t,n,s,a,o),[3,4]);case 3:return u.sent(),o(!1,C.build(1011)),[2];case 4:return[2]}}))}))},e.prototype.requestForSync=function(e,t,n,r,o,i){var s={url:e,backUrl:t,method:n,header:o,data:r,success:function(e){i(!0,e.data),qt.log("requestForSync: success!")},fail:function(e){if(qt.error("HTTPS request process failed."),413!==e.status)i(!1,C.build(1011));else{qt.error("Request entity is too large.");var t=C.build(1006);i(!1,t)}}};qt.info("HTTP_ADAPTER send request"),this.httpAdapter.request(s)},e}(),Kt=new u("HttpRequestTask"),Vt=new Map([[T.SCHEMA_NEGOTIATE,"/negotiate"],[T.OBJECT_UPDATE,"/upsert"],[T.CACHE_UPDATE,"/upsert"],[T.OBJECT_QUERY,"/query"],[T.TRANSACTION,"/transaction"],[T.ENCRYPTION_TASK,"/encryption"],[T.SERVER_STATUS,"/query"]]),Bt=function(e){function t(t,n,r,o){var i=e.call(this)||this;return i.syncRequest=t,i.certificateService=r,i.syncRequest.encryptionVersion=n,i.handle=o,i}return f(t,e),t.prototype.request=function(){var e=this;Kt.info("[request] taskId:"+this.syncRequest.taskId+"             requestType: "+this.syncRequest.requestType+" encryptType: "+this.syncRequest.requestSubType);var n=Vt.get(this.syncRequest.requestType);t.httpResponseMap.set(this.syncRequest.taskId.toString(),this.handle),n?new Lt(this.certificateService).send(n.toString()+"?_v="+$e.PROTOBUF,"POST",Et.serializeMessage(this.syncRequest,this.certificateService),(function(n,r){var o,i;Kt.info("[request] isSuccess: "+n),n?D.isArrayBuffer(r)?e.onResponse(r):(Kt.warn("[request] Illegal http response content type = "+typeof r),Kt.warn(""+C.build(1010)),null===(o=t.httpResponseMap.get(e.syncRequest.taskId.toString()))||void 0===o||o.call(null,1010,new Ve),t.httpResponseMap.delete(e.syncRequest.taskId.toString())):(null===(i=t.httpResponseMap.get(e.syncRequest.taskId.toString()))||void 0===i||i.call(null,r.code,new Ve),t.httpResponseMap.delete(e.syncRequest.taskId.toString()))})):Kt.warn("request: requestType is not contained in REQUEST_URL_MAP!")},t.prototype.onResponse=function(e){var n,r=Et.deserializeMessage(e);0!==r.responseCode&&Kt.warn("[onResponse] CloudSyncResultCode = "+r.responseCode),Kt.info("[onResponse] taskId: "+r.taskId+" responseType: "+r.type+"             httpResponseMap size: "+t.httpResponseMap.size),t.httpResponseMap.has(r.taskId.toString())?(null===(n=t.httpResponseMap.get(r.taskId.toString()))||void 0===n||n.call(null,r.responseCode,r),t.httpResponseMap.delete(r.taskId.toString())):Kt.warn("[onResponse]: callback of the taskId has no register")},t.httpResponseMap=new Map,t}(_t),Ft=new u("UnSubscribeTask"),zt=function(e){function t(t,n,r,o){var i=e.call(this,t,r,o)||this;return i.syncRequest.encryptionVersion=n,i.onUnSubscribeResponse=i.handle,i}return f(t,e),t.prototype.onResponse=function(e,t,n){var r,o,i=[];null===(r=e.unSubResMsg)||void 0===r||r.forEach((function(e){i.push({cloudSubRecordId:null==e?void 0:e.unSubRecId,ExceptionCode:null==e?void 0:e.unSubResCode})})),t.response={unSubScribeResults:i},Ft.info("[onResponse] unSubScribeResults size: "+i.length+"             subscribeRecordSet.size "+n.getSubscribeRecordSet().size),null===(o=this.onUnSubscribeResponse)||void 0===o||o.call(null,0,t),n.needToDisconnectWebsocket()&&(Ft.info("[onResponse] stopHeartBeat since there is no subscriber."),n.getWebSocketClient().stopHeartBeat())},t.prototype.request=function(){var e,t,n,r,o,i=this;Ft.info("[request] taskId: "+this.syncRequest.taskId+"             requestType:"+this.syncRequest.requestType);try{for(var s=b(this.syncRequest.unSubscribeDatas),a=s.next();!a.done;a=s.next()){var u=a.value;null===(n=this.syncProcessor)||void 0===n||n.getSubscribeRecordSet().delete(u.cloudSubRecordId)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}Ft.info("[request] subscribeRecordSet.size "+(null===(r=this.syncProcessor)||void 0===r?void 0:r.getSubscribeRecordSet().size));var c=[];null===(o=this.syncProcessor)||void 0===o||o.getWebSocketClient().sendUnsubscribeRequest(this.syncRequest,(function(){i.syncRequest.unSubscribeDatas.forEach((function(e){c.push({cloudSubRecordId:e.cloudSubRecordId,errorCode:0})}));var e={responseCode:0,responseType:i.syncRequest.requestType,taskId:i.syncRequest.taskId,storeName:i.syncRequest.naturalStoreName,response:{unSubScribeResults:c}};i.onUnSubscribeResponse.call(null,0,e)}))},t}(jt),Gt=new u("CallbackTask"),Yt=function(){function e(){this.timerHandler=void 0,this.timeoutMs=0,this.isDone=!1}return e.prototype.timeoutMonitor=function(e){var t=this;Gt.debug("timeoutMonitor: enter"),this.timeoutMs>0&&(this.timerHandler=setTimeout((function(){t.timerHandler&&clearTimeout(t.timerHandler),Gt.log("timeoutMonitor: setTimeout reject isDone:"+t.isDone),t.isDone||(Gt.log("timeoutMonitor: setTimeout reject"),e(1004))}),this.timeoutMs))},e.prototype.execute=function(e){return y(this,void 0,void 0,(function(){var t=this;return h(this,(function(n){return[2,new Promise((function(n,r){t.timeoutMonitor(r),y(t,void 0,void 0,(function(){return h(this,(function(t){return Gt.log("executeWithTimeout: handle start calling"),[2,null==e?void 0:e.call(null)]}))})).then((function(e){t.isDone=!0,t.timerHandler&&clearTimeout(t.timerHandler),Gt.debug("executeWithTimeout: handle finished calling: resultCode = "+e.resultCode),n(e)})).catch((function(e){t.isDone=!0,r(e)}))}))]}))}))},e.prototype.executeWithTimeout=function(e,t){return y(this,void 0,void 0,(function(){var n=this;return h(this,(function(r){return this.timeoutMs=e,Gt.debug("executeWithTimeout: enter"),[2,new Promise((function(e,r){n.execute(t).then((function(t){Gt.debug("executeWithTimeout: execute done resultCode = "+t.resultCode),e(t)})).catch((function(t){n.isDone||Gt.error("executeWithTimeout: timeout!"),Gt.debug("executeWithTimeout: execute done resultCode = "+t.resultCode),e(t)}))}))]}))}))},e}(),Qt=function(e){function t(t,n,r){var o=e.call(this)||this;return o.requestInfo_=[],o.taskId_=r,o.requestType=T.ENCRYPTION_TASK,o.requestSubType=t,o.requestInfo_=n,o}return f(t,e),Object.defineProperty(t.prototype,"requestInfo",{get:function(){return this.requestInfo_},enumerable:!1,configurable:!0}),t}(at),Ht=new u("MonitorTask"),Wt=function(e){function t(t,n,r,o){var i=e.call(this,t,r,o)||this;return i.syncRequest.encryptionVersion=n,i}return f(t,e),t.prototype.onResponse=function(e,t,n){var r=e.msgInfo;if(r){var o=r.subType,i=e.enResInfo,s=null==i?void 0:i.length;Ht.info("[onResponse] messageType: "+o+" encryptionInfoList size:"+s),t.response={encryptionInfoList:e.enResInfo,encryptionMessageType:o},o===I.MONITOR_USER_COMMAND_CHANGE?this.userCommandMonitorResponse(0,t):o===I.MONITOR_DATA_KEY_CHANGE&&this.userKeyMonitorResponse(0,t)}else Ht.error("[onResponse] invalid encryptionResponseMessage!")},t.prototype.request=function(){Ht.info("MonitorTask taskId: "+this.syncRequest.taskId+"             encryptType: "+this.syncRequest.requestSubType),this.syncRequest.requestSubType===I.MONITOR_USER_COMMAND_CHANGE?this.commandMonitor(this.syncRequest,this.handle):this.syncRequest.requestSubType===I.MONITOR_DATA_KEY_CHANGE?this.userKeyMonitor(this.syncRequest,this.handle):Ht.warn("MonitorTask taskId: "+this.syncRequest.taskId+" is not need to call")},t.prototype.commandMonitor=function(e,t){var n;null===(n=this.syncProcessor)||void 0===n||n.getWebSocketClient().subEncryption(e,(function(){Ht.info("commandMonitorTask: add user command changed monitor success!")})),this.userCommandMonitorResponse=t},t.prototype.userKeyMonitor=function(e,t){var n;null===(n=this.syncProcessor)||void 0===n||n.getWebSocketClient().subEncryption(e,(function(){Ht.info("userKeyMonitorTask: add user key changed monitor success!")})),this.userKeyMonitorResponse=t},t}(jt),Jt=new u("EncryptTaskManager"),Xt=function(){function e(e,t){this.encryptTaskCacheMap=new Map,this.syncProcess=e,this.naturalBaseRef=t,this.naturalBaseRef.getEntireEncryptInterval().saveEncryptTaskManager(this)}return e.prototype.clearEncryptInfo=function(e){e.forEach((function(e){e.clear()})),e.length=0},e.prototype.addEncryptionListener=function(e){return y(this,void 0,void 0,(function(){var t,n=this;return h(this,(function(r){switch(r.label){case 0:return[4,this.processEncryptionTask(I.MONITOR_USER_COMMAND_CHANGE,[])];case 1:return 0!==(t=r.sent()).resultCode?(Jt.error("addEncryptionListener: add user command monitor fail: "+t.resultCode),[2]):[4,this.processEncryptionTask(I.MONITOR_DATA_KEY_CHANGE,[])];case 2:return 0!==(t=r.sent()).resultCode?(Jt.error("addEncryptionListener: add data key monitor fail: "+t.resultCode),[2]):(this.syncProcess.addEncryptStatusMonitor((function(t,r){0===t?(Jt.info("addEncryptionListener: receive notification success."),n.handleEncryptPushMessage(r,e)):Jt.warn("addEncryptionListener: get notification fail for "+t+".")})),Jt.info("addEncryptionListener: add user encryption changed monitor success!"),[2])}}))}))},e.prototype.tryToDisconnectWhenClearUserKey=function(){this.syncProcess.tryToDisconnectWebsocket()},e.prototype.processEncryptionTask=function(t,n){return y(this,void 0,void 0,(function(){var r,o,i,s=this;return h(this,(function(a){switch(a.label){case 0:return r=st.generateTaskId(),o=new Zt(t,r,n),this.encryptTaskCacheMap.set(r.toString(),o),Jt.info("processEncryptionTask: taskId: "+r+" encryptType: "+t),[4,o.executeWithTimeout(e.ENCRYPT_TASK_TIMEOUT_IN_MILLISECOND,(function(){return y(s,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return e=new Qt(o.requestSubType,o.requestInfo,o.taskId),[4,this.onEncryptTask(e)];case 1:return[2,t.sent()]}}))}))}))];case 1:return i=a.sent(),Jt.info("processEncryptionTask resultCode:"+i.resultCode),[2,i]}}))}))},e.prototype.onEncryptTask=function(e){return y(this,void 0,void 0,(function(){var t=this;return h(this,(function(n){switch(n.label){case 0:return[4,new Promise((function(n,r){var o,i=function(e,o){if(Jt.debug("onWebsocketTask: handle encrypt resultCode: "+e),0!==e)return Jt.error("onWebsocketTask: fail to send encrypt task!"),void r(new ze(e,[]));n(t.handleEncryptTaskResult(o))};e.requestSubType===I.MONITOR_USER_COMMAND_CHANGE||e.requestSubType===I.MONITOR_DATA_KEY_CHANGE?(o=new Wt(e,t.naturalBaseRef.getEntireEncryption().GetEncryptVersion(),i,t.syncProcess),t.syncProcess.registerWebSocketCallBack("EncryptionResponse",o)):o=new Bt(e,t.naturalBaseRef.getEntireEncryption().GetEncryptVersion(),t.naturalBaseRef.getCertificateService(),i),t.syncProcess.process(o)}))];case 1:return[2,n.sent()]}}))}))},e.prototype.querySaltValue=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){return Jt.debug("querySaltValue start"),[2,this.processEncryptionTask(I.QUERY_SALT_VALUE,[])]}))}))},e.prototype.queryDataKeyCipherText=function(e){var t;return y(this,void 0,void 0,(function(){return h(this,(function(n){return Jt.info("queryDataKeyCipherText start"),0===(null===(t=e.rootKeyToken)||void 0===t?void 0:t.length)?(Jt.error("queryDataKeyCipherText fail: requestInfo rootKeyToken is empty!"),[2,Promise.reject(1e6)]):[2,this.processEncryptionTask(I.QUERY_CIPHER_TEST,[e])]}))}))},e.prototype.insertEncryptedInfo=function(e){var t,n,r,o;return y(this,void 0,void 0,(function(){return h(this,(function(i){return Jt.info("insertEncryptedInfo start"),0===(null===(t=e.firstSaltValue)||void 0===t?void 0:t.length)||0===(null===(n=e.secondSaltValue)||void 0===n?void 0:n.length)||0===(null===(r=e.rootKeyToken)||void 0===r?void 0:r.length)||0===(null===(o=e.dataKeyCipherText)||void 0===o?void 0:o.length)?(Jt.error("insertEncryptedInfo fail: insert encrypt info contains empty buffer!"),[2,Promise.reject(1e6)]):[2,this.processEncryptionTask(I.INSERT_ENCRYPTION_INFO,[e])]}))}))},e.prototype.updateEncryptedInfo=function(e,t){var n,r,o,i,s;return y(this,void 0,void 0,(function(){return h(this,(function(a){return Jt.info("updateEncryptedInfo start"),0===(null===(n=e.rootKeyToken)||void 0===n?void 0:n.length)?(Jt.error("updateEncryptedInfo: old encrypt rootKeyToken is null!"),[2,Promise.reject(1e6)]):0===(null===(r=t.firstSaltValue)||void 0===r?void 0:r.length)||0===(null===(o=t.secondSaltValue)||void 0===o?void 0:o.length)||0===(null===(i=t.rootKeyToken)||void 0===i?void 0:i.length)||0===(null===(s=t.dataKeyCipherText)||void 0===s?void 0:s.length)?(Jt.error("updateEncryptedInfo: new encrypt contains empty buffer!"),[2,Promise.reject(1e6)]):[2,this.processEncryptionTask(I.UPDATE_ENCRYPTION_INFO,[e,t])]}))}))},e.prototype.handleEncryptTaskResult=function(e){var t,n,r=e.responseCode;if(0!==r)return Jt.warn("handleEncryptTaskResult: cloud encryption exception occurs!"),new ze(r,[]);var o=this.encryptTaskCacheMap.get(e.taskId.toString());if(!o)return Jt.error("handleEncryptTaskResult: invalid encryptTask, taskId: "+e.taskId),new ze(1007,[]);var i=e.response;if(Jt.info("handleEncryptTaskResult: taskId: "+e.taskId+"             encryptType: "+i.encryptionMessageType+"             responseInfo size:"+(null===(t=i.encryptionInfoList)||void 0===t?void 0:t.length)),o.requestSubType!==i.encryptionMessageType)return Jt.error("handleEncryptTaskResult: response encrypt type does not matched with task encrypt type"),this.clearEncryptInfo(o.requestInfo),this.encryptTaskCacheMap.delete(e.taskId.toString()),new ze(1007,[]);var s=[];return null===(n=i.encryptionInfoList)||void 0===n||n.forEach((function(e){s.push(e)})),this.clearEncryptInfo(o.requestInfo),this.encryptTaskCacheMap.delete(e.taskId.toString()),Jt.debug("handleEncryptTaskResult: encryptTaskCacheMap size: "+this.encryptTaskCacheMap.size),new ze(0,s)},e.prototype.handleEncryptPushMessage=function(e,t){var n;if(!t)return Jt.error("handleEncryptPushMessage: no encryption monitor registered!"),0;var r=new Map([[I.NOTIFY_ENCRYPTION_COMMAND_CHANGED,function(e){e.onUserCommandChanged()}],[I.NOTIFY_ENCRYPTION_KEY_CHANGE_TO_NORMAL,function(e){e.onKeyChanged(Ke.NORMAL)}],[I.NOTIFY_ENCRYPTION_KEY_CHANGE_TO_UPDATING,function(e){e.onKeyChanged(Ke.UPDATING)}],[I.NOTIFY_ENCRYPTION_KEY_CHANGE_TO_UPDATE_INTERRUPT,function(e){e.onKeyChanged(Ke.INTERRUPT)}]]),o=e.response.encryptionMessageType;return Jt.info("handleEncryptPushMessage: notificationType: "+o),r.has(o)?(null===(n=r.get(o))||void 0===n||n.call(null,t),0):(Jt.error("handleEncryptPushMessage: invalid encryption push type!"),1007)},e.ENCRYPT_TASK_TIMEOUT_IN_MILLISECOND=6e4,e}(),Zt=function(e){function n(n,r,o){var i=e.call(this)||this;return i.taskId_=t.fromNumber(0),i.resultCode_=0,i.requestInfo_=[],i.taskId_=r,i.requestSubType_=n,o.forEach((function(e){i.requestInfo_.push(e)})),i}return f(n,e),Object.defineProperty(n.prototype,"requestSubType",{get:function(){return this.requestSubType_},set:function(e){this.requestSubType_=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"taskId",{get:function(){return this.taskId_},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"resultCode",{get:function(){return this.resultCode_},set:function(e){this.resultCode_=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"requestInfo",{get:function(){return this.requestInfo_},enumerable:!1,configurable:!0}),n.prototype.clearRequestInfo=function(){this.requestInfo_=[]},n}(Yt),$t=new u("SnapshotUpdateTask"),en=function(){function e(e){this.onPush=e}return e.prototype.onResponse=function(e,t){var n,r,o=e.opData,i=e.schemas,s=i?null===(n=i[0])||void 0===n?void 0:n.n:void 0,a=[],u=e.subPushMsg,c={pushSeq:u.pushSeq.toNumber(),storeName:e.msgInfo.opStore.storeName,subKey:u.subKey,subRecId:u.subRecId,subscribeId:u.subId,responseObject:a,tableName:s,operationType:(null==o?void 0:o.length)>0?null===(r=o[0])||void 0===r?void 0:r.t:void 0};o.forEach((function(e){e.os.forEach((function(t){var n=t.fs;a.push(new qe(i[0],n,e.t))}))}));var l=a.length;$t.info("[onResponse] enter, responseObjects size:"+(l||0)),t.response=c,this.onPush(t.responseCode,t)},e}(),tn=new u("EncryptionInfoPushTask"),nn=function(){function e(){}return e.prototype.onResponse=function(e,t,n){var r,o=e.msgInfo;if(o){var i=o.subType,s=e.enResInfo,a=null==s?void 0:s.length;tn.info("[onResponse] messageType: "+i+" encryptionInfoList size:"+a),t.response={encryptionInfoList:e.enResInfo,encryptionMessageType:i},null===(r=null==n?void 0:n.getEncryptionInfoPush())||void 0===r||r.call(null,0,t)}else tn.error("[onResponse] invalid encryptionResponseMessage!")},e}(),rn=function(e){function t(){var t=e.call(this)||this;return t.requestType=T.SERVER_STATUS,t}return f(t,e),t}(at);!function(e){e[e.ALL_STORE=1]="ALL_STORE",e[e.STORE=2]="STORE",e[e.DEFAULT_SUBSCRIBE=3]="DEFAULT_SUBSCRIBE"}(Ct||(Ct={}));var on=new u("NaturalCloudSyncModule"),sn=function(){function e(e){var t=this;this.subTunnelFail=!1,this.isInitiativeStop=!1,this.naturalBaseRef=e,this.syncInstance=new st(e.getCertificateService()),this.syncInstance.registerWebSocketCallBack("SnapshotUpdate",new en((function(e,n){t.handleQuerySubPushRes(n)}))),this.syncInstance.registerWebSocketCallBack("EncryptionResponse",new nn),this.syncInstance.registerConnectCallback((function(){return y(t,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.onConnect()];case 1:return e.sent(),[2]}}))}))})),this.syncInstance.registerDisconnectCallback((function(e){t.onDisconnect(e)})),this.encryptTaskManager=new Xt(this.syncInstance,this.naturalBaseRef)}return e.prototype.getSubscribeInfos=function(e){return y(this,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c,l,d,p,f;return h(this,(function(y){switch(y.label){case 0:t=[],n=0,r=e.getAllSubscribeInfo(),y.label=1;case 1:y.trys.push([1,7,8,9]),o=b(r.values()),i=o.next(),y.label=2;case 2:return i.done?[3,6]:(s=i.value,[4,this.naturalBaseRef.getEntireEncryption().isValidEncryptionOperation(s.cloudDBZoneQuery.getClassName()).catch((function(e){return(null==e?void 0:e.getCode())||0}))]);case 3:return a=y.sent(),u=t,c=n++,l=[s.queryId,s.cloudDBZoneQuery.getClassName()],[4,e.getQueryConditionByString(s.cloudDBZoneQuery.getClassName(),s.cloudDBZoneQuery.getQueryConditions())];case 4:u[c]=l.concat([y.sent(),a,s.cloudSubRecordId]),s.pushSeq=0,y.label=5;case 5:return i=o.next(),[3,2];case 6:return[3,9];case 7:return d=y.sent(),p={error:d},[3,9];case 8:try{i&&!i.done&&(f=o.return)&&f.call(o)}finally{if(p)throw p.error}return[7];case 9:return[2,t]}}))}))},e.prototype.getSubInfoByRange=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l;return h(this,(function(d){switch(d.label){case 0:switch(r=new Map,o=[],e){case Ct.ALL_STORE:return[3,1];case Ct.STORE:return[3,9];case Ct.DEFAULT_SUBSCRIBE:return[3,11]}return[3,12];case 1:d.trys.push([1,6,7,8]),i=b(this.naturalBaseRef.getAllNaturalStore()),s=i.next(),d.label=2;case 2:return s.done?[3,5]:(a=s.value,[4,this.getSubscribeInfos(a)]);case 3:if(0===(o=d.sent()).length)return[3,4];r.set(a.getNaturalStoreName(),o),d.label=4;case 4:return s=i.next(),[3,2];case 5:return[3,8];case 6:return u=d.sent(),c={error:u},[3,8];case 7:try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}return[7];case 8:return[3,12];case 9:return t?[4,this.getSubscribeInfos(t)]:(on.warn("STORE subscribe should pass store"),[3,12]);case 10:return 0===(o=d.sent()).length||r.set(t.getNaturalStoreName(),o),[3,12];case 11:return t&&n?(r.set(t.getNaturalStoreName(),[n]),[3,12]):(on.warn("DEFAULT_SUBSCRIBE subscribe should pass store and defaultSubscribeInfo"),[3,12]);case 12:return[2,r]}}))}))},e.prototype.getUnSubInfoByRange=function(e,t,n){var r=new Map,o=[];switch(e){case Ct.ALL_STORE:this.naturalBaseRef.getAllNaturalStore().forEach((function(e){0!==(o=e.getAllSubscribeInfos()).length&&r.set(e.getNaturalStoreName(),o)}));break;case Ct.STORE:if(!t){on.warn("STORE subscribe should pass store");break}if(0===(o=t.getAllSubscribeInfos()).length)break;r.set(t.getNaturalStoreName(),o);break;case Ct.DEFAULT_SUBSCRIBE:if(!t||!n){on.warn("DEFAULT_SUBSCRIBE unsubscribe should pass store and defaultSubscribeInfo");break}r.set(t.getNaturalStoreName(),[n])}return r},e.prototype.onConnect=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return on.info("onConnect: subTunnelFail: "+this.subTunnelFail),this.subTunnelFail?(this.subTunnelFail=!1,this.isInitiativeStop=!1,[4,this.naturalBaseRef.onConnect()]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.subscribeForRekey=function(){return y(this,void 0,void 0,(function(){var e,t,n=this;return h(this,(function(r){switch(r.label){case 0:return on.info("subscribeForRekey start"),[4,this.checkStatus()];case 1:return r.sent(),[4,this.getSubInfoByRange(Ct.ALL_STORE)];case 2:return 0===(e=r.sent()).size?(on.warn("subscribeForRekey: no subscriber in all store!"),[2,Promise.resolve(0)]):(t=0,e.forEach((function(e,r){return y(n,void 0,void 0,(function(){var n,o,i,s=this;return h(this,(function(a){switch(a.label){case 0:return(n=new Nt).naturalStoreName=r,o=[],e.forEach((function(e){var n=g(e,4),i=n[0],a=n[1],u=n[2],c=n[3],l=s.naturalBaseRef.getDefaultNaturalStore().getAppSchema().get(a);if(void 0!==c&&0!==c)t=c,on.error("get subscribeInfo fail for "+c+",queryId = "+i);else if(null==l?void 0:l.isEncryptTable()){var d=new Dt;d.subscribeId=i.toString(),d.subscribeCondition=u,d.tableName=a,d.naturalStoreName=r,o.push(d)}})),n.subscribeDatas=o,n.subscribeDatas&&n.subscribeDatas.length?[3,1]:(on.info("subscribeForRekey: subscribeData is empty, no need to send request!"),[3,3]);case 1:return[4,this.processSubRequest(n,this.handleQuerySubRes)];case 2:i=a.sent(),t=0!==i?i:t,on.info("subscribeForRekey result = "+t),a.label=3;case 3:return[2]}}))}))})),[2,Promise.resolve(t)])}}))}))},e.prototype.unsubscribeForRekey=function(){return y(this,void 0,void 0,(function(){var e,t,n=this;return h(this,(function(r){switch(r.label){case 0:return on.info("unsubscribeForRekey start"),[4,this.checkStatus()];case 1:return r.sent(),0===(e=this.getUnSubInfoByRange(Ct.ALL_STORE)).size?(on.warn("unsubscribeForRekey: no subscriber in all store!"),[2,Promise.resolve(0)]):(t=0,e.forEach((function(e,r){return y(n,void 0,void 0,(function(){var n,o,i,s=this;return h(this,(function(a){switch(a.label){case 0:return(n=new kt).naturalStoreName=r,o=[],e.forEach((function(e){var t=e[3],n=s.naturalBaseRef.getDefaultNaturalStore().getAppSchema().get(t);if(null==n?void 0:n.isEncryptTable()){var i=new Mt;i.subscribeId=e[0].toString(),i.cloudSubRecordId=e[1],i.cloudSubKey=e[2],i.tableName=t,i.naturalStoreName=r,o.push(i)}})),n.unSubscribeDatas=o,n.unSubscribeDatas&&n.unSubscribeDatas.length?[3,1]:(on.info("unsubscribeForRekey: subscribeData is empty, no need to send request!"),[3,3]);case 1:return[4,this.processSubRequest(n,this.handleQueryUnsubRes)];case 2:i=a.sent(),t=0!==i?i:t,on.info("unsubscribeForRekey result = "+t),a.label=3;case 3:return[2]}}))}))})),[2,Promise.resolve(t)])}}))}))},e.prototype.onDisconnect=function(e){this.isInitiativeStop=e,on.warn("onDisconnect isInitiativeStop:"+this.isInitiativeStop),this.isInitiativeStop||(this.subTunnelFail=!0)},e.prototype.disconnectWebSocket=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.syncInstance.disConnectWebSocket()];case 1:return e.sent(),[2]}}))}))},e.prototype.needToDisconnectWebsocket=function(){return this.syncInstance.needToDisconnectWebsocket()},e.prototype.handleQuerySubRes=function(e,t){var n=0,r=e.response;return t?(r.subscribeResults.forEach((function(e){var r=t.handleSubscribeRes(e.subResponseCode,Number(e.subscribeId),e.cloudSubRecordId,e.subKey);n=0!==r?r:n})),n):(on.error("NaturalCloudSyncModule: handleQuerySubRes store is null!"),1)},e.prototype.handleQueryUnsubRes=function(e,t){var n,r=0,o=e.response;return 0!==e.responseCode&&on.warn("handleQueryUnsubRes receive an error from cloud side,"+e.responseCode+",\n                unSubScribeResults size = "+(null===(n=null==o?void 0:o.unSubScribeResults)||void 0===n?void 0:n.length)),t instanceof Re&&(null==o||o.unSubScribeResults.forEach((function(e){var n=t.handleUnsubscribeRes(e.unSubRecId,e.unSubResCode);r=0!==n?n:r}))),r},e.prototype.handleQuerySubPushRes=function(e){var t=e.response,n=this.naturalBaseRef.getNaturalStore(e.storeName);if(n){var r=n.getSubscribeInfoByCloudSubRecordId(t.subRecId);if(!r){if(!n.isSubscribeNotResponsed(t.subscribeId)){on.warn("unknown subscribe push of "+t.subRecId);var o=[0,t.subRecId,t.subKey,t.tableName];return void this.onUnSubscribe(Ct.DEFAULT_SUBSCRIBE,n,o)}if(!this.handlePushWithQueryId(t))return void on.warn("handlePushWithQueryId failed and ignore response");if(!(r=n.getSubscribeInfoByCloudSubRecordId(t.subRecId)))return void on.warn("retry set response for subscribe failed and ignore sub push")}if(0!==e.responseCode)return on.log("SubPush errorCode for "+e.responseCode),void n.handleSubPushRes(r,e.responseCode);r.pushSeq>=Number(t.pushSeq)?on.log("ignore old pushSeq from cloud local:"+r.pushSeq+"                 >= received:"+t.pushSeq):(r.pushSeq=t.pushSeq,on.log("Subscribe Info Push Sequence Number: "+r.pushSeq),n.handleSubPushRes(r,0,t.responseObject,t.operationType))}else on.error("NaturalCloudSyncModule: handleQuerySubPushRes store is null!")},e.prototype.handlePushWithQueryId=function(e){var t=this.naturalBaseRef.getNaturalStore(e.storeName);return t?(t instanceof Re&&t.handleSubscribeRes(0,Number(e.subscribeId),e.subRecId,e.subKey),!0):(on.error("handlePushWithQueryId failed for store is null!"),!1)},e.prototype.onQuery=function(e,t,n){return y(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,this.processCRUDRequest(this.createSyncQueryRequest(e,t,n,Pe.CONVENTIONAL_QUERY))];case 1:return[2,r.sent().responseObject]}}))}))},e.prototype.onAggregateQuery=function(e,t,n){return y(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,this.processCRUDRequest(this.createSyncQueryRequest(e,t,n,Pe.AVG_QUERY))];case 1:return[2,r.sent().aggreResult]}}))}))},e.prototype.createSyncQueryRequest=function(e,t,n,r){var o=new At;return o.naturalStoreName=e,o.tableName=t,o.queryCondition=n,o.queryType=r,o},e.prototype.onUpsert=function(e,t){return y(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,this.processCRUDRequest(this.createSyncObjectRequest(e,T.OBJECT_UPDATE,w.SYNC_UPSERT,t))];case 1:return[2,n.sent().successNumber]}}))}))},e.prototype.onDelete=function(e,t){return y(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,this.processCRUDRequest(this.createSyncObjectRequest(e,T.OBJECT_UPDATE,w.SYNC_DELETE,t))];case 1:return[2,n.sent().successNumber]}}))}))},e.prototype.createSyncObjectRequest=function(e,t,n,r){var o=new ut;o.naturalStoreName=e,o.requestType=t,o.operationType=n,o.objList=r;var i=new Set;return r.forEach((function(e){i.add(D.getClassName(e))})),o.schemas=this.buildSchemas(v(i)),o},e.prototype.buildSchemas=function(e){var t,n,r=[];try{for(var o=b(e),i=o.next();!i.done;i=o.next()){var s=i.value,a=this.naturalBaseRef.getDefaultNaturalStore().getAppSchema().get(s);a&&r.push(a)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},e.prototype.processCRUDRequest=function(e){return y(this,void 0,void 0,(function(){var t=this;return h(this,(function(n){return[2,new Promise((function(n,r){t.syncInstance.process(new Bt(e,t.naturalBaseRef.getEntireEncryption().GetEncryptVersion(),t.naturalBaseRef.getCertificateService(),(function(e,t){0===e?n(t.response):r(e)})))}))]}))}))},e.prototype.onSubscribe=function(e,t,n,r){return y(this,void 0,void 0,(function(){var o,i,s=this;return h(this,(function(a){switch(a.label){case 0:return[4,this.checkStatus(e,n)];case 1:return a.sent(),[4,this.getSubInfoByRange(e,t,n)];case 2:return 0===(o=a.sent()).size?[2,Promise.resolve(0)]:(i=[],o.forEach((function(e,t){return y(s,void 0,void 0,(function(){var n,o;return h(this,(function(s){return n=new Set,(o=new Nt).naturalStoreName=t,o.subscribeDatas=this.buildSubscribeData(e,t,n,r),o.schemas=this.buildSchemas(v(n)),o.subscribeDatas&&o.subscribeDatas.length?i.push(o):on.info("onSubscribe: subscribeData is empty, no need to send request!"),[2]}))}))})),[4,Promise.all(i.map((function(e){return s.processSubRequest(e,s.handleQuerySubRes)})))]);case 3:return a.sent().forEach((function(e){on.info("Subscribe store "+(null==t?void 0:t.getNaturalStoreName())+",result = "+e)})),[2,Promise.resolve(0)]}}))}))},e.prototype.buildSubscribeData=function(e,t,n,r){var o=this.naturalBaseRef.getNaturalStore(t),i=[];return e.forEach((function(e){var s=g(e,5),a=s[0],u=s[1],c=s[2],l=s[3],d=s[4];if(void 0===l||0===l){var p=new Dt;if(p.subscribeId=a.toString(),p.tableName=u,r&&d){n.add(u);var f=o.getSubscribeInfoByCloudSubRecordId(d);p.snapshotObjs=f.getSnapshotCache()}p.subscribeCondition=c,p.naturalStoreName=t,i.push(p)}})),i},e.prototype.processSubRequest=function(e,t){return y(this,void 0,void 0,(function(){var n=this;return h(this,(function(r){return[2,new Promise((function(r){var o,i=function(e,o){r(0===e?t(o,n.naturalBaseRef.getNaturalStore(o.storeName)):e)};e.requestType===T.QUERY_SUB?(o=new Ut(e,n.naturalBaseRef.getEntireEncryption().GetEncryptVersion(),i,n.syncInstance),n.syncInstance.registerWebSocketCallBack("SubscribeResponse",o)):(o=new zt(e,n.naturalBaseRef.getEntireEncryption().GetEncryptVersion(),i,n.syncInstance),n.syncInstance.registerWebSocketCallBack("UnsubscribeResponse",o)),n.syncInstance.process(o)}))]}))}))},e.prototype.onUnSubscribe=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d,p;return h(this,(function(f){switch(f.label){case 0:return n&&!n[1]?(on.info("Skip to unsubscribe to cloud since cloudSyncSubrecordId is invalid."),this.syncInstance.needToDisconnectWebsocket()&&(on.info("Stop heartbeat since there is no subscriber."),this.syncInstance.getWebSocketClient().stopHeartBeat()),[2,Promise.resolve(0)]):[4,this.checkStatus(e,n)];case 1:if(f.sent(),0===(r=this.getUnSubInfoByRange(e,t,n)).size)return[2,Promise.resolve(0)];o=0,f.label=2;case 2:f.trys.push([2,8,9,10]),i=b(r),s=i.next(),f.label=3;case 3:return s.done?[3,7]:(a=s.value,(u=this.createUnSubscribeRequest(a)).unSubscribeDatas&&u.unSubscribeDatas.length?[3,4]:(on.info("onUnSubscribe: subscribeData is empty, no need to send request!"),[3,6]));case 4:return[4,this.processSubRequest(u,this.handleQueryUnsubRes)];case 5:c=f.sent(),o=0!==c?c:o,f.label=6;case 6:return s=i.next(),[3,3];case 7:return[3,10];case 8:return l=f.sent(),d={error:l},[3,10];case 9:try{s&&!s.done&&(p=i.return)&&p.call(i)}finally{if(d)throw d.error}return[7];case 10:return[2,Promise.resolve(o)]}}))}))},e.prototype.createUnSubscribeRequest=function(e){var t=new kt;t.naturalStoreName=e[0];var n=[];return e[1].forEach((function(t){var r=new Mt;r.subscribeId=t[0].toString(),r.cloudSubRecordId=t[1],r.cloudSubKey=t[2],r.tableName=t[3],r.naturalStoreName=e[0],n.push(r)})),t.unSubscribeDatas=n,t},e.prototype.checkStatus=function(e,t){return y(this,void 0,void 0,(function(){return h(this,(function(n){return this.subTunnelFail?[2,Promise.reject(1e3)]:e!==Ct.DEFAULT_SUBSCRIBE||t?[2]:(on.warn("DEFAULT_SUBSCRIBE should pass defaultSubscribeInfo"),[2,Promise.reject(1)])}))}))},e.prototype.onTransaction=function(e,t,n){return y(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,this.processCRUDRequest(this.createTransactionRequest(e,t,n))];case 1:if(0!==r.sent().transactionResult)throw 1;return[2]}}))}))},e.prototype.createTransactionRequest=function(e,t,n){var r=new Pt;r.naturalStoreName=e,r.verifyObjects=t,r.transactionDatas=n;var o=new Set;return r.verifyObjects.forEach((function(e){o.add(e.objectTypeName)})),r.transactionDatas.forEach((function(e){o.add(e.objectTypeName)})),r.schemas=this.buildSchemas(v(o)),r},e.prototype.getEncryptTaskManager=function(){return this.encryptTaskManager},e.prototype.onServerStatusQuery=function(){return y(this,void 0,void 0,(function(){var e,t=this;return h(this,(function(n){return e=new rn,[2,new Promise((function(n,r){t.syncInstance.process(new Bt(e,t.naturalBaseRef.getEntireEncryption().GetEncryptVersion(),t.naturalBaseRef.getCertificateService(),(function(e,t){0===e?n(t.response):r(e)})))}))]}))}))},e}(),an={},un={};function cn(e,t){an[e]=t}function ln(e,t){if(!D.isNullOrUndefined(e))return"number"==typeof e?Number(e.toPrecision(t)).valueOf():void 0}function dn(e,t){un[e]=t}cn(q.Date,(function(e){if(e instanceof Date)return t.fromNumber(e.getTime())})),cn(q.Float,(function(e){return ln(e,6)})),cn(q.Double,(function(e){return ln(e,15)})),dn(q.Date,(function(e){if(!D.isNullOrUndefined(e))return e instanceof t?new Date(e.toNumber()):void 0})),dn(q.ByteArray,(function(e){if(e instanceof Uint8Array)return e;if("string"==typeof e){var t=new ArrayBuffer(e.length),n=new Uint8Array(t),o=r.decode(e,n,0);return n.slice(0,o)}})),dn(q.Float,(function(e){return ln(e,6)})),dn(q.Double,(function(e){return ln(e,15)}));var pn={};function fn(e,t){pn[e]=t}function yn(e){if(D.isNullOrUndefined(e))return 0;for(var t=0,n=e,r=0;r<n.length;r+=1)t+=hn(n,r);return t}function hn(e,t){var n=e.charCodeAt(t);return n>>11>0?3:n>>7>0?2:1}fn(q.Integer,(function(e){return 4})),fn(q.String,(function(e){return yn(e)})),fn(q.Short,(function(e){return 2})),fn(q.Long,(function(e){return 8})),fn(q.Boolean,(function(e){return 1})),fn(q.Byte,(function(e){return 1})),fn(q.Float,(function(e){return 4})),fn(q.Double,(function(e){return 8})),fn(q.ByteArray,(function(e){return e?e.byteLength:0})),fn(q.Date,(function(e){return 8})),fn(q.Text,(function(e){return yn(e)}));var bn,gn=new u("DataModelProcessor"),vn=function(){function e(e){this.fieldsInfos=e.getFieldInfos(),this.primaryKeys=e.getPrimaryKeyFieldTypes(),this.name_=e.name}return Object.defineProperty(e.prototype,"name",{get:function(){return this.name_},enumerable:!1,configurable:!0}),e.prototype.getFieldsInfos=function(){return this.fieldsInfos},e.prototype.getFieldInfo=function(e){return this.fieldsInfos.get(e)},e.prototype.getPrimaryKeys=function(){return this.primaryKeys},e.prototype.deserialize=function(e,t){var n,r,o=new e;try{for(var i=b(this.fieldsInfos.keys()),s=i.next();!s.done;s=i.next()){var a=s.value,u=this.fieldsInfos.get(a);if(u){var c=u.fieldType;null===t[a]?o[a]=void 0:(null==u?void 0:u.isEncryptField)?o[a]=t[a]:o[a]=un[c]?un[c](t[a]):t[a]}else gn.warn("DataModelHelper: deserialize invalid fieldInfo.")}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o},e.prototype.serialize=function(e){var t,n,r={};try{for(var o=b(this.fieldsInfos.keys()),i=o.next();!i.done;i=o.next()){var s=i.value,a=this.fieldsInfos.get(s);if(a){var u=a.fieldType;if(null===e[s])r[s]=void 0;else if(null==a?void 0:a.isEncryptField){if(r[s]=e[s],(null==a?void 0:a.opeName)&&e[null==a?void 0:a.opeName]){var c=null==a?void 0:a.opeName;r[c]=an[q.String]?an[q.String](e[c]):e[c]}}else r[s]=an[u]?an[u](e[s]):e[s]}else gn.warn("DataModelHelper: serialize invalid fieldInfo key.")}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},e.prototype.serializeDeletedObject=function(e){var t,n,r={};try{for(var o=b(this.fieldsInfos.keys()),i=o.next();!i.done;i=o.next()){var s=i.value,a=this.fieldsInfos.get(s);a?a.isPrimaryKey&&(r[s]=an[a.fieldType]?an[a.fieldType](e[s]):e[s]):gn.warn("DataModelHelper: serializeDeletedObject invalid fieldInfo key.")}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},e.prototype.calculate=function(e){var t,n,r=0;try{for(var o=b(this.fieldsInfos.keys()),i=o.next();!i.done;i=o.next()){var s=i.value,a=this.fieldsInfos.get(s).fieldType;if(!D.isNullOrUndefined(e[s]))r+=pn[a]?pn[a](e[s]):0}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},e.prototype.validate=function(e){var t,n,r=Object.getOwnPropertyNames(e);if(r.length!==this.fieldsInfos.size)return gn.warn("The number of fields in the object is inconsistent with that in the schema."),!1;try{for(var o=b(r),i=o.next();!i.done;i=o.next()){var s=i.value;if(!this.validateFieldValue(this.fieldsInfos.get(s),e[s]))return!1}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!0},e.prototype.validateFieldValue=function(e,t){return e?(D.isNullOrUndefined(t)||he.validateFieldValue(e.fieldType,t),!0):(gn.warn("The field info not found in DataModelHelper."),!1)},e}(),Sn=function(){function e(e){this.processors=new Map,this.loadAppSchema(e)}return e.prototype.loadAppSchema=function(e){var t,n;try{for(var r=b(e.values()),o=r.next();!o.done;o=r.next()){var i=o.value,s=new vn(i);this.processors.set(s.name,s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.deserialize=function(e,t){var n=D.getClassName(e);if(!D.isClass(e)||!this.containProcessor(n))throw C.build("clz is not valid data model class!");if(!D.isNotNullObject(t))throw C.build("object is not valid data model object!");return this.processors.get(n).deserialize(e,t)},e.prototype.serialize=function(e,t){var n=D.getClassName(e);if(!D.isClass(e)||!this.containProcessor(n))throw C.build("clz is not valid data model class!");if(!D.isNotNullObject(t))throw C.build("object is not valid data model object!");return this.processors.get(n).serialize(t)},e.prototype.serializeDeletedObject=function(e,t){var n=D.getClassName(e);if(!D.isClass(e)||!this.containProcessor(n))throw C.build("serializeDeletedObject: clz is not valid data model class!");if(!D.isNotNullObject(t))throw C.build("serializeDeletedObject: object is not valid data model object!");return this.processors.get(n).serializeDeletedObject(t)},e.prototype.calculate=function(e,t){var n=D.getClassName(e);if(!D.isClass(e)||!this.containProcessor(n))throw C.build("clz is not valid data model class!");if(!D.isNotNullObject(t))throw C.build("object is not valid data model object!");return this.processors.get(n).calculate(t)+16},e.prototype.calculateObject=function(e){if(!D.isNotNullObject(e))throw C.build("The object is invalid data model.");var t=D.getClassName(e);if(!this.containProcessor(t))throw C.build("The object type is not loaded yet.");return this.processors.get(t).calculate(e)+16},e.prototype.getFieldInfosByClassName=function(e){var t=this.processors.get(e);return t?t.getFieldsInfos():new Map},e.prototype.getFieldInfoByName=function(e,t){var n=this.processors.get(e);if(n)return n.getFieldInfo(t)},e.prototype.getPrimaryKeyByClassName=function(e){var t=this.processors.get(e);return t?t.getPrimaryKeys():[]},e.prototype.validate=function(e){if(D.isNotNullObject(e)){var t=D.getClassName(e),n=this.processors.get(t);return!!n&&n.validate(e)}return!1},e.prototype.containProcessor=function(e){return this.processors.has(e)},e}(),mn=function(){function e(){this.version=-1,this.schemas=new Map}return e.prototype.createObjectType=function(e,t){this.version=e,this.schemas=t,this.dataModelHelper=new Sn(t)},e.prototype.getAppSchema=function(){return this.schemas},e.prototype.getAppVersion=function(){return this.version},e.prototype.getSchemaToNegotiate=function(){return v(this.schemas.values())},e.prototype.freshPermissionInfo=function(e){var t,n,r=function(t){var n=e.get(t),r=o.schemas.get(t);null==n||n.forEach((function(e){var t=g(e,2),n=t[0],o=t[1];null==r||r.setPermission(n,o)}))},o=this;try{for(var i=b(e.keys()),s=i.next();!s.done;s=i.next()){r(s.value)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.getDataModelHelper=function(){return this.dataModelHelper},e}(),Tn=new u("CertificateService"),In=function(){function e(t){if(this.websocketUrl="",this.websocketBackUrl="",this.httpUrl="",this.httpBackUrl="",this.addressMap=We.getConfigInstance().getAddressMap(),D.isNullOrUndefined(t))this.agcRoutePolicy=We.getConfigInstance().getAgcRoutePolicyMap().get(e.agcConfig.region),this.loadAgcGwAddress(e.agcConfig.agcgw);else{if(this.agcRoutePolicy=t,!this.isValidAgcGwAllAddress(e.agcConfig.agcgw_all,t))throw Tn.warn("The agconnect service config agcgw_all is invalid."),C.build("The agconnect service config agcgw_all is invalid.");if(!this.isValidAgcGwAllAddress(e.agcConfig.websocketgw_all,t))throw Tn.warn("The agconnect service config websocketgw_all is invalid."),C.build("The agconnect service config websocketgw_all is invalid.");this.loadAgcGwAllAddress(e.agcConfig.agcgw_all,e.agcConfig.websocketgw_all,this.agcRoutePolicy)}this.setContext(e.agcConfig)}return e.loadAgcConfig=function(e){if(!this.isValidContext(e))throw Tn.warn("The agconnect service config is invalid."),C.build("The agconnect service config is invalid.");this.agcConfig=e,this.agcInstance=We.getConfigInstance().getConfigInstance(this.agcConfig),this.credentialsProvider=We.getConfigInstance().getCredentialsProvider()},e.getUserInfo=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,We.getConfigInstance().getCurrentUser()];case 1:return[2,e.sent()]}}))}))},e.isValidContext=function(e){return!!e&&(!!(e.agcgw&&e.client&&e.region)&&(!!We.getConfigInstance().getAgcRoutePolicyMap().has(e.region)&&!!(e.agcgw.url&&e.agcgw.backurl&&e.agcgw.websocketurl&&e.agcgw.websocketbackurl&&e.client.product_id&&e.client.app_id&&e.client.client_id&&e.client.cp_id)))},e.checkSupportEncryption=function(){if("Browser"!==rt.getApplicationType()&&"FastApp"!==rt.getApplicationType())throw C.build(rt.getApplicationType()+" platform is not support encryption feature")},e.getAuthorization=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:if(!this.credentialsProvider)throw Tn.error("The credentialsProvider is null."),C.build(1012);return[4,this.credentialsProvider.getToken()];case 1:return[2,"Bearer "+e.sent().tokenString]}}))}))},e.prototype.getHeaderParam=function(t){return y(this,void 0,void 0,(function(){var n,r,o,i;return h(this,(function(s){switch(s.label){case 0:return[4,We.getConfigInstance().getCurrentUser()];case 1:return n=s.sent(),[4,e.getAuthorization()];case 2:return r=s.sent(),o=this.createHeader(r,t),n?[4,n.getToken(!1)]:[3,4];case 3:i=s.sent(),o.access_token=this.escapeHeader(i.getToken()),s.label=4;case 4:return[2,o]}}))}))},e.prototype.isValidAgcGwAllAddress=function(e,t){return!!e&&!(!e[this.addressMap.get(t)[0]]||!e[this.addressMap.get(t)[1]])},e.prototype.createHeader=function(t,n){return{"Content-Type":n?"application/octet-stream":"application/json; charset=UTF-8",authorization:this.escapeHeader(t),client_id:this.escapeHeader(this.context.clientId),productId:this.escapeHeader(this.context.productId),sdkPlatform:rt.getApplicationType(),sdkVersion:rt.getApplicationVersion(),appVersion:e.APP_VERSION}},e.prototype.escapeHeader=function(e){return null==e?void 0:e.replace(/^\w /g,"")},e.prototype.loadAgcGwAddress=function(e){this.websocketUrl="wss://"+e.websocketurl+"/agc/websocket/connection",this.websocketBackUrl="wss://"+e.websocketbackurl+"/agc/websocket/connection",this.httpUrl="https://"+e.url+"/agc/apigw/clouddb/clouddbservice/sync",this.httpBackUrl="https://"+e.backurl+"/agc/apigw/clouddb/clouddbservice/sync"},e.prototype.loadAgcGwAllAddress=function(e,t,n){this.websocketUrl="wss://"+t[this.addressMap.get(n)[0]]+"/agc/websocket/connection",this.websocketBackUrl="wss://"+t[this.addressMap.get(n)[1]]+"/agc/websocket/connection",this.httpUrl="https://"+e[this.addressMap.get(n)[0]]+"/agc/apigw/clouddb/clouddbservice/sync",this.httpBackUrl="https://"+e[this.addressMap.get(n)[1]]+"/agc/apigw/clouddb/clouddbservice/sync"},e.prototype.setAppVersion=function(e){this.context.appVersion=e},e.prototype.getSubscribeOptions=function(){return{url:this.websocketUrl}},e.prototype.getSubscribeBackOptions=function(){return{url:this.websocketBackUrl}},e.prototype.getContext=function(){return this.context},e.prototype.getUrl=function(){return this.httpUrl},e.prototype.getBackUrl=function(){return this.httpBackUrl},e.prototype.getAGCRoutePolicy=function(){return this.agcRoutePolicy},e.prototype.setContext=function(e){this.context={productId:e.client.product_id,appId:e.client.app_id,clientId:e.client.client_id,userId:e.client.cp_id,appVersion:0,clientVersion:2}},e.APP_VERSION="003",e}(),wn=function(e,t){this.onUserCommandChanged=e,this.onKeyChanged=t},Rn=function(){function e(){this.inEdge=t.UZERO,this.inSize=t.UZERO,this.outEdge=t.UZERO,this.outSize=t.UZERO,this.value=t.UZERO,this.outLen=0}return e.copy=function(t){var n=new e;return n.inEdge=t.inEdge,n.inSize=t.inSize,n.outEdge=t.outEdge,n.outSize=t.outSize,n.value=t.value,n.outLen=t.outLen,n},e.prototype.toString=function(){return"inEdge: "+this.inEdge.toString(10)+", inSize: "+this.inSize.toString(10)+", outEdge: "+this.outEdge.toString(10)+", outSize: "+this.outSize.toString(10)+", value: "+this.value.toString(10)+", outLen: "+this.outLen},e}(),On=function(){function e(){this.inEdge=new o(0),this.inSize=new o(0),this.outSize=new o(0),this.outEdge=new o(0),this.value=new o(0),this.outLen=0}return e.copy=function(t){var n=new e;return n.value=t.value,n.inSize=t.inSize,n.inEdge=t.inEdge,n.outEdge=t.outEdge,n.outSize=t.outSize,n.outLen=t.outLen,n},e.prototype.toString=function(){return"inEdge: "+this.inEdge.toString(10)+", inSize: "+this.inSize.toString(10)+", outEdge: "+this.outEdge.toString(10)+", outSize: "+this.outSize.toString(10)+", value: "+this.value.toString(10)+", outLen: "+this.outLen},e}(),En=function(){function e(){this.radixSign=0,this.radixLen=0,this.expSign=0,this.expLen=0,this.normalizedExp=0,this.normalizedSize=1,this.effectiveLen=0}return e.prototype.toString=function(){return"radixSign: "+this.radixSign+", radixLen: "+this.radixLen+", expSign: "+this.expSign+", expLen: "+this.expLen+", normalizedExp: "+this.normalizedExp+", normalizedSize: "+this.normalizedSize+", effectiveLen: "+this.effectiveLen},e}(),Cn=new u("OpeTypeConversion"),Nn=function(){function e(){}return e.convertToOpeDataSpaceUint64=function(e,t,n){if(null==e||null==n)return Cn.warn("convertToOpeDataSpaceUint64: input parameter is invalid"),this.OPE_FAIL;switch(t){case 1:case 2:return this.convertInt8ToOpeDataSpace(e,n);case 3:return this.convertInt16ToOpeDataSpace(e,n);case 4:return this.convertInt32ToOpeDataSpace(e,n);case 6:return this.convertFloatToOpeDataSpace(e,n);default:return Cn.warn("convertToOpeDataSpaceUint64: input type is error to Uint64Space, type: "+t),this.OPE_FAIL}},e.convertToOpeDataSpaceBigNum=function(e,t,n,r){if(null==e||null==t||t<=0)return Cn.warn("convertToOpeDataSpaceBigNum: input parameter is invalid."),this.OPE_FAIL;switch(n){case 5:case 9:return"string"==typeof e?this.convertInt64ToOpeDataSpace(e,r):(Cn.warn("convertToOpeDataSpaceBigNum: input type should be string but got: ."+typeof e),this.OPE_FAIL);case 7:return"string"==typeof e?this.convertDoubleToOpeDataSpace(e,r):(Cn.warn("convertToOpeDataSpaceBigNum: input type should be string but got: ."+typeof e),this.OPE_FAIL);case 8:return"string"!=typeof e?this.convertStringToOpeDataSpace(e,t,r):(Cn.warn("convertToOpeDataSpaceBigNum: input type should be Uint8Array but got: ."+typeof e),this.OPE_FAIL);default:return Cn.warn("convertToOpeDataSpaceBigNum: input type is error to BigNumSpace, type: "+n),this.OPE_FAIL}},e.convertInt8ToOpeDataSpace=function(e,n){var r=t.fromString(e,!0,this.NUMBER_RADIX_DECIMAL);r=r.multiply(this.PLAIN_TEXT_REDUNDANCY);var o=this.INT8_DEFAULT_DIGIT+this.PLAIN_TEXT_REDUNDANCY_LOG2,i=this.INT8_NEGATIVE_EDGE-this.PLAIN_TEXT_REDUNDANCY_LOG2;return this.convertToUint64Space(r,o,i,n)},e.convertInt16ToOpeDataSpace=function(e,n){var r=t.fromString(e,!0,this.NUMBER_RADIX_DECIMAL);r=r.multiply(this.PLAIN_TEXT_REDUNDANCY);var o=this.INT16_DEFAULT_DIGIT+this.PLAIN_TEXT_REDUNDANCY_LOG2,i=this.INT16_NEGATIVE_EDGE-this.PLAIN_TEXT_REDUNDANCY_LOG2;return this.convertToUint64Space(r,o,i,n)},e.convertInt32ToOpeDataSpace=function(e,n){var r=t.fromString(e,!0,this.NUMBER_RADIX_DECIMAL);r=r.multiply(this.PLAIN_TEXT_REDUNDANCY);var o=this.INT32_DEFAULT_DIGIT+this.PLAIN_TEXT_REDUNDANCY_LOG2,i=this.INT32_NEGATIVE_EDGE-this.PLAIN_TEXT_REDUNDANCY_LOG2;return this.convertToUint64Space(r,o,i,n)},e.convertInt64ToOpeDataSpace=function(e,t){var n=new o(e);n=n.times(this.PLAIN_TEXT_REDUNDANCY);var r=this.INT64_DEFAULT_DIGIT+this.PLAIN_TEXT_REDUNDANCY_LOG2,i=this.INT64_NEGATIVE_EDGE-this.PLAIN_TEXT_REDUNDANCY_LOG2;return this.convertToBigNumSpace(n,r,i,t)},e.convertFloatToOpeDataSpace=function(e,t){var n=parseFloat(e).toExponential(this.FLOAT_VALID_DIGITS),r=this.convertFloatToUint64(n,n.length+1,this.FLOAT_EXPONENT_MAX_RANGE,this.FLOAT_DEFAULT_PRECISION);r=r.multiply(this.PLAIN_TEXT_REDUNDANCY);var o=(this.FLOAT_DEFAULT_PRECISION+this.FLOAT_EXPONENT_MAX_LEN)*this.NUMBER_RADIX_DECIMAL_LOG2+this.PLAIN_TEXT_REDUNDANCY_LOG2-1;o=Math.floor(o);return this.convertToUint64Space(r,o,0,t)},e.convertDoubleToOpeDataSpace=function(e,t){var n=parseFloat(e).toExponential(this.DOUBLE_VALID_DIGITS),r=this.convertDoubleToBigNum(n,n.length+1,this.DOUBLE_EXPONENT_MAX_RANGE,this.DOUBLE_DEFAULT_PRECISION);r=r.times(this.PLAIN_TEXT_REDUNDANCY);var o=(this.DOUBLE_DEFAULT_PRECISION+this.DOUBLE_EXPONENT_MAX_LEN)*this.NUMBER_RADIX_DECIMAL_LOG2+this.PLAIN_TEXT_REDUNDANCY_LOG2-1;o=Math.floor(o);return this.convertToBigNumSpace(r,o,0,t)},e.convertStringToOpeDataSpace=function(e,t,n){var r=this.convertCharToBigNum(e,t,this.STRING_VALID_BYTE_LEN);r=r.times(this.PLAIN_TEXT_REDUNDANCY);var o=this.STRING_VALID_BYTE_LEN*Math.log2(this.CHAR_SPACE_SIZE)+this.PLAIN_TEXT_REDUNDANCY_LOG2+1;return this.convertToBigNumSpace(r,o,0,n)},e.convertFloatToUint64=function(e,n,r,o){if(null==e||n<=0)throw Cn.warn("convertFloatToUint64: text is null"),Error("convertFloatToUint64: text is null");var i=new En;this.calculateFloatingPointParameter(e,n,i),this.calculateNormalizedExp(e,r,i);var s=i.expLen+o,a=this.translateFloatingPointToChar(e,o,i,s);return t.fromString(a)},e.convertDoubleToBigNum=function(e,t,n,r){if(null==e||t<=0)throw Cn.warn("convertDoubleToBigNum: text is null"),Error("convertDoubleToBigNum: text is null");var i=new En;this.calculateFloatingPointParameter(e,t,i),this.calculateNormalizedExp(e,n,i);var s=i.expLen+r,a=this.translateFloatingPointToChar(e,r,i,s);return new o(a)},e.convertCharToBigNum=function(e,t,n){var r,i=new o(0),s=new o(1);t>=n&&(i=new o(e[n-1]));for(var a=n-1;a>0;a--)s=s.times(this.CHAR_SPACE_SIZE),t>=a&&(r=(r=s).times(void 0===e[a-1]?0:e[a-1]),i=i.plus(r));return i},e.calculateFloatingPointParameter=function(e,t,n){var r=0;for("-"===e.charAt(r)&&(n.radixSign=1);"e"!==e.charAt(r);)r++;for(n.radixLen=r,"-"===e.charAt(r+1)&&(n.expSign=1),r+=2;"0"===e.charAt(r);)r++;for(;r<t&&e.charCodeAt(r)>="0".charCodeAt(0)&&e.charCodeAt(r)<="9".charCodeAt(0);)r++,n.expLen++;n.effectiveLen=r,n.expLen=0===n.expLen?1:n.expLen},e.calculateNormalizedExp=function(e,t,n){var r,o=n.normalizedSize;if("0"===e.charAt(0))r=2*t+1,o*=this.NUMBER_RADIX_DECIMAL;else if(1===n.radixSign){r=t;for(var i=0;i<n.expLen;i++)1===n.expSign?r+=(e.charCodeAt(n.effectiveLen-1-i)-"0".charCodeAt(0))*o:r-=(e.charCodeAt(n.effectiveLen-1-i)-"0".charCodeAt(0))*o,o*=this.NUMBER_RADIX_DECIMAL}else{r=3*t+1;for(i=0;i<n.expLen;i++)1===n.expSign?r-=(e.charCodeAt(n.effectiveLen-1-i)-"0".charCodeAt(0))*o:r+=(e.charCodeAt(n.effectiveLen-1-i)-"0".charCodeAt(0))*o,o*=this.NUMBER_RADIX_DECIMAL}if(0===parseInt((r/o).toString(10),10))for(o=Math.floor(o/this.NUMBER_RADIX_DECIMAL);0===parseInt((r/o).toString(10),10);){if(1===o){n.expLen--;break}o=Math.floor(o/this.NUMBER_RADIX_DECIMAL),n.expLen--}else{for(;0!==parseInt((r/o).toString(10),10);)o*=this.NUMBER_RADIX_DECIMAL,n.expLen++;o=Math.floor(o/this.NUMBER_RADIX_DECIMAL)}n.normalizedSize=o,n.normalizedExp=r},e.translateFloatingPointToChar=function(e,t,n,r){if(r<n.expLen+t)throw Cn.warn("translateFloatingPointToChar: formatText length is not enough."),Error("translateFloatingPointToChar: formatText length is not enough.");for(var o=[],i=0;i<n.expLen;i++)o[i]="0".charCodeAt(0)+Math.floor(n.normalizedExp/n.normalizedSize),n.normalizedExp%=n.normalizedSize,n.normalizedSize=Math.floor(n.normalizedSize/this.NUMBER_RADIX_DECIMAL);var s=0,a=0;if(1===n.radixSign)for(s++;a<t;)s>=n.radixLen?(o[a+n.expLen]="0".charCodeAt(0),a++):("."!==e.charAt(s)&&(o[a+n.expLen]="0".charCodeAt(0)+9-e.charCodeAt(s)+"0".charCodeAt(0),a++),s++);else for(;a<t;)s>=n.radixLen?(o[a+n.expLen]="0".charCodeAt(0),a++):("."!==e.charAt(s)&&(o[a+n.expLen]=e.charCodeAt(s),a++),s++);return String.fromCharCode.apply(String,v(o))},e.convertToUint64Space=function(e,n,r,o){var i=Math.floor(n*this.CIPHER_SPACE_RATE/this.CIPHER_SPACE_RATE_BASE);return i-n<this.CIPHER_SPACE_LIMIT_LOG2&&(i=n+this.CIPHER_SPACE_LIMIT_LOG2),o.inSize=t.fromNumber(Math.pow(2,n),!0),o.inEdge=r<0?t.MAX_UNSIGNED_VALUE.divide(2).add(1).subtract(t.fromNumber(Math.pow(2,-r),!0)):0===r?t.UZERO:t.fromNumber(Math.pow(2,r),!0),o.outEdge=t.UONE,i>=this.INT64_DEFAULT_DIGIT?(o.outSize=t.MAX_UNSIGNED_VALUE,o.outLen=16):(o.outSize=t.fromNumber(Math.pow(2,i)),o.outLen=Math.floor((i-1)/4)+1,o.outLen%2!=0&&o.outLen++),r<0?e.greaterThan(t.MAX_UNSIGNED_VALUE.divide(2))?o.value=e.subtract(t.MAX_UNSIGNED_VALUE.divide(2)).subtract(1).toUnsigned():o.value=e.add(t.MAX_UNSIGNED_VALUE.divide(2)).add(1).toUnsigned():o.value=e,this.OPE_SUCCESS},e.convertToBigNumSpace=function(e,t,n,r,i){return null==i?this.convertToBigNumSpaceWithoutOutSize(e,t,n,r):(r.outEdge=new o(1),r.value=e,n<=0?(r.inEdge=new o(0),r.value=this.setBitLenToOneInBigNum(r.value,-n)):r.inEdge=new o(2).pow(n),r.inSize=new o(2).pow(t),r.outSize=new o(2).pow(i),r.outLen=Math.floor((i-1)/4)+1,r.outLen%2!=0&&r.outLen++,this.OPE_SUCCESS)},e.convertToBigNumSpaceWithoutOutSize=function(e,t,n,r){if(null==e)throw Cn.warn("convertToBigNumSpace: plaintext is null."),Error("convertToBigNumSpace: plaintext is null.");r.inEdge=new o(0),r.inSize=new o(0),r.outEdge=new o(0),r.outSize=new o(0);var i=Math.floor(t*this.CIPHER_SPACE_RATE/this.CIPHER_SPACE_RATE_BASE);return i-t<this.CIPHER_SPACE_LIMIT_LOG2&&(i=t+this.CIPHER_SPACE_LIMIT_LOG2),this.convertToBigNumSpace(e,t,n,r,i)},e.setBitLenToOneInBigNum=function(e,t){if(t<=0)return e;var n=new o(2).pow(t);return e.plus(n)},e.NUMBER_RADIX_DECIMAL=10,e.NUMBER_RADIX_DECIMAL_LOG2=Math.log2(e.NUMBER_RADIX_DECIMAL),e.INT8_DEFAULT_DIGIT=8,e.INT16_DEFAULT_DIGIT=16,e.INT32_DEFAULT_DIGIT=32,e.INT64_DEFAULT_DIGIT=64,e.INT8_NEGATIVE_EDGE=-7,e.INT16_NEGATIVE_EDGE=-15,e.INT32_NEGATIVE_EDGE=-31,e.INT64_NEGATIVE_EDGE=-63,e.FLOAT_DEFAULT_PRECISION=8,e.FLOAT_EXPONENT_MAX_RANGE=38,e.FLOAT_EXPONENT_MAX_LEN=3,e.DOUBLE_DEFAULT_PRECISION=17,e.DOUBLE_EXPONENT_MAX_RANGE=308,e.DOUBLE_EXPONENT_MAX_LEN=4,e.PLAIN_TEXT_REDUNDANCY=8,e.PLAIN_TEXT_REDUNDANCY_LOG2=Math.log2(e.PLAIN_TEXT_REDUNDANCY),e.CIPHER_SPACE_RATE=13e3,e.CIPHER_SPACE_RATE_BASE=1e4,e.CIPHER_SPACE_LIMIT=1024,e.CIPHER_SPACE_LIMIT_LOG2=Math.log2(e.CIPHER_SPACE_LIMIT),e.STRING_VALID_BYTE_LEN=16,e.CHAR_SPACE_SIZE=256,e.FLOAT_VALID_DIGITS=7,e.DOUBLE_VALID_DIGITS=16,e.OPE_FAIL=-1,e.OPE_SUCCESS=1,e}(),Dn=new u("OpeGenerator"),An=l.getCryptoJS(),Pn=function(){function e(){}return e.prototype.generateOpeValue=function(e,t,n,r){if(null==e||null==t||t<=0||null==r||null==n)throw Dn.warn("generateOpeValue: input parameter is invalid."),Error("generateOpeValue: input parameter is invalid.");var o;switch(this.inputVerification(e,n),n){case 1:case 2:case 3:case 4:case 6:o=this.generateOpeValueByUint64(e,n,r);break;case 5:case 9:case 7:o=this.generateOpeValueByBigNum(e,t,n,r);break;case 8:o=this.generateOpeValueForString(e,t,n,r);break;default:throw Dn.warn("generateOpeValue: type: "+n+" is error."),Error("generateOpeValue: type: "+n+" is error.")}if(o.length<=0)throw Dn.warn("generateOpeValue: generate ope value failed"),Error("generateOpeValue: generate ope value failed");return o},e.prototype.generateOpeValueByUint64=function(e,t,n){var r=new Rn;if(Nn.convertToOpeDataSpaceUint64(e,t,r)!==Nn.OPE_SUCCESS)throw Dn.warn("generateOpeValueByUint64: convert to uint64 space failed"),Error("generateOpeValueByUint64: convert to uint64 space failed");return this.getOpeValueByUint64(n,r)},e.prototype.generateOpeValueByBigNum=function(e,t,n,r){var o=new On;if(Nn.convertToOpeDataSpaceBigNum(e,t,n,o)!==Nn.OPE_SUCCESS)throw Dn.warn("generateOpeValueByUint64: convert to bigNum space failed"),Error("generateOpeValueByUint64: convert to bigNum space failed");var i=this.getOpeValueByBigNum(r,o);if(i.length<=0)throw Dn.warn("generateOpeValueByBigNum: generate ope value by bigNum failed"),Error("generateOpeValueByBigNum: generate ope value by bigNum failed");return i},e.prototype.generateOpeValueForString=function(t,n,r,o){var i=D.stringToUint8Array(t),s=0===i.length?1:i.length,a=s,u=(s-1)/e.STRING_TRUNCATED_BYTE_LEN+1;u=Math.floor(u);for(var c,l=0,d="",p=0;p<u;p++){a>e.STRING_TRUNCATED_BYTE_LEN?(a-=e.STRING_TRUNCATED_BYTE_LEN,c=e.STRING_TRUNCATED_BYTE_LEN):c=a;var f=i.subarray(p*e.STRING_TRUNCATED_BYTE_LEN,(p+1)*e.STRING_TRUNCATED_BYTE_LEN),y=this.generateOpeValueByBigNum(f,c,r,o);if(y.length<=0||l+y.length>e.MAX_ENTIRE_OPE_LEN)throw Dn.warn("generateOpeValueForString: generate ope value by bigNum failed, opeValueLen: "+y.length+" truncateCnt: "+u),Error("generateOpeValueForString: generate ope value by bigNum failed, opeValueLen: "+y.length+" truncateCnt: "+u);d+=y,l+=y.length}return d},e.prototype.getOpeValueByUint64=function(t,n){var r=this.calculateOpeValueByUint64(n,t);if(r.equals(e.OPE_UINT64_ERROR))throw Dn.warn("getOpeValueByUint64: calculate ope value by uint64 fail."),Error("getOpeValueByUint64: calculate ope value by uint64 fail.");return(Array(n.outLen).join("0")+r.toString(16).toUpperCase()).slice(-n.outLen)},e.prototype.getOpeValueByBigNum=function(e,t){var n=this.calculateOpeValueByBigNum(t,e).toString(16);return(Array(t.outLen).join("0")+n.toUpperCase()).slice(-t.outLen)},e.prototype.calculateOpeValueByUint64=function(e,n){for(var r=t.fromNumber(0);e.inSize.greaterThanOrEqual(1);){if(e.value.lessThan(e.inEdge)||e.value.greaterThanOrEqual(e.inEdge.add(e.inSize)))throw Dn.warn("calculateOpeValueByUint64: value out of range by uint64."),Error("calculateOpeValueByUint64: value out of range by uint64.");if(e.inSize.equals(e.outSize))return e.outEdge.add(e.value).subtract(e.inEdge);if(e.inSize.equals(1))return this.uniformSampleInUint64(e.value,e,n);var o=e.inEdge.add(e.inSize.subtract(1).divide(2)),i=this.uniformSampleInUint64(o,Rn.copy(e),n);e.value.lessThanOrEqual(o)?(e.inSize=o.subtract(e.inEdge).add(1),e.outSize=i.subtract(e.outEdge).add(1)):(e.inSize=e.inEdge.add(e.inSize).subtract(1).subtract(o),e.outSize=e.outEdge.add(e.outSize).subtract(1).subtract(i),e.inEdge=o.add(1),e.outEdge=i.add(1))}return r},e.prototype.uniformSampleInUint64=function(t,n,r){if(!n.inSize.equals(1)){var o=n.inSize.multiply(e.CIPHER_TEXT_SAMPLE_REDUNDANCY).divide(e.NUMBER_RADIX_DECIMAL);o.greaterThan(n.outSize)?(n.outEdge=n.outEdge.add(t).subtract(n.inEdge),n.outSize=n.outSize.subtract(n.inSize).subtract(1)):(n.outSize=n.outSize.add(1).subtract(o),n.outEdge=n.outEdge.add(t.subtract(n.inEdge).multiply(e.CIPHER_TEXT_SAMPLE_REDUNDANCY).divide(e.NUMBER_RADIX_DECIMAL)))}if(n.outSize.equals(1))return n.outEdge;for(var i,s=this.calculateCoinByUint64(t,n,r),a=0;n.outSize.greaterThan(1);)i=n.outEdge.add(n.outSize.subtract(1).divide(2)),"0"===s.charAt(a)?n.outSize=i.subtract(n.outEdge).add(1):(n.outSize=n.outEdge.add(n.outSize.subtract(1)).subtract(i),n.outEdge=i.add(1)),a++;return n.outEdge},e.prototype.calculateCoinByUint64=function(t,n,r){for(var o=An.enc.Utf8.parse(t.toString(10)).concat(r),i=An.SHA256(o).toString(An.enc.Hex),s=Math.floor((Math.floor(Math.log2(n.outSize.toNumber()))+1)/e.INT8_DEFAULT_DIGIT)+1,a="",u=0;u<s;u++)a+=this.hex2binForUint64(i.substring(2*u,2*(u+1)));return a},e.prototype.calculateOpeValueByBigNum=function(e,t){for(var n=new o(0);e.inSize.gte(1);){if(e.value.lt(e.inEdge)||e.value.gte(e.inEdge.plus(e.inSize)))throw Dn.warn("calculateOpeValueByBigNum: value out of range by bigNum"),Error("calculateOpeValueByBigNum: value out of range by bigNum");if(e.inSize.eq(e.outSize))return e.outEdge.plus(e.value).minus(e.inEdge);if(e.inSize.eq(1))return this.uniformSampleInBigNum(e.value,e,t);var r=e.inEdge.plus(e.inSize.minus(1).dividedToIntegerBy(2)),i=this.uniformSampleInBigNum(r,e,t);e.value.lte(r)?(e.inSize=r.minus(e.inEdge).plus(1),e.outSize=i.minus(e.outEdge).plus(1)):(e.inSize=e.inSize.plus(e.inEdge).minus(1).minus(r),e.outSize=e.outSize.plus(e.outEdge).minus(1).minus(i),e.inEdge=r.plus(1),e.outEdge=i.plus(1))}return n},e.prototype.uniformSampleInBigNum=function(e,t,n){var r=On.copy(t);if(this.calculateSampleSpaceWithRedundancy(r,e),r.outSize.eq(1))return r.outEdge;var o=this.calculateSampleCoinInBigNum(e,n);return r.outEdge.plus(o.mod(r.outSize))},e.prototype.calculateSampleSpaceWithRedundancy=function(t,n){if(!t.inSize.eq(1)){var r=this.calculateRedundancySize(t);if(r.gt(t.outSize))t.outEdge=t.outEdge.plus(n).minus(t.inEdge),t.outSize=t.outSize.plus(1).minus(t.inSize);else{t.outSize=t.outSize.plus(1).minus(r);var o=n.minus(t.inEdge);o=o.times(e.CIPHER_TEXT_SAMPLE_REDUNDANCY).dividedToIntegerBy(10),t.outEdge=t.outEdge.plus(o)}}},e.prototype.calculateRedundancySize=function(t){var n=t.inSize;return n=(n=n.times(e.CIPHER_TEXT_SAMPLE_REDUNDANCY)).dividedToIntegerBy(e.NUMBER_RADIX_DECIMAL)},e.prototype.calculateSampleCoinInBigNum=function(e,t){var n=e.toString(16).toUpperCase();"0"!==n&&n.length%2!=0&&(n="0"+n);var r=An.enc.Utf8.parse(n).concat(t),i=An.SHA256(r);return new o("0x"+this.changeOrder(i.toString(An.enc.Hex)))},e.prototype.hex2binForUint64=function(e){return("00000000"+parseInt(e,16).toString(2)).substr(-8).split("").reverse().join("")},e.prototype.changeOrder=function(e){for(var t=e.length,n="";t>=0;)n+=e.substring(t-2,t),t-=2;return n},e.prototype.inputVerification=function(e,t){if(0===t)throw Dn.warn("generateOpeValue: ope type input is invalid, type: OPE_TYPE_NULL."),Error("generateOpeValue: ope type input is invalid, OPE_TYPE_NULL.");if(1===t&&"1"!==e&&"0"!==e)throw Dn.warn("generateOpeValue: boolean type input is invalid, input is not a boolean value."),Error("generateOpeValue: boolean type input is invalid.");if(8!==t&&1!==t){if(""===e||""===e.trim())throw Dn.warn("generateOpeValue: Number type input is invalid, input is empty."),Error("generateOpeValue: Number type input is invalid.");if(isNaN(Number(e)))throw Dn.warn("generateOpeValue: Number type input is invalid, input is NaN."),Error("generateOpeValue: Number type input is invalid.")}},e.NUMBER_RADIX_DECIMAL=10,e.INT8_DEFAULT_DIGIT=8,e.CIPHER_TEXT_SAMPLE_REDUNDANCY=11,e.MAX_ENTIRE_OPE_LEN=2400,e.OPE_UINT64_ERROR=t.UZERO,e.STRING_TRUNCATED_BYTE_LEN=16,e}(),kn=l.getCryptoJS(),Mn=new u("EntireEncryption"),_n=function(){function e(t){this.encryptInstance=e.encryptor,this.userKeysInfo=new jn,this.naturalBaseRef=t}return e.setEncryptor=function(t){e.encryptor=t},e.prototype.aesGcm256Encrypt=function(e,t,n){return y(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,this.encryptInstance.encrypt(e,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.aesGcm256Decrypt=function(e,t,n){return y(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,this.encryptInstance.decrypt(e,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.generateRandom=function(e){return this.encryptInstance.generateRandom(e)},e.prototype.setKeys=function(e,t,n,r,o,i){return y(this,void 0,void 0,(function(){return h(this,(function(s){if(D.isNullOrUndefined(t)||D.isNullOrUndefined(r)||n<=0||o<0||i<=0)return Mn.error("setKeys: input dataKey or oldDataKey is invalid."),[2,Promise.reject(51)];Mn.log("setKeys: set iv key and encrypted key."),D.isStringEmpty(this.userKeysInfo.userId)||this.clearUserKeysInfo();try{this.generateKeys(t,r,o)}catch(e){return Mn.error("setKeys: set keys failed."),this.clearUserKeysInfo(),[2,Promise.reject(e.getCode())]}return this.userKeysInfo.userId=e,this.userKeysInfo.dataKeyVersion=i,[2]}))}))},e.prototype.conditionEntireEncryptedField=function(e,t,n,r){return y(this,void 0,void 0,(function(){var o;return h(this,(function(i){switch(i.label){case 0:return this.naturalBaseRef.getEntireEncryptInterval().setIntervalCleanKey(!0),o=this.getPlainText(n,r),[4,this.getOpeFieldDataValue(e,t,n,o)];case 1:return[2,i.sent()]}}))}))},e.prototype.encryptEntireEncryptedFields=function(e){return y(this,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c,l,d;return h(this,(function(p){switch(p.label){case 0:Mn.debug("encryptEntireEncryptedFields: objectItems size: "+e.length),t=[],n=D.deepCopy(e),p.label=1;case 1:p.trys.push([1,7,8,9]),r=b(n),o=r.next(),p.label=2;case 2:return o.done?[3,6]:(i=o.value,s=D.getClassName(i),[4,this.isValidEncryptionOperation(s)]);case 3:return p.sent(),u=(a=t).push,[4,this.handleEntireEncryptedField(s,i)];case 4:u.apply(a,[p.sent()]),p.label=5;case 5:return o=r.next(),[3,2];case 6:return[3,9];case 7:return c=p.sent(),l={error:c},[3,9];case 8:try{o&&!o.done&&(d=r.return)&&d.call(r)}finally{if(l)throw l.error}return[7];case 9:return Mn.debug("encryptEntireEncryptedFields done"),[2,Promise.resolve(t)]}}))}))},e.prototype.handleEntireEncryptedField=function(e,t){return y(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c,l;return h(this,(function(d){switch(d.label){case 0:n=this.naturalBaseRef.getDefaultNaturalStore().getAppSchema().get(e),r=n.getEncryptFieldList(),o=t,d.label=1;case 1:d.trys.push([1,6,7,8]),i=b(r),s=i.next(),d.label=2;case 2:return s.done?[3,5]:(a=s.value,this.naturalBaseRef.getEntireEncryptInterval().setIntervalCleanKey(!0),[4,this.encryptEntireEncryptedField(e,a.fieldName,a.fieldType,t)]);case 3:o=d.sent(),d.label=4;case 4:return s=i.next(),[3,2];case 5:return[3,8];case 6:return u=d.sent(),c={error:u},[3,8];case 7:try{s&&!s.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}return[7];case 8:return[2,Promise.resolve(o)]}}))}))},e.prototype.encryptEntireEncryptedField=function(e,t,n,r){return y(this,void 0,void 0,(function(){var o,i,s,a,u,c;return h(this,(function(l){switch(l.label){case 0:return o=r[t],D.isNullOrUndefined(o)?[2,r]:[4,this.checkUserId()];case 1:return l.sent(),i=this.getPlainText(n,o),s=r,a=t,[4,this.encryptFieldData(e,t,i)];case 2:return s[a]=l.sent(),[4,this.getOpeFieldDataValue(e,t,n,i)];case 3:return u=l.sent(),c=-1!==t.indexOf("#ope")?t:t+"#ope",r[c]=u,[2,Promise.resolve(r)]}}))}))},e.prototype.getPlainText=function(e,t){var n="",r=L.toString(e);switch(e){case q.Boolean:n=!0===t?"1":"0";break;case q.Integer:case q.Short:case q.Float:case q.Double:case q.Byte:case q.Long:case q.IntAutoIncrement:case q.LongAutoIncrement:n=t.toString();break;case q.Date:n=t.getTime().toString();break;case q.String:n=t;break;default:throw Mn.error("getPlainText: inputValue fieldType:"+r+" is error."),C.build(1003)}if(n.length>800)throw Mn.error("Plaintext length cannot be greater than 800."),C.build(1003);return n},e.prototype.encryptFieldData=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o,i,s,a,u,c;return h(this,(function(l){switch(l.label){case 0:if(r=e+":"+t,o=this.calculateGcmIv(r,D.stringToUint8Array(n)),!((i=this.userKeysInfo.encryptedKeyMap.get(r))||(Mn.warn("encryptFieldData: this field has not encryptKey."),this.generateEncryptedKey(r,this.userKeysInfo.dataKeyPlaintext),i=this.userKeysInfo.encryptedKeyMap.get(r))))throw Mn.error("encryptFieldData: not found regenerate field encryptKey."),C.build(1);return[4,this.aesGcm256Encrypt(D.stringToUint8Array(n),i,o)];case 1:if(!(s=l.sent()))throw Mn.error("encryptFieldData: encrypt failed."),C.build(52);return a=s.slice(0,s.length-Ln),u=s.slice(s.length-Ln,s.length),c=Array.from(o).concat(Array.from(u)).concat(Array.from(a)),[2,Promise.resolve(new Uint8Array(c))]}}))}))},e.prototype.calculateGcmIv=function(e,t){var n=this.userKeysInfo.ivKeyMap.get(e);if(!n){if(!this.userKeysInfo.dataKeyPlaintext)throw Mn.error("calculateGcmIv: this field has not encryptedKey."),C.build(1);if(this.generateIvKey(e,this.userKeysInfo.dataKeyPlaintext),!(n=this.userKeysInfo.ivKeyMap.get(e)))throw Mn.error("calculateGcmIv: GenerateIvKey not found."),C.build(1)}var r=this.calculateHmacSha256(n,D.uint8ArrayToString(t));return D.wordArrayToUint8Array(r).slice(0,Kn)},e.prototype.getOpeFieldDataValue=function(e,t,n,r){return y(this,void 0,void 0,(function(){var o,i,s,a,u;return h(this,(function(c){if(o=r.length>0?r.length:1,i=e+":"+t,!((s=this.userKeysInfo.opeKeyMap.get(i))||(Mn.warn("getOpeFieldDataValue: this field has not opeKey."),this.generateOpeKey(i,this.userKeysInfo.dataKeyPlaintext),s=this.userKeysInfo.opeKeyMap.get(i))))throw Mn.error("getOpeFieldDataValue: not found regenerate field opeKey."),C.build(1);a=this.convertFieldToOpeDataType(n);try{return u=(new Pn).generateOpeValue(r,o,a,s),[2,Promise.resolve(u)]}catch(e){throw Mn.error("Encrypt data failed, please check user key validity.for"+e),C.build(52)}return[2]}))}))},e.prototype.convertFieldToOpeDataType=function(e){var t=8;switch(e){case q.Integer:t=4;break;case q.Byte:t=2;break;case q.Short:t=3;break;case q.Long:t=5;break;case q.Float:t=6;break;case q.Double:t=7;break;case q.String:case q.Text:t=8;break;case q.Date:t=9;break;case q.Boolean:t=1;break;default:Mn.error("convertFieldToOpeDataType: fieldType is Unknown")}return t},e.prototype.decryptEntireEncryptedFields=function(e,t){return y(this,void 0,void 0,(function(){var n,r,o,i,s,a,u,c,l,d;return h(this,(function(p){switch(p.label){case 0:n=[],r=this.naturalBaseRef.getDefaultNaturalStore().getAppSchema().get(e.getClassName()),o=r.getEncryptFieldList(),p.label=1;case 1:p.trys.push([1,6,7,8]),i=b(t),s=i.next(),p.label=2;case 2:return s.done?[3,5]:(a=s.value,[4,this.innerDecryptEntireEncryptedFields(e,o,a)]);case 3:u=p.sent(),n.push(u),p.label=4;case 4:return s=i.next(),[3,2];case 5:return[3,8];case 6:return c=p.sent(),l={error:c},[3,8];case 7:try{s&&!s.done&&(d=i.return)&&d.call(i)}finally{if(l)throw l.error}return[7];case 8:return[2,Promise.resolve(n)]}}))}))},e.prototype.innerDecryptEntireEncryptedFields=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d,p=this;return h(this,(function(f){switch(f.label){case 0:return n.setObjectTypeName(e.getClazz()),r=this.naturalBaseRef.getDefaultNaturalStore().getDataModelHelper().deserialize(e.getClazz(),n.getObject()),t&&0!==t.length?[4,this.checkUserId()]:(n.setUserObject(r),[2,Promise.resolve(r)]);case 1:f.sent(),o=function(t){var n,o,s,a,u,c,l;return h(this,(function(d){switch(d.label){case 0:if(n=t.fieldName,!(o=r[n]))return[2,"continue"];if(!(s=i.userKeysInfo.encryptedKeyMap.get(e.getClassName()+":"+n)))throw Mn.error("innerDecryptEntireEncryptedFields: get encryptKey failed."),C.build(1);return i.naturalBaseRef.getEntireEncryptInterval().setIntervalCleanKey(!0),"string"==typeof o&&(o=D.wordArrayToUint8Array(D.decode(o))),a=o.slice(0,Kn),u=o.slice(Kn,Kn+Ln),c=o.slice(Kn+Ln,o.length),l=Array.from(c).concat(Array.from(u)),[4,i.aesGcm256Decrypt(new Uint8Array(l),s,a).then((function(e){p.decryptFieldData(e,n,t.fieldType,r)})).catch((function(){throw Mn.error("innerDecryptEntireEncryptedFields: decrypt text failed."),C.build(53)}))];case 1:return d.sent(),[2]}}))},i=this,f.label=2;case 2:f.trys.push([2,7,8,9]),s=b(t),a=s.next(),f.label=3;case 3:return a.done?[3,6]:(u=a.value,[5,o(u)]);case 4:f.sent(),f.label=5;case 5:return a=s.next(),[3,3];case 6:return[3,9];case 7:return c=f.sent(),l={error:c},[3,9];case 8:try{a&&!a.done&&(d=s.return)&&d.call(s)}finally{if(l)throw l.error}return[7];case 9:return n.setUserObject(r),[2,Promise.resolve(r)]}}))}))},e.prototype.decryptFieldData=function(e,n,r,o){var i=D.uint8ArrayToString(e);switch(r){case q.Boolean:o[n]="1"===i;break;case q.Byte:case q.Short:case q.Integer:o[n]=parseInt(i,10);break;case q.Float:case q.Double:o[n]=parseFloat(i);break;case q.String:case q.Text:o[n]=i;break;case q.Date:o[n]=new Date(parseInt(i,10));break;case q.Long:o[n]=t.fromString(i)}return o},e.prototype.clearUserKeysInfo=function(){Mn.log("clearUserKeysInfo: clear userKeys."),this.userKeysInfo.userId="",this.userKeysInfo.dataKeyVersion=0,this.clearUserKey(this.userKeysInfo.ivKeyMap),this.clearUserKey(this.userKeysInfo.encryptedKeyMap),this.clearUserKey(this.userKeysInfo.oldEncryptedKeyMap),this.clearUserKey(this.userKeysInfo.opeKeyMap)},e.prototype.clearUserKey=function(e){e.clear()},e.prototype.generateKeys=function(e,t,n){var r,o,i,s,a=this.naturalBaseRef.getDefaultNaturalStore().getAppSchema();if(0===a.size)throw Mn.error("generateKeys: schemas have not been loaded."),C.build(1);try{for(var u=b(a),c=u.next();!c.done;c=u.next()){var l=c.value,d=l[1].getEncryptFieldList();try{for(var p=(i=void 0,b(d)),f=p.next();!f.done;f=p.next()){var y=f.value,h=l[0]+":"+y.fieldName;this.generateColumnKeys(h,e,t,n)}}catch(e){i={error:e}}finally{try{f&&!f.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}},e.prototype.generateColumnKeys=function(e,t,n,r){this.generateEncryptedKey(e,t),r>0&&this.generateOldEncryptedKey(e,n),this.generateIvKey(e,t),this.generateOpeKey(e,t)},e.prototype.generateEncryptedKey=function(e,t){if(this.userKeysInfo.encryptedKeyMap.has(e))Mn.log("generateEncryptedKey: encryptedKey of the tableFieldName already existed.");else{var n=e;n+=" generate encryption key with encryption algorithm AES_256_GCM_HMAC_SHA256";var r=this.calculateHmacSha256(t,n);this.userKeysInfo.encryptedKeyMap.set(e,D.wordArrayToUint8Array(r))}},e.prototype.generateOldEncryptedKey=function(e,t){if(this.userKeysInfo.oldEncryptedKeyMap.has(e))Mn.log("generateOldEncryptedKey: oldEncryptedKey of the tableFieldName already existed.");else{var n=e+" generate encryption key with encryption algorithm AES_256_GCM_HMAC_SHA256",r=this.calculateHmacSha256(t,n);this.userKeysInfo.oldEncryptedKeyMap.set(e,D.wordArrayToUint8Array(r))}},e.prototype.generateIvKey=function(e,t){if(this.userKeysInfo.ivKeyMap.has(e))Mn.log("generateIvKey: ivKey of the tableFieldName already existed.");else{var n=e+" generate IV key with encryption algorithm AES_256_GCM_HMAC_SHA256",r=this.calculateHmacSha256(t,n);this.userKeysInfo.ivKeyMap.set(e,D.wordArrayToUint8Array(r))}},e.prototype.generateOpeKey=function(e,t){if(this.userKeysInfo.opeKeyMap.has(e))Mn.log("generateOpeKey: opeKey of the tableFieldName already existed.");else{var n=e+" generate Order-preserving key with encryption algorithm AES_256_GCM_HMAC_SHA256",r=this.calculateHmacSha256(t,n);this.userKeysInfo.opeKeyMap.set(e,r)}},e.prototype.calculateHmacSha256=function(e,t){var n=D.uint8ArrayToWordArray(e),r=D.uint8ArrayToWordArray(D.stringToUint8Array(t)),o=kn.HmacSHA256(r,n);if(!o)throw Mn.error("calculateHmacSha256: calculate hmac failed."),C.build(1);return o},e.prototype.isValidEncryptionOperation=function(e){return y(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),(null==(t=this.naturalBaseRef.getDefaultNaturalStore().getAppSchema().get(e))?void 0:t.isEncryptTable())?(In.checkSupportEncryption(),[4,this.checkUserId()]):[2];case 1:return r.sent(),[3,3];case 2:return n=r.sent(),[2,Promise.reject(D.isErrorObject(n)?n:C.build(n))];case 3:return[2]}}))}))},e.prototype.checkUserId=function(){return y(this,void 0,void 0,(function(){var e,t;return h(this,(function(n){switch(n.label){case 0:return[4,We.getConfigInstance().getCurrentUser()];case 1:return e=n.sent(),(t=null==e?void 0:e.getUid())&&0!==t.length?0===this.userKeysInfo.dataKeyVersion?(Mn.error("checkUserId: data key version is invalid."),[2,Promise.reject(51)]):t!==this.userKeysInfo.userId?(Mn.error("checkUserId: this user is not the current user, please verify user key first."),[2,Promise.reject(15)]):[2]:(Mn.error("checkUserId: this user is not authenticated."),[2,Promise.reject(15)])}}))}))},e.prototype.GetEncryptVersion=function(){return this.userKeysInfo.dataKeyVersion},e}(),jn=function(){this.ivKeyMap=new Map,this.encryptedKeyMap=new Map,this.oldEncryptedKeyMap=new Map,this.opeKeyMap=new Map,this.userId="",this.dataKeyVersion=0,this.dataKeyPlaintext=new Uint8Array,this.oldDataKeyPlaintext=new Uint8Array,this.dataKeyPlaintextLen=0,this.oldDataKeyPlaintextLen=0},xn=l.getCryptoJS(),Un=/^[0-9a-zA-Z`~!@#$%^&*()-_=+\\\\|\\[{\]};:'",<.>/? ]{6,32}$/,qn=/^(?![0-9]+$)(?![a-z]+$)(?![A-Z]+$)(?![^a-zA-Z0-9]+$)[0-9a-zA-Z`~!@#$%^&*()-_=+\\\\|\\[{\]};:'",<.>? ]{8,32}$/,Ln=16,Kn=12,Vn=Kn+Ln+32,Bn=new u("SecretKeyManager"),Fn=function(){function e(e){this.userDataKeyInfo=new zn,this.cloudStorage=e.getNaturalCloudStorage(),this.entireEncryption=new _n(e),this.entireEncryptInterval=e.getEntireEncryptInterval(),this.entireEncryptInterval.saveSecretKeyManager(this)}return e.prototype.getEntireEncryption=function(){return this.entireEncryption},e.prototype.setUserKey=function(e,t){return y(this,void 0,void 0,(function(){var n,r,o,i;return h(this,(function(s){switch(s.label){case 0:return this.checkUserKeyFormat(e,!1),[4,this.getUserId()];case 1:return n=s.sent(),r=new zn,[4,this.getSaltFromCloud()];case 2:return o=s.sent(),0!==(i=o.resultCode)?[3,4]:(Bn.log("setUserKey: user key has been created, need to verify it."),r.rootKeySalt=o.encryptInfo[0].firstSaltValue,r.rootKeyTokenSalt=o.encryptInfo[0].secondSaltValue,[4,this.verifyUserKey(n,e,r)]);case 3:return s.sent(),this.entireEncryptInterval.setIntervalCleanKey(!1),[3,7];case 4:return 54!==i?[3,6]:(Bn.log("setUserKey: the first time to set user key."),[4,this.createUserKey(n,e,r,t)]);case 5:return s.sent(),this.entireEncryptInterval.setIntervalCleanKey(!1),[3,7];case 6:return Bn.error("setUserKey: get salt failed, ret: "+i+"."),this.clearDataKeyInfo(),this.entireEncryption.clearUserKeysInfo(),[2,Promise.reject(i)];case 7:return this.userDataKeyInfo.copy(r),[2]}}))}))},e.prototype.modifyUserKey=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o,i;return h(this,(function(s){switch(s.label){case 0:return this.checkUserKeyFormat(e,!1),this.checkUserKeyFormat(t,n),[4,this.getUserId()];case 1:return r=s.sent(),o=new zn,[4,this.getSaltFromCloud()];case 2:return 0!==(i=s.sent()).resultCode?(Bn.error("ModifyUserKey: get user salt failed."),[2,Promise.reject(i.resultCode)]):(o.rootKeySalt=i.encryptInfo[0].firstSaltValue,o.rootKeyTokenSalt=i.encryptInfo[0].secondSaltValue,[4,this.modifyUserKeyInner(r,e,t,o)]);case 3:return s.sent(),this.userDataKeyInfo.copy(o),this.entireEncryptInterval.setIntervalCleanKey(!1),[2]}}))}))},e.prototype.verifyUserKey=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o,i,s,a;return h(this,(function(u){switch(u.label){case 0:this.clearDataKeyInfo(),u.label=1;case 1:return u.trys.push([1,4,,5]),[4,this.queryDataKeyCipher(t,n)];case 2:return r=u.sent(),o=r[0],i=r[1],n.userId=e,s=this.saveUserDataKey(o,i,n),[4,this.entireEncryption.setKeys(e,o,8,i,s,n.dataKeyVersion)];case 3:return u.sent(),[3,5];case 4:return a=u.sent(),Bn.error("verifyUserKey: verify user key failed, ret: "+a+"."),this.clearDataKeyInfo(),this.entireEncryption.clearUserKeysInfo(),[2,Promise.reject(a)];case 5:return[2]}}))}))},e.prototype.createUserKey=function(e,t,n,r){return y(this,void 0,void 0,(function(){var o,i,s,a;return h(this,(function(u){switch(u.label){case 0:r&&this.checkUserKeyFormat(t,!0),this.clearDataKeyInfo(),u.label=1;case 1:return u.trys.push([1,5,,6]),o=this.generateRandom(32),[4,this.generateUserKey(t,n,o)];case 2:return u.sent(),[4,this.InsertEncryptionInfoToCloud(n)];case 3:return u.sent(),n.userId=e,i=D.uint8ArrayToWordArray(o),n.userDataKey=D.stringToUint8Array(this.encodeDataKey(i)),n.userDataKeyLen=44,s=new Uint8Array(8),[4,this.entireEncryption.setKeys(n.userId,o,8,s,0,++n.dataKeyVersion)];case 4:return u.sent(),[3,6];case 5:return a=u.sent(),Bn.error("createUserKey: create user key failed, ret: "+a+"."),this.clearDataKeyInfo(),this.entireEncryption.clearUserKeysInfo(),[2,Promise.reject(a)];case 6:return[2]}}))}))},e.prototype.modifyUserKeyInner=function(e,t,n,r){return y(this,void 0,void 0,(function(){var o,i,s,a;return h(this,(function(u){switch(u.label){case 0:return this.clearDataKeyInfo(),[4,this.queryDataKeyCipher(t,r)];case 1:return o=u.sent(),Bn.log("SecretKeyManager: query data key cipher success."),i=o[0],s=o[1],a=r.userRootKeyToken,[4,this.reGenerateUserKey(n,r,i,s)];case 2:return u.sent(),[4,this.updateEncryptionInfoToCloud(a,r)];case 3:return u.sent(),r.userId=e,this.saveUserDataKey(i,s,r),[2]}}))}))},e.prototype.queryDataKeyCipher=function(e,t){return y(this,void 0,void 0,(function(){var n,r,o,i;return h(this,(function(s){switch(s.label){case 0:return n={keySize:8,hasher:xn.algo.SHA256.create(),iterations:1e5},r=xn.PBKDF2(e,D.uint8ArrayToWordArray(t.rootKeySalt),n),D.isNullOrUndefined(r)?(Bn.error("queryDataKeyCipher: derive root key failed."),[2,Promise.reject(1)]):(t.userRootKey=D.wordArrayToUint8Array(r),t.userRootKeyLen=8,o={keySize:8,hasher:xn.algo.SHA256.create(),iterations:1e4},i=xn.PBKDF2(r,D.uint8ArrayToWordArray(t.rootKeyTokenSalt),o),D.isNullOrUndefined(i)?(Bn.error("QueryDataKeyCipher: derive root key token failed."),[2,Promise.reject(1)]):(t.userRootKeyToken=D.wordArrayToUint8Array(i),t.userRootKeyTokenLen=8,[4,this.queryDataKeyCipherFromCloud(t)]));case 1:return s.sent(),[4,this.decryptQueryCipherText(t)];case 2:return[2,s.sent()]}}))}))},e.prototype.reGenerateUserKey=function(e,t,n,r){return y(this,void 0,void 0,(function(){var o,i;return h(this,(function(s){switch(s.label){case 0:return[4,this.generateUserKey(e,t,n)];case 1:return s.sent(),t.userOldDataKeyCipherLen>0?(o=this.generateRandom(Kn))?[4,this.entireEncryption.aesGcm256Encrypt(r,t.userRootKey,o)]:(Bn.warn("reGenerateUserKey: random to generate gcmIv failed."),[2,Promise.reject(1)]):[3,3];case 2:if((i=s.sent()).length<=0)return Bn.warn("reGenerateUserKey: encrypt old dataKey failed."),[2,Promise.reject(52)];t.userOldDataKeyCipher={iv:o,tag:i.slice(32,i.length),cipherText:i.slice(0,32)},s.label=3;case 3:return[2]}}))}))},e.prototype.generateUserKey=function(e,t,n){return y(this,void 0,void 0,(function(){var r,o,i,s,a,u,c,l,d;return h(this,(function(p){switch(p.label){case 0:return t.rootKeySalt=this.generateRandom(16),r={keySize:8,hasher:xn.algo.SHA256.create(),iterations:1e5},o=D.uint8ArrayToWordArray(t.rootKeySalt),[4,xn.PBKDF2(e,o,r)];case 1:return i=p.sent(),D.isNullOrUndefined(i)?(Bn.warn("GenerateUserKey: derive root key failed."),[2,Promise.reject(1)]):(s=D.wordArrayToUint8Array(i),t.userRootKey=s,t.userRootKeyLen=8,t.rootKeyTokenSalt=this.generateRandom(16),a={keySize:8,hasher:xn.algo.SHA256.create(),iterations:1e4},u=D.uint8ArrayToWordArray(t.rootKeyTokenSalt),[4,xn.PBKDF2(i,u,a)]);case 2:return c=p.sent(),D.isNullOrUndefined(c)?(Bn.warn("GenerateUserKey: derive root key token failed."),[2,Promise.reject(1)]):(t.userRootKeyToken=D.wordArrayToUint8Array(c),t.userRootKeyTokenLen=8,(l=this.generateRandom(Kn))?[4,this.entireEncryption.aesGcm256Encrypt(n,s,l)]:(Bn.warn("GenerateUserKey: random to generate gcmIv failed."),[2,Promise.reject(1)]));case 3:return(d=p.sent())?(t.userDataKeyCipher={iv:l,tag:d.slice(32,d.length),cipherText:d.slice(0,32)},[2]):(Bn.warn("GenerateUserKey: encrypt dataKey failed."),[2,Promise.reject(52)])}}))}))},e.prototype.onKeyStatusChanged=function(e){return y(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return Bn.log("onKeyStatusChanged: process call back with dataKey changed, keyStatus: "+e),(t=e)!==Ke.INTERRUPT&&t!==Ke.NORMAL?[2,Promise.resolve(0)]:[4,this.queryDataKeyAfterReKey()];case 1:return n.sent(),[2,Promise.resolve(0)]}}))}))},e.prototype.queryDataKeyAfterReKey=function(){var e;return y(this,void 0,void 0,(function(){var t,n,r;return h(this,(function(o){switch(o.label){case 0:return[4,this.checkDataKeyCache()];case 1:return o.sent(),(t=new Fe).rootKeyToken=this.userDataKeyInfo.userRootKeyToken,[4,this.cloudStorage.queryDataKeyCipherText(t)];case 2:return 0!==(n=o.sent()).resultCode?(Bn.warn("queryDataKeyAfterReKey: query data key cipher failed from cloud,\n             ret:"+n.resultCode+"."),[2,Promise.reject(n.resultCode)]):(r=n.encryptInfo[0]).dataKeyCipherText&&r.dataKeyCipherText.length===Vn?this.userDataKeyInfo.dataKeyVersion<r.keyVersion?[4,this.refreshDataKeyCache(r)]:[3,4]:(Bn.warn("queryDataKeyAfterReKey: cloud saved dataKeyCipherText is invalid,\n             dataKeyCipherText length: "+(null===(e=r.dataKeyCipherText)||void 0===e?void 0:e.length)),[2,Promise.reject(51)]);case 3:o.sent(),o.label=4;case 4:return[2]}}))}))},e.prototype.checkKeyIfNetworkReconnect=function(){return y(this,void 0,void 0,(function(){var e,t;return h(this,(function(n){switch(n.label){case 0:return Bn.log("CheckKeyIfNetworkReconnect: check userKey or dataKey changed after reconnect."),[4,this.checkDataKeyCache()];case 1:return n.sent(),(e=new Fe).rootKeyToken=this.userDataKeyInfo.userRootKeyToken,[4,this.cloudStorage.queryDataKeyCipherText(e)];case 2:return 0!==(t=n.sent()).resultCode?(Bn.warn("CheckKeyIfNetworkReconnect: query data key cipher failed from cloud,\n             ret:"+t.resultCode+"."),[2,Promise.reject(t.resultCode)]):[2,this.processDataKeyChangedByReconnect(t.encryptInfo[0])]}}))}))},e.prototype.processDataKeyChangedByReconnect=function(e){return y(this,void 0,void 0,(function(){var t;return h(this,(function(n){switch(n.label){case 0:return e?(t=e.keyStatus,Bn.info("ProcessDataKeyChangedByReconnect: process reconnect with dataKey changed,' +\n            ' keyStatus: "+t+"."),t===Ke.INTERRUPT||t===Ke.NORMAL&&this.userDataKeyInfo.dataKeyVersion<e.keyVersion?[4,this.refreshDataKeyCache(e)]:[2,Promise.resolve(0)]):(Bn.warn("ProcessDataKeyChangedByReconnect: encryptionInfo is null"),[2,Promise.reject(1003)]);case 1:return n.sent(),Bn.log("processDataKeyChangedByReconnect success"),[2,Promise.resolve(0)]}}))}))},e.prototype.refreshDataKeyCache=function(e){var t;return y(this,void 0,void 0,(function(){var n,r,o,i;return h(this,(function(s){switch(s.label){case 0:return this.clearOldDataKeyInfo(),e.dataKeyCipherText&&e.dataKeyCipherText.byteLength===Vn?(this.saveDataKeyCipher(e,this.userDataKeyInfo),[4,this.decryptQueryCipherText(this.userDataKeyInfo)]):(Bn.warn("refreshDataKeyCache: cloud saved dataKeyCipherText is invalid,\n             dataKeyCipherText length: "+(null===(t=e.dataKeyCipherText)||void 0===t?void 0:t.length)),[2,Promise.reject(51)]);case 1:return n=s.sent(),r=n[0],o=n[1],i=this.saveUserDataKey(r,o,this.userDataKeyInfo),[4,this.entireEncryption.setKeys(this.userDataKeyInfo.userId,r,8,o,i,this.userDataKeyInfo.dataKeyVersion)];case 2:return s.sent(),[2]}}))}))},e.prototype.decryptQueryCipherText=function(e){return y(this,void 0,void 0,(function(){var t,n,r,o,i,s,a,u,c;return h(this,(function(l){switch(l.label){case 0:t=[new Uint8Array(32),new Uint8Array(32)],n=Array.from(e.userDataKeyCipher.cipherText).concat(Array.from(e.userDataKeyCipher.tag)),r=e.userDataKeyCipher.iv,l.label=1;case 1:return l.trys.push([1,3,,4]),o=t,i=0,[4,this.entireEncryption.aesGcm256Decrypt(new Uint8Array(n),e.userRootKey,r)];case 2:return o[i]=l.sent(),[3,4];case 3:return l.sent(),Bn.error("decryptQueryCipherText:decrypt dataKeyCipher failed."),[2,Promise.reject(53)];case 4:if(!(e.userOldDataKeyCipherLen>0))return[3,8];s=Array.from(e.userOldDataKeyCipher.cipherText).concat(Array.from(e.userOldDataKeyCipher.tag)),a=e.userOldDataKeyCipher.iv,l.label=5;case 5:return l.trys.push([5,7,,8]),u=t,c=1,[4,this.entireEncryption.aesGcm256Decrypt(new Uint8Array(s),e.userRootKey,a)];case 6:return u[c]=l.sent(),[3,8];case 7:return l.sent(),Bn.error("QueryDataKeyCipher:decrypt oldDataKeyCipher failed."),[2,Promise.reject(53)];case 8:return[2,Promise.resolve(t)]}}))}))},e.prototype.saveDataKeyCipher=function(e,t){var n=e.dataKeyCipherText,r=n.slice(0,Kn),o=n.slice(Kn,Kn+Ln),i=n.slice(Kn+Ln,n.length);if(t.userDataKeyCipher={cipherText:i,tag:o,iv:r},t.userDataKeyCipherLen=Vn,t.dataKeyVersion=e.keyVersion,t.dataKeyStatus=e.keyStatus,e.oldDataKeyCipherText&&e.oldDataKeyCipherText.length===Vn){var s=e.oldDataKeyCipherText,a=s.slice(0,Kn),u=s.slice(Kn,Kn+Ln),c=s.slice(Kn+Ln,s.length);t.userOldDataKeyCipher={cipherText:c,tag:u,iv:a},t.userOldDataKeyCipherLen=Vn}},e.prototype.saveUserDataKey=function(e,t,n){var r=D.uint8ArrayToWordArray(e);n.userDataKey=D.stringToUint8Array(this.encodeDataKey(r)),n.userDataKeyLen=44;var o=0;if(n.userOldDataKeyCipherLen>0){var i=D.uint8ArrayToWordArray(t);n.userOldDataKey=D.stringToUint8Array(this.encodeDataKey(i)),n.userDataKeyLen=44,o=8}return o},e.prototype.getSaltFromCloud=function(){var e,t,n,r;return y(this,void 0,void 0,(function(){var o;return h(this,(function(i){switch(i.label){case 0:return[4,this.cloudStorage.querySaltValue()];case 1:return 0!==(o=i.sent()).resultCode?(Bn.warn("GetSaltFromCloud: cloud has not saved this user`s salt."),[2,o]):o.encryptInfo[0]&&o.encryptInfo[0].firstSaltValue&&o.encryptInfo[0].secondSaltValue?16!==(null===(e=o.encryptInfo[0].firstSaltValue)||void 0===e?void 0:e.length)||16!==(null===(t=o.encryptInfo[0].secondSaltValue)||void 0===t?void 0:t.length)?(Bn.warn("GetSaltFromCloud: cloud saved salt length is not effective length,             firstSalt length:"+(null===(n=o.encryptInfo[0].firstSaltValue)||void 0===n?void 0:n.length)+",              secondSalt length:"+(null===(r=o.encryptInfo[0].secondSaltValue)||void 0===r?void 0:r.length)),[2,new ze(1,[])]):[2,o]:(Bn.warn("GetSaltFromCloud: cloud saved salt value is null."),[2,new ze(54,[])])}}))}))},e.prototype.InsertEncryptionInfoToCloud=function(e){return y(this,void 0,void 0,(function(){var t,n,r;return h(this,(function(o){switch(o.label){case 0:return(t=new Fe).firstSaltValue=e.rootKeySalt,t.secondSaltValue=e.rootKeyTokenSalt,t.rootKeyToken=e.userRootKeyToken,n=Array.from(e.userDataKeyCipher.iv).concat(Array.from(e.userDataKeyCipher.tag)).concat(Array.from(e.userDataKeyCipher.cipherText)),t.dataKeyCipherText=new Uint8Array(n),[4,this.cloudStorage.insertEncryptedInfo(t)];case 1:return 0!==(r=o.sent()).resultCode?(Bn.warn("InsertEncryptionInfoToCloud: insert encrypt info failed."),[2,Promise.reject(r.resultCode)]):[2]}}))}))},e.prototype.queryDataKeyCipherFromCloud=function(e){var t;return y(this,void 0,void 0,(function(){var n,r,o;return h(this,(function(i){switch(i.label){case 0:return(n=new Fe).rootKeyToken=e.userRootKeyToken,[4,this.cloudStorage.queryDataKeyCipherText(n)];case 1:return 0!==(r=i.sent()).resultCode?(Bn.warn("QueryDataKeyCipherFromCloud: query dataKeyCipher failed."),[2,Promise.reject(r.resultCode)]):(o=r.encryptInfo[0]).dataKeyCipherText&&o.dataKeyCipherText.length===Vn?(this.saveDataKeyCipher(o,e),[2]):(Bn.warn("queryDataKeyCipherFromCloud: cloud saved dataKeyCipherText is invalid,\n             dataKeyCipherText length: "+(null===(t=o.dataKeyCipherText)||void 0===t?void 0:t.length)),[2,Promise.reject(1)])}}))}))},e.prototype.updateEncryptionInfoToCloud=function(e,t){return y(this,void 0,void 0,(function(){var n,r,o,i,s;return h(this,(function(a){switch(a.label){case 0:return(n=new Fe).rootKeyToken=e,r=Array.from(t.userDataKeyCipher.iv).concat(Array.from(t.userDataKeyCipher.tag)).concat(Array.from(t.userDataKeyCipher.cipherText)),(o=new Fe).firstSaltValue=t.rootKeySalt,o.secondSaltValue=t.rootKeyTokenSalt,o.rootKeyToken=t.userRootKeyToken,o.dataKeyCipherText=new Uint8Array(r),t.userOldDataKeyCipherLen>0&&(i=Array.from(t.userOldDataKeyCipher.iv).concat(Array.from(t.userOldDataKeyCipher.tag)).concat(Array.from(t.userOldDataKeyCipher.cipherText)),o.oldDataKeyCipherText=new Uint8Array(i)),[4,this.cloudStorage.updateEncryptedInfo(n,o)];case 1:return 0!==(s=a.sent()).resultCode?(Bn.warn("updateEncryptionInfoToCloud: update encrypt info failed."),[2,Promise.reject(s.resultCode)]):[2]}}))}))},e.prototype.getUserId=function(){return y(this,void 0,void 0,(function(){var e,t;return h(this,(function(n){switch(n.label){case 0:return[4,We.getConfigInstance().getCurrentUser()];case 1:return e=n.sent(),t=null==e?void 0:e.getUid(),D.isNullOrUndefined(e)||D.isNullOrUndefined(t)?(Bn.error("getUserId: this user is not authenticated."),[2,Promise.reject(15)]):[2,t]}}))}))},e.prototype.checkDataKeyCache=function(){return y(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return[4,this.getUserId()];case 1:return e=t.sent(),8!==this.userDataKeyInfo.userRootKeyLen||8!==this.userDataKeyInfo.userRootKeyTokenLen?(Bn.warn("checkDataKeyCache: user key is invalid, please verify user key first."),[2,Promise.reject(51)]):e!==this.userDataKeyInfo.userId?(Bn.warn("checkDataKeyCache: this user is not the current user, please verify user key first."),[2,Promise.reject(15)]):[2]}}))}))},e.prototype.checkUserKeyFormat=function(e,t){if(!(t?qn.test(e):Un.test(e)))throw Bn.error("checkUserKeyFormat: user key is invalid."),C.build(50)},e.prototype.encodeDataKey=function(e){return D.encode(e)},e.prototype.generateRandom=function(e){return this.entireEncryption.generateRandom(e)},e.prototype.clearDataKeyInfo=function(){Bn.log("clearDataKeyInfo: clear dataKey."),this.userDataKeyInfo.userId="",this.userDataKeyInfo.userRootKeyLen=0,this.userDataKeyInfo.userRootKeyTokenLen=0,this.userDataKeyInfo.userRootKey=new Uint8Array(0),this.userDataKeyInfo.userRootKeyToken=new Uint8Array(0),this.clearOldDataKeyInfo()},e.prototype.clearOldDataKeyInfo=function(){this.userDataKeyInfo.dataKeyVersion=0,this.userDataKeyInfo.dataKeyStatus=0,this.userDataKeyInfo.userDataKeyLen=0,this.userDataKeyInfo.userDataKeyCipherLen=0,this.userDataKeyInfo.userOldDataKeyLen=0,this.userDataKeyInfo.userOldDataKeyCipherLen=0,this.userDataKeyInfo.userDataKey=new Uint8Array(0),this.userDataKeyInfo.userDataKeyCipher={iv:new Uint8Array(0),tag:new Uint8Array(0),cipherText:new Uint8Array(0)},this.userDataKeyInfo.userOldDataKey=new Uint8Array(0),this.userDataKeyInfo.userOldDataKeyCipher={iv:new Uint8Array(0),tag:new Uint8Array(0),cipherText:new Uint8Array(0)}},e}(),zn=function(){function e(){this.userId="",this.userRootKey=new Uint8Array(0),this.userRootKeyToken=new Uint8Array(0),this.userDataKey=new Uint8Array(0),this.userDataKeyCipher={iv:new Uint8Array(0),tag:new Uint8Array(0),cipherText:new Uint8Array(0)},this.userOldDataKey=new Uint8Array(0),this.userOldDataKeyCipher={iv:new Uint8Array(0),tag:new Uint8Array(0),cipherText:new Uint8Array(0)},this.userRootKeyLen=0,this.userRootKeyTokenLen=0,this.userDataKeyLen=0,this.userDataKeyCipherLen=0,this.dataKeyVersion=0,this.dataKeyStatus=0,this.userOldDataKeyLen=0,this.userOldDataKeyCipherLen=0,this.rootKeySalt=new Uint8Array(0),this.rootKeyTokenSalt=new Uint8Array(0)}return e.prototype.copy=function(e){this.userId=e.userId,this.userRootKey=new Uint8Array(e.userRootKey),this.userRootKeyToken=new Uint8Array(e.userRootKeyToken),this.userDataKey=new Uint8Array(e.userDataKey),this.userDataKeyCipher={iv:new Uint8Array(e.userDataKeyCipher.iv),tag:new Uint8Array(e.userDataKeyCipher.tag),cipherText:new Uint8Array(e.userDataKeyCipher.cipherText)},this.userOldDataKey=new Uint8Array(e.userOldDataKey),this.userOldDataKeyCipher={iv:new Uint8Array(e.userOldDataKeyCipher.iv),tag:new Uint8Array(e.userOldDataKeyCipher.tag),cipherText:new Uint8Array(e.userOldDataKeyCipher.cipherText)},this.userRootKeyLen=e.userRootKeyLen,this.userRootKeyTokenLen=e.userRootKeyTokenLen,this.userDataKeyLen=e.userDataKeyLen,this.userDataKeyCipherLen=e.userDataKeyCipherLen,this.dataKeyVersion=e.dataKeyVersion,this.dataKeyStatus=e.dataKeyStatus,this.userOldDataKeyLen=e.userOldDataKeyLen,this.userOldDataKeyCipherLen=e.userOldDataKeyCipherLen,this.rootKeySalt=new Uint8Array(e.rootKeySalt),this.rootKeyTokenSalt=new Uint8Array(e.rootKeyTokenSalt)},e}(),Gn=function(){function e(e){this.naturalCloudSyncModule=new sn(e)}return e.prototype.executeUpsert=function(e,t){return y(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,this.naturalCloudSyncModule.onUpsert(t,e)];case 1:return[2,n.sent()]}}))}))},e.prototype.executeDelete=function(e,t){return y(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,this.naturalCloudSyncModule.onDelete(t,e)];case 1:return[2,n.sent()]}}))}))},e.prototype.executeQuery=function(e,t,n){return y(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,this.naturalCloudSyncModule.onQuery(e,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.executeAggregateQuery=function(e,t,n){return y(this,void 0,void 0,(function(){var r;return h(this,(function(o){switch(o.label){case 0:return[4,this.naturalCloudSyncModule.onAggregateQuery(e,t,n)];case 1:return[2,(r=o.sent()).isNull?0:r.doubleRes]}}))}))},e.prototype.runTransaction=function(e,t,n){return y(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,this.naturalCloudSyncModule.onTransaction(e,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.unsubscribeForRekey=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.naturalCloudSyncModule.unsubscribeForRekey()];case 1:return[2,e.sent()]}}))}))},e.prototype.subscribeForRekey=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.naturalCloudSyncModule.subscribeForRekey()];case 1:return[2,e.sent()]}}))}))},e.prototype.onSubscribe=function(e,t,n,r){return y(this,void 0,void 0,(function(){return h(this,(function(o){switch(o.label){case 0:return[4,this.naturalCloudSyncModule.onSubscribe(e,t,n,r)];case 1:return[2,o.sent()]}}))}))},e.prototype.onUnSubscribe=function(e,t,n){return y(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,this.naturalCloudSyncModule.onUnSubscribe(e,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.needToDisconnectWebsocket=function(){return this.naturalCloudSyncModule.needToDisconnectWebsocket()},e.prototype.disconnectWebSocket=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.naturalCloudSyncModule.disconnectWebSocket()];case 1:return e.sent(),[2]}}))}))},e.prototype.addEncryptionListener=function(e){return y(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,this.naturalCloudSyncModule.getEncryptTaskManager().addEncryptionListener(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.querySaltValue=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.naturalCloudSyncModule.getEncryptTaskManager().querySaltValue()];case 1:return[2,e.sent()]}}))}))},e.prototype.queryDataKeyCipherText=function(e){return y(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,this.naturalCloudSyncModule.getEncryptTaskManager().queryDataKeyCipherText(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.insertEncryptedInfo=function(e){return y(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,this.naturalCloudSyncModule.getEncryptTaskManager().insertEncryptedInfo(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.updateEncryptedInfo=function(e,t){return y(this,void 0,void 0,(function(){return h(this,(function(n){switch(n.label){case 0:return[4,this.naturalCloudSyncModule.getEncryptTaskManager().updateEncryptedInfo(e,t)];case 1:return[2,n.sent()]}}))}))},e.prototype.executeServerStatusQuery=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.naturalCloudSyncModule.onServerStatusQuery()];case 1:return[2,e.sent()]}}))}))},e}(),Yn=function(){function e(){this.intervalTimeOut=0,this.timeOutStateMachine=!1,this.firstTime=0}return e.prototype.setIntervalCleanKey=function(e){var t=this;this.firstTime=Date.now(),e||this.timeOutStateMachine||(this.intervalTimeOut=setInterval((function(){var e;Date.now()-t.firstTime>=9e5&&(t.secretKeyManager&&t.secretKeyManager.clearDataKeyInfo(),null===(e=t.secretKeyManager)||void 0===e||e.getEntireEncryption().clearUserKeysInfo(),t.encryptTaskManager.tryToDisconnectWhenClearUserKey(),t.timeOutStateMachine=!1,clearInterval(t.intervalTimeOut))}),3e4),this.timeOutStateMachine=!0)},e.prototype.saveSecretKeyManager=function(e){this.secretKeyManager=e},e.prototype.saveEncryptTaskManager=function(e){this.encryptTaskManager=e},e}(),Qn=new u("NaturalBase"),Hn=function(){function e(e){this.naturalStoreMap=new Map,this.isUserKeyValid=!1,this.onEventListener=void 0,this.certificateService=new In(e),this.entireEncryptInterval=new Yn,this.defaultNStore=new mn,this.cloudStorage=new Gn(this),this.secretKeyManager=new Fn(this)}return e.prototype.getNaturalStore=function(e){if(!D.isEmpty(e))return this.naturalStoreMap.get(e)},e.prototype.getAllNaturalStore=function(){return v(this.naturalStoreMap.values())},e.prototype.createObjectType=function(e){this.validateSchemaInput(e);var t=this.convert(e);if(!this.defaultNStore)return Qn.error("createObjectType: the default naturalStore is not inited."),1;if(0!==this.naturalStoreMap.size)return Qn.warn("createObjectType: opening naturalStore exists."),8;var n=this.defaultNStore.getAppSchema();if(0!==n.size&&he.compareSchemas(this.defaultNStore.getAppVersion(),n,e.schemaVersion,t))return 0;return this.certificateService.setAppVersion(e.schemaVersion),this.defaultNStore.createObjectType(e.schemaVersion,t),0},e.prototype.openNaturalStore=function(e){return y(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){if(t={naturalStore:void 0,exceptionCode:1},this.defaultNStore instanceof mn){if(!this.naturalStoreMap.has(e)){if(this.naturalStoreMap.size>=4)return Qn.warn("the count of natural store exceeds 4"),t.exceptionCode=6,[2,t];n=new Re(e,this),this.naturalStoreMap.set(n.naturalStoreId,n)}t.naturalStore=this.naturalStoreMap.get(e),t.exceptionCode=0}return[2,t]}))}))},e.prototype.tryCloseNaturalStore=function(e,t){var n=this.naturalStoreMap.get(t);if(n)if(n.references.has(e))if(n.references.size>1)n.references.delete(e);else{if(n.hasSubscriber())throw Qn.error("tryCloseNaturalStore: zone has snapshot subscriber."),C.build(10);n.close(),this.naturalStoreMap.delete(t),this.naturalStoreMap.size||(Qn.log("tryCloseNaturalStore: will to disconnect websocket."),this.cloudStorage.disconnectWebSocket()),n.references.delete(e),Qn.log("tryCloseNaturalStore: close zone success.")}else Qn.warn("tryCloseNaturalStore: zone has been closed.");else Qn.warn("tryCloseNaturalStore: zone has not been found.")},e.prototype.setUserKey=function(e,t,n){var r,o;return y(this,void 0,void 0,(function(){var i,s;return h(this,(function(a){switch(a.label){case 0:i=t.length,a.label=1;case 1:return a.trys.push([1,6,,7]),0!==i?[3,3]:(Qn.log("SetUserKey: begin to set user key."),[4,null===(r=this.secretKeyManager)||void 0===r?void 0:r.setUserKey(e,n)]);case 2:return a.sent(),[3,5];case 3:return Qn.log("SetUserKey: begin to modify user key."),[4,null===(o=this.secretKeyManager)||void 0===o?void 0:o.modifyUserKey(e,t,n)];case 4:a.sent(),a.label=5;case 5:return[3,7];case 6:return s=a.sent(),D.isErrorObject(s)?[2,Promise.reject(s)]:[2,Promise.reject(C.build(s))];case 7:return this.isUserKeyValid=!0,this.onEventListener?[4,this.addEncryptionMonitor()]:[3,9];case 8:a.sent(),a.label=9;case 9:return Qn.log("setUserKey: set or modify user key success."),[2,Promise.resolve(!0)]}}))}))},e.prototype.addOnEventListener=function(e){return y(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return this.onEventListener=e,this.isUserKeyValid?[4,this.addEncryptionMonitor()]:(Qn.warn("user key is invalid, schedule to addEventListener when user key is valid"),[2]);case 1:return t.sent(),[2]}}))}))},e.prototype.addEncryptionMonitor=function(){return y(this,void 0,void 0,(function(){var e=this;return h(this,(function(t){switch(t.label){case 0:return this.monitor||(this.monitor=new wn((function(){var t;Qn.info("start onUserCommandChanged"),null===(t=e.onEventListener)||void 0===t||t.onEvent(bn.USER_KEY_CHANGED)}),(function(t){return y(e,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return Qn.info("start onKeyStatusChanged, status:"+t),[4,this.secretKeyManager.onKeyStatusChanged(t).catch((function(e){return e}))];case 1:return 0!==(e=n.sent())?(Qn.error("onKeyStatusChanged process fail, resultCode:"+e),[2]):t!==Ke.UPDATING?[3,3]:[4,this.cloudStorage.unsubscribeForRekey()];case 2:return n.sent(),[3,5];case 3:return t!==Ke.NORMAL?[3,5]:[4,this.cloudStorage.subscribeForRekey()];case 4:n.sent(),n.label=5;case 5:return[2]}}))}))}))),[4,this.cloudStorage.addEncryptionListener(this.monitor)];case 1:return t.sent(),Qn.info("addEncryptionMonitor done."),[2]}}))}))},e.prototype.onConnect=function(){var e;return y(this,void 0,void 0,(function(){var t,n;return h(this,(function(r){switch(r.label){case 0:return Qn.log("start onConnect"),this.onEventListener?[4,this.secretKeyManager.checkKeyIfNetworkReconnect().catch((function(e){return e}))]:[3,4];case 1:return t=r.sent(),this.isUserKeyValid=0===t,this.isUserKeyValid?[4,this.addEncryptionMonitor()]:[3,3];case 2:r.sent(),r.label=3;case 3:1005001===t&&(Qn.warn("user key has changed, need to set new user key."),null===(e=this.onEventListener)||void 0===e||e.onEvent(bn.USER_KEY_CHANGED)),r.label=4;case 4:return[4,this.cloudStorage.onSubscribe(Ct.ALL_STORE,void 0,void 0,!0)];case 5:return 0!==(n=r.sent())&&Qn.error("Resubscribe fail for: "+n),!this.cloudStorage.needToDisconnectWebsocket()||this.isUserKeyValid?[3,7]:(Qn.debug("need to disconnect"),[4,this.cloudStorage.disconnectWebSocket()]);case 6:r.sent(),r.label=7;case 7:return[2]}}))}))},e.prototype.validateSchemaInput=function(e){if(D.isNullOrUndefined(e))throw C.build("The object type info must not be null.");if(D.isNullOrUndefined(e.objectTypes)||D.isNullOrUndefined(e.permissions))throw C.build("The object type list and permissions must not be null.");if("number"!=typeof e.schemaVersion||isNaN(e.schemaVersion)||e.schemaVersion<=0)throw C.build("The version of object type should be greater than 0.");if(e.objectTypes.length!==e.permissions.length)throw C.build("The size of object type list should be the same as permissions.")},e.prototype.convert=function(e){var t=e.permissions,n=e.objectTypes,r=new Map,o=function(e,t){return e.objectTypeName===t.objectTypeName?0:e.objectTypeName>t.objectTypeName?1:-1};t.length>1&&t.sort(o),n.length>1&&n.sort(o);for(var i=0;i<t.length;i++){var s=new fe(t[i],n[i]);he.validateObjectSchema(s),r.set(s.name,s)}return r},e.prototype.getDataModelHelper=function(){var e;return null===(e=this.defaultNStore)||void 0===e?void 0:e.getDataModelHelper()},e.prototype.getDefaultNaturalStore=function(){return this.defaultNStore},e.prototype.getEntireEncryptInterval=function(){return this.entireEncryptInterval},e.prototype.getEntireEncryption=function(){return this.secretKeyManager.getEntireEncryption()},e.prototype.getNaturalCloudStorage=function(){return this.cloudStorage},e.prototype.getCertificateService=function(){return this.certificateService},e}(),Wn=new u("ListenerHandlerImpl"),Jn=function(){function e(e,t,n){this.naturalStore=e,this.listenerId=t,this.callback=n}return e.prototype.remove=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return null!==this.callback&&(this.callback.remove(this),this.callback=null),this.naturalStore?[4,this.naturalStore.removeSnapshotListener(this.listenerId)]:[3,2];case 1:0!==e.sent()&&Wn.error("remove registration failed."),e.label=2;case 2:return this.naturalStore=null,[2]}}))}))},e}(),Xn=new u("TransactionImpl"),Zn=function(){function e(e){this.transactionObjectsSize=0,this.needVerifyObjects=[],this.needVerifyObjectsMap=new Map,this.queryObjectsSize=0,this.transactionList=[],this.zone=e}return e.prototype.executeQuery=function(e){return y(this,void 0,void 0,(function(){var t=this;return h(this,(function(n){if(this.zone.getNaturalStore().checkQueryClass(e),this.transactionList.length>0)throw Xn.warn("All transaction read need before all transaction write."),C.build("All transaction read need before all transaction write.");return[2,new Promise((function(n,r){t.zone.getNaturalStore().executeTransactionQuery(e).then((function(r){var o,i;if(t.needVerifyObjectsMap.has(e.getClassName())){var s=t.needVerifyObjectsMap.get(e.getClassName()).objects;t.needVerifyObjectsMap.get(e.getClassName()).objects=s.concat(r.objects)}else t.needVerifyObjectsMap.set(e.getClassName(),{objectTypeName:e.getClassName(),objects:r.objects});try{for(var a=b(r.decryptObjects),u=a.next();!u.done;u=a.next()){var c=u.value;t.queryObjectsSize=t.queryObjectsSize+t.zone.getDataModelHelper().calculateObject(c)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}n(r.decryptObjects)})).catch((function(e){r(D.isErrorObject(e)?e:C.build(e))}))}))]}))}))},e.prototype.executeUpsert=function(e){if(!this.checkObjectList(e,"upsert"))return this;this.calculateObjectsSize(e);var t=D.getClassName(e[0]);return this.transactionList.push({operationType:w.SYNC_UPSERT,objectTypeName:t,objects:e}),this},e.prototype.executeDelete=function(e){return this.checkObjectList(e,"delete")?(this.calculateObjectsSize(e),this.transactionList.push({operationType:w.SYNC_DELETE,objectTypeName:D.getClassName(e[0]),objects:e}),this):this},e.prototype.calculateObjectsSize=function(e){var t,n;try{for(var r=b(e),o=r.next();!o.done;o=r.next()){var i=o.value;this.transactionObjectsSize=this.transactionObjectsSize+this.zone.getDataModelHelper().calculateObject(i)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.release=function(){this.needVerifyObjects=[],this.transactionList=[],this.transactionObjectsSize=0,this.queryObjectsSize=0,this.needVerifyObjectsMap.clear()},e.prototype.isTransactionEmpty=function(){var e,t;try{for(var n=b(this.transactionList),r=n.next();!r.done;r=n.next()){if(r.value.objects.length>0)return!1}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return!0},e.prototype.getTransactionObjectsSize=function(){return this.transactionObjectsSize},e.prototype.getQueryObjectsSize=function(){return this.queryObjectsSize},e.prototype.getTransactionList=function(){return this.transactionList},e.prototype.getNeedVerifyObjects=function(){return this.needVerifyObjects},e.prototype.sortNeedVerifyObjects=function(){var e,t,n=Array.from(this.needVerifyObjectsMap.values()).sort((function(e,t){return e.objectTypeName.localeCompare(t.objectTypeName)})),r=function(e){var t=o.zone.getDataModelHelper().getPrimaryKeyByClassName(e.objectTypeName);e.objects.sort((function(e,n){var r,o,i=e.userObject,s=n.userObject;try{for(var a=(r=void 0,b(t)),u=a.next();!u.done;u=a.next()){var c=u.value,l=0;switch(c.fieldType){case q.Byte:case q.Short:case q.Integer:l=i[c.fieldName]-s[c.fieldName];break;case q.Long:l=i[c.fieldName].compare(s[c.fieldName]);break;case q.String:l=i[c.fieldName].localeCompare(s[c.fieldName])}if(0!==l)return l}}catch(e){r={error:e}}finally{try{u&&!u.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return 0})),o.needVerifyObjects=o.needVerifyObjects.concat(e.objects)},o=this;try{for(var i=b(n),s=i.next();!s.done;s=i.next()){r(s.value)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.checkObjectList=function(e,t){if(!e)throw C.build("The object list must not be null.");if(!D.isArray(e))throw C.build("The object list is invalid.");if(0===e.length)return Xn.log("No objects to "+t+"."),!1;if(!D.isSameObjectType(e))throw C.build("Only one object type is supported for batch operations.");return!0},e}(),$n=new u("CloudDBZone"),er=function(){},tr=function(){function e(e,t,n){var r=this;this.listenerHandlers=new Set,this.callback={remove:function(e){r.listenerHandlers.delete(e)}},this.zoneId=e,this.zoneName=t,this.naturalStore=n,this.naturalStore.references.add(e)}return Object.defineProperty(e.prototype,"cloudDBZoneName",{get:function(){return this.zoneName},enumerable:!1,configurable:!0}),e.prototype.executeServerStatusQuery=function(){return y(this,void 0,void 0,(function(){var e=this;return h(this,(function(t){return[2,new Promise((function(t,n){e.naturalStore.executeServerStatusQuery().then((function(e){t(e)})).catch((function(e){n(D.isErrorObject(e)?e:C.build(e))}))}))]}))}))},e.prototype.subscribeSnapshot=function(t,n){return y(this,void 0,void 0,(function(){var r,o=this;return h(this,(function(i){return this.checkQuickGamePlatform(),this.checkCloudDBZoneHandle(),this.checkListener(n),r=++e.listenerId,[2,new Promise((function(e,i){o.naturalStore.addSnapshotListener(t,n,r).then((function(t){if(0!==t)return $n.error("register listener failed."),void i(C.build(t));var n=new Jn(o.naturalStore,r,o.callback);o.listenerHandlers.add(n),e(n)})).catch((function(e){i(D.isErrorObject(e)?e:C.build(e))}))}))]}))}))},e.prototype.checkListener=function(e){if(D.isNullOrUndefined(e))throw C.build("The listener must not be null.");if("object"!=typeof e||"function"!=typeof e.onSnapshot)throw C.build("The listener must be object or function.")},e.prototype.hasSnapshot=function(){return this.listenerHandlers.size>0},e.prototype.executeUpsert=function(e){return y(this,void 0,void 0,(function(){var t,n=this;return h(this,(function(r){return this.isValidOperation(e),0===(t=D.convertArray(e)).length?($n.warn("ObjectList is empty when executeUpsert."),[2,Promise.resolve(0)]):(this.validateObjectList(t),[2,new Promise((function(e,r){n.naturalStore.executeUpsert(t).then((function(t){e(t)})).catch((function(e){r(D.isErrorObject(e)?e:C.build(e))}))}))])}))}))},e.prototype.validateObjectType=function(e){var t,n;try{for(var r=b(e),o=r.next();!o.done;o=r.next()){var i=o.value;if(!this.naturalStore.getDataModelHelper().validate(i))return!1}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0},e.prototype.calculateObjectListSize=function(e){var t=this,n=0;return e.forEach((function(e){n+=t.naturalStore.getDataModelHelper().calculateObject(e)})),n},e.prototype.executeDelete=function(e){return y(this,void 0,void 0,(function(){var t,n=this;return h(this,(function(r){return this.isValidOperation(e),0===(t=D.convertArray(e)).length?($n.warn("ObjectList is empty when executeDelete."),[2,Promise.resolve(0)]):(this.validateObjectList(t),[2,new Promise((function(e,r){n.naturalStore.executeDelete(t).then((function(t){e(t)})).catch((function(e){r(D.isErrorObject(e)?e:C.build(e))}))}))])}))}))},e.prototype.validateObjectList=function(e){if(e.length>1e3)throw C.build("The size of object list exceeds the limit.");if(!D.isSameObjectType(e))throw C.build("Only one object type is supported for batch operations.");if(!this.validateObjectType(e))throw C.build("The object type is not loaded yet.");if(this.calculateObjectListSize(e)>2097152)throw C.build("The capacity of objects exceeds the limit.")},e.prototype.executeQuery=function(e){return y(this,void 0,void 0,(function(){var t=this;return h(this,(function(n){return this.checkCloudDBZoneHandle(),[2,new Promise((function(n,r){t.naturalStore.executeQuery(e).then((function(e){n(e)})).catch((function(e){r(D.isErrorObject(e)?e:C.build(e))}))}))]}))}))},e.prototype.executeAverageQuery=function(e,t){var n=this;return this.checkCloudDBZoneHandle(),new Promise((function(r,o){n.naturalStore.executeAggregateQuery(e,"AVG",t).then((function(e){r(e)})).catch((function(e){o(D.isErrorObject(e)?e:C.build(e))}))}))},e.prototype.runTransaction=function(e){return this.checkQuickGamePlatform(),this.checkCloudDBZoneHandle(),this.checkTransactionFunction(e),this.getCloudDBZoneResult(e)},e.prototype.checkTransactionFunction=function(e){if(D.isNullOrUndefined(e))throw C.build("Function must not be null.");if("object"!=typeof e||"function"!=typeof e.apply)throw C.build("Function is invalid.")},e.prototype.getCloudDBZoneResult=function(e){return y(this,void 0,void 0,(function(){var t,n,r,o,i;return h(this,(function(s){switch(s.label){case 0:t=new Zn(this),n=!1,r=0,s.label=1;case 1:if(n||!(r<5))return[3,8];s.label=2;case 2:return s.trys.push([2,5,6,7]),[4,e.apply(t)];case 3:return(n=s.sent())?(t.sortNeedVerifyObjects(),this.verifyTransaction(t),[4,this.getTransactionResult(t)]):($n.warn("user function return false, transaction failed."),[2,!1]);case 4:return s.sent(),n=!0,[3,7];case 5:return o=s.sent(),(i=this.handleUnrecoverableException(o))?[2,Promise.reject(i)]:(n=!1,++r>=5?[2,Promise.reject(C.build(o))]:[3,7]);case 6:return t.release(),[7];case 7:return[3,1];case 8:return[2,n]}}))}))},e.prototype.handleUnrecoverableException=function(e){if(D.isErrorObject(e))return e;switch(e){case 1004e3:case 1004001:case 1004002:case 1004003:case 1004004:case 1004005:case 1004006:case 1004007:case 1005e3:case 52:case 53:case 1005001:case 51:case 1001:case 1002:case 16:case 2001015:return C.build(e)}},e.prototype.verifyTransaction=function(e){if(this.verifyTransactionListLength(e),this.verifyTransactionData(e),e.getTransactionObjectsSize()>2097152)throw C.build("The capacity of objects exceeds the limit.");if(e.getNeedVerifyObjects().length>1e3)throw $n.warn("The size of object list to be verified exceeds the limit."),C.build("The size of object list to be verified exceeds the limit.");if(e.getQueryObjectsSize()>5242880)throw $n.warn("The capacity of objects to be verified exceeds the limit."),C.build("The capacity of objects to be verified exceeds the limit.")},e.prototype.verifyTransactionData=function(e){var t=this;e.getTransactionList().forEach((function(e){if(!t.validateObjectType(e.objects))throw C.build("The object type is not loaded yet.")}))},e.prototype.verifyTransactionListLength=function(e){var t,n,r=0;try{for(var o=b(e.getTransactionList()),i=o.next();!i.done;i=o.next()){var s=i.value;if((s.operationType===w.SYNC_UPSERT||s.operationType===w.SYNC_DELETE)&&(r+=s.objects.length)>1e3)throw C.build("The size of object list exceeds the limit.")}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.getTransactionResult=function(e){return y(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return t.trys.push([0,,4,5]),e.isTransactionEmpty()?[3,2]:[4,this.naturalStore.runTransaction(this.zoneName,e.getNeedVerifyObjects(),e.getTransactionList())];case 1:return t.sent(),[3,3];case 2:$n.warn("nothing need to execute in this transaction, transaction succeed."),t.label=3;case 3:return[3,5];case 4:return e.release(),[7];case 5:return[2]}}))}))},e.prototype.checkCloudDBZoneHandle=function(){if(!this.naturalStore.references.has(this.zoneId))throw $n.warn("The CloudDBZone has not been created or opened."),C.build("The CloudDBZone has not been created or opened.")},e.prototype.isValidOperation=function(e){if(this.checkCloudDBZoneHandle(),!D.isValidObject(e))throw C.build("The object list is invalid.")},e.prototype.checkQuickGamePlatform=function(){if("FastGame"===rt.getApplicationType())throw C.build("QuickGame platform is not support transaction or subscribe")},e.prototype.getNaturalStore=function(){return this.naturalStore},e.prototype.getDataModelHelper=function(){return this.naturalStore.getDataModelHelper()},e.listenerId=0,e}(),nr=new u("CloudDBZoneConfig"),rr=/^[a-zA-Z]{1}[a-zA-Z0-9]{0,19}$/,or=function(){function e(e,t){this.checkInput(e),this.cloudDBZoneName_=e,this.checkTraceId(t)}return Object.defineProperty(e.prototype,"cloudDBZoneName",{get:function(){return this.cloudDBZoneName_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"traceId",{get:function(){return this.traceId_},enumerable:!1,configurable:!0}),e.prototype.checkInput=function(e){if("string"!=typeof e||!this.isCloudDBZoneNameValid(e)||e.length>20)throw C.build("CloudDBZone name is invalid.")},e.prototype.checkTraceId=function(e){if(e&&void 0!==e["x-trace-id"]&&null!==e["x-trace-id"]){var t=e["x-trace-id"];if("string"!=typeof t||!D.checkTraceId(t))return this.traceId_=D.generateTraceId(),void nr.warn("The customized trace id is invalid, a new trace id '"+this.traceId_+"' will be used");this.traceId_=t}else this.traceId_=void 0},e.prototype.isCloudDBZoneNameValid=function(e){return rr.test(e)},e}();!function(e){e[e.USER_KEY_CHANGED=0]="USER_KEY_CHANGED"}(bn||(bn={}));var ir=new u("AGConnectCloudDB"),sr=function(){function e(e){this.isCreateObjectTypeSuccess=!1,this.naturalBase=e}return e.initialize=function(t){if(!e.sAGConnectCloudDB){In.loadAgcConfig(t);var n=new Hn;this.sAGConnectCloudDB=new e(n)}},e.getInstance=function(t){if(D.isNullOrUndefined(t))return e.sAGConnectCloudDB;if(!We.getConfigInstance().getAGCRoutePolicySet().has(t))throw C.build("The agcRoutePolicy is invalid");var n=this.CLOUDDB_MAP.get(t);if(!D.isNullOrUndefined(n))return n;var r=new e(new Hn(t));return this.CLOUDDB_MAP.set(t,r),r},e.prototype.createObjectType=function(e){if(!(this.naturalBase instanceof Hn))throw C.build("Failed to create object type info into the AGConnectCloudDB.");var t=this.naturalBase.createObjectType(e);if(0!==t)throw C.build(t);this.isCreateObjectTypeSuccess=!0},e.prototype.openCloudDBZone=function(e){var t=this;if(!(e&&e instanceof or))throw C.build("The config is invalid.");if(!this.isCreateObjectTypeSuccess)throw C.build("Failed to open the CloudDBZone because the object type has not been created.");return st.setTraceId(e.traceId),new Promise((function(n,r){t.naturalBase.openNaturalStore(e.cloudDBZoneName).then((function(t){if(0===t.exceptionCode){var o=new tr(D.generateUUID(),e.cloudDBZoneName,t.naturalStore);n(o)}else ir.error("openCloudDBZone: Failed to create or open a CloudDBZone."),r(C.build(t.exceptionCode))})).catch((function(e){ir.error("openCloudDBZone: Failed to create or open a CloudDBZone."),r(C.build(e))}))}))},e.prototype.closeCloudDBZone=function(e){this.validateCloudDBZone(e),this.naturalBase.tryCloseNaturalStore(e.zoneId,e.cloudDBZoneName)},e.prototype.setUserKey=function(e,t,n){return y(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:if("string"!=typeof e||0===e.length)throw C.build("User key must not be null.");return t="string"!=typeof t?"":t,n="boolean"==typeof n&&n,[4,this.naturalBase.setUserKey(e,t,n)];case 1:return[2,r.sent()]}}))}))},e.prototype.addEventListener=function(e){return y(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:if(!e)throw C.build("EventListener must not be null.");if(!D.isFunction(e.onEvent))throw C.build("EventListener is invalid.");return[4,In.getUserInfo()];case 1:return t.sent()?[4,this.naturalBase.addOnEventListener(e)]:(ir.error("User has not login, fail to addEventListener"),[2]);case 2:return t.sent(),[2]}}))}))},e.prototype.validateCloudDBZone=function(e){if(!e)throw C.build("CloudDBZone must not be null.");if(!(e instanceof tr))throw C.build("Input CloudDBZone is invalid.");if(e.hasSnapshot())throw C.build("Remove snapshot listener first.")},e.CLOUDDB_MAP=new Map,e}(),ar=l.getCryptoJS(),ur=function(){function e(){}return e.prototype.decrypt=function(e,t,n){return y(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,i(e,t,{name:"AES-GCM",iv:n,tagLength:Ln})];case 1:return[2,r.sent()]}}))}))},e.prototype.encrypt=function(e,t,n){return y(this,void 0,void 0,(function(){return h(this,(function(r){switch(r.label){case 0:return[4,s(e,t,{name:"AES-GCM",iv:n,tagLength:Ln})];case 1:return[2,r.sent()]}}))}))},e.prototype.generateRandom=function(e){var t=ar.lib.WordArray.random(e);return D.wordArrayToUint8Array(t)},e}(),cr=function(){function e(){}return e.prototype.request=function(e){var t=e;this.realRequest(t)},e}(),lr=new u("AGCHttpsAdapter"),dr=function(e){function t(){return e.call(this)||this}return f(t,e),t.prototype.getService=function(){return this.service||(this.service=a.instance().getService("AGCNetworkService")),this.service},t.prototype.realRequest=function(e){var t=this,n=e.url,r=e.backUrl,o=e.method,i=e.header,s=e.data,a=e.success?e.success:function(e){},u=e.fail?e.fail:function(e){};this.internalRequest(n,o,i,s).then((function(e){var n=e.status;n>=200&&n<300?a({statusCode:n,data:e.data}):(lr.warn("[AGC Http Adapter fail] =>"+n+" "+e.statusText),t.retryRequest(r,o,i,s,a,u))})).catch((function(e){t.retryRequest(r,o,i,s,a,u)}))},t.prototype.internalRequest=function(e,t,n,r){var o=r instanceof ArrayBuffer?{responseType:"arraybuffer",timeout:6e4}:{};switch(t){case"DELETE":return this.getService().delete(e,void 0,n,o);case"GET":return this.getService().get(e,void 0,n,o);case"POST":return this.getService().post(e,r,n,o);case"PUT":return this.getService().put(e,r,n,o);default:return Promise.reject({status:405})}},t.prototype.retryRequest=function(e,t,n,r,o,i){this.internalRequest(e,t,n,r).then((function(e){var t=e.status;t>=200&&t<300?o({statusCode:t,data:e.data}):(lr.warn("[AGC Http Adapter fail] =>"+t+" "+e.statusText),i({status:t,statusText:e.statusText}))})).catch((function(e){i(e)}))},t}(cr),pr=function(){function e(e,t){this.listeners=e,this.agcWebsocket=a.instance(t).getService("AGCWebSocketService")}return e.prototype.connect=function(e){if(!e)throw C.build(1003);this.agcWebsocket.connect(e.url,e.header),this.agcWebsocket.onOpen(this.listeners._onopen),this.agcWebsocket.onMessage(this.listeners._onmessage),this.agcWebsocket.onClose(this.listeners._onclose),this.agcWebsocket.onError(this.listeners._onerror)},e.prototype.close=function(e){this.agcWebsocket&&this.agcWebsocket.close((null==e?void 0:e.eventCode)||1e3,e)},e.prototype.sendMessage=function(e){this.agcWebsocket&&this.agcWebsocket.send(e.data)},e}(),fr=function(){function e(){}return e.prototype.getAGCRoutePolicySet=function(){return this.agcRoutePolicySet||(this.agcRoutePolicySet=new Set([1,3,2,4])),this.agcRoutePolicySet},e.prototype.getAddressMap=function(){return this.addressMap||(this.addressMap=new Map([[1,["CN","CN_back"]],[4,["SG","SG_back"]],[3,["RU","RU_back"]],[2,["DE","DE_back"]]])),this.addressMap},e.prototype.getAgcRoutePolicyMap=function(){return this.agcRoutePolicyMap||(this.agcRoutePolicyMap=new Map([["CN",1],["SG",4],["RU",3],["DE",2]])),this.agcRoutePolicyMap},e.prototype.getConfigInstance=function(e){return this.agcInstance=a.instance().configInstance(e),this.agcInstance},e.prototype.getCredentialsProvider=function(){var e;return this.credentialsProvider=null===(e=this.agcInstance)||void 0===e?void 0:e.getService("CredentialsService"),this.credentialsProvider},e.prototype.getCurrentUser=function(){return y(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,a.auth().getCurrentUser()];case 1:return[2,e.sent()]}}))}))},e.prototype.getRegionMap=function(){return this.regionMap||(this.regionMap=new Map([[1,"CN"],[2,"DE"],[3,"RU"],[4,"SG"]])),this.regionMap},e}();Lt.setClient(dr),et.setClient(pr),We.setConfigAdapter(fr),rt.setApplicationType("Browser"),_n.setEncryptor(new ur);export{sr as AGConnectCloudDB,m as AGConnectCloudDBException,S as AGConnectCloudDBExceptionCode,tr as CloudDBZone,or as CloudDBZoneConfig,P as CloudDBZoneQuery,bn as EventType,er as ServerStatus};
